import{b as S,l as u,g as U,f as ee,u as te,e as se,r as m,j as e}from"./index-CFDQeSWK.js";import{s as E}from"./scheduleDatabase.service-BuPXcwlw.js";import{S as ae}from"./ScheduleImportModal-CQFUD8RN.js";import"./azureAI.service-CZPi9VqR.js";import"./medicalCorrections.service-DDTgANcC.js";import"./resolveDefaultsModeConfig-R7vZuTP0.js";class ne{storageKey="doctor_schedule_data";backupKey="doctor_schedule_backup";saveSchedule(s,a){try{const n=this.getAllSchedules();n[s]=a,localStorage.setItem(this.storageKey,JSON.stringify(n)),localStorage.setItem(this.backupKey,JSON.stringify({data:n,lastSaved:new Date().toISOString()})),sessionStorage.setItem(`schedule_${s}`,JSON.stringify(a))}catch{S("App","Error message",{})}}loadSchedule(s){try{const a=sessionStorage.getItem(`schedule_${s}`);return a?JSON.parse(a):this.getAllSchedules()[s]||[]}catch{return S("App","Error message",{}),this.restoreFromBackup(s)}}getAllSchedules(){try{const s=localStorage.getItem(this.storageKey);return s?JSON.parse(s):{}}catch{return S("App","Error message",{}),{}}}restoreFromBackup(s){try{const a=localStorage.getItem(this.backupKey);if(a){const{data:n}=JSON.parse(a);return n[s]||[]}}catch{S("App","Error message",{})}return[]}exportSchedules(){const s=this.getAllSchedules();return JSON.stringify({version:"1.0",exportDate:new Date().toISOString(),schedules:s},null,2)}importSchedules(s){try{const a=JSON.parse(s);if(a.schedules){const o={...this.getAllSchedules(),...a.schedules};return localStorage.setItem(this.storageKey,JSON.stringify(o)),!0}}catch{S("App","Error message",{})}return!1}clearAll(){localStorage.removeItem(this.storageKey),localStorage.removeItem(this.backupKey),Object.keys(sessionStorage).forEach(a=>{a.startsWith("schedule_")&&sessionStorage.removeItem(a)})}initializeDemoData(){const s=new Date;for(let a=-7;a<=7;a++){const n=new Date(s);n.setDate(n.getDate()+a);const o=n.toISOString().split("T")[0];a<0?this.saveSchedule(o,[{id:`demo_${o}_1`,time:"09:00",initials:"JD",name:"John Doe",status:"completed",notes:"Routine checkup"},{id:`demo_${o}_2`,time:"14:00",initials:"JS",name:"Jane Smith",status:"completed",notes:"Follow-up"}]):a===0?this.saveSchedule(o,[{id:`demo_${o}_1`,time:"10:00",initials:"AB",name:"Alice Brown",status:"scheduled",notes:""}]):a<=3&&this.saveSchedule(o,[{id:`demo_${o}_1`,time:"11:00",initials:"CD",name:"Charlie Davis",status:"scheduled",notes:""}])}}}const A=new ne;class B{static getAllStoredAppointments(){const s={simpleAppointments:[],scheduleSlots:{},sessionData:{}};try{const a=localStorage.getItem("tshla_simple_appointments");a&&(s.simpleAppointments=JSON.parse(a)),s.scheduleSlots=A.getAllSchedules(),Object.keys(sessionStorage).forEach(o=>{if(o.startsWith("schedule_")){const g=sessionStorage.getItem(o);g&&(s.sessionData[o]=JSON.parse(g))}});const n=sessionStorage.getItem("current_patient");n&&(s.sessionData.current_patient=JSON.parse(n))}catch{S("App","Error message",{})}return s}static convertSimpleAppointmentsToSlots(s){const a={};return s.forEach(n=>{a[n.date]||(a[n.date]=[]);const o={id:n.id,time:n.time,initials:n.patientName.split(" ").map(g=>g[0]).join("").toUpperCase(),name:n.patientName,status:n.status==="scheduled"?"scheduled":n.status==="completed"?"completed":"scheduled",notes:n.notes||`${n.visitType}: ${n.visitReason}`};a[n.date].push(o)}),a}static migrateToUnifiedStorage(){u("App","Debug message",{});const s=this.getAllStoredAppointments();let a=0;if(s.simpleAppointments.length>0){u("App","Debug message",{});const n=this.convertSimpleAppointmentsToSlots(s.simpleAppointments);Object.keys(n).forEach(o=>{const I=[...A.loadSchedule(o),...n[o]].filter((v,y,D)=>D.findIndex(p=>p.name===v.name&&p.time===v.time)===y);A.saveSchedule(o,I),a+=n[o].length})}return Object.keys(s.sessionData).forEach(n=>{if(n.startsWith("schedule_")){const o=n.replace("schedule_",""),g=A.loadSchedule(o),k=s.sessionData[n];if(Array.isArray(k)){const v=[...g,...k].filter((y,D,p)=>p.findIndex(N=>N.name===y.name&&N.time===y.time)===D);A.saveSchedule(o,v)}}}),U("App","Info message",{}),a}static debugShowAllData(){const s=this.getAllStoredAppointments();return u("App","Debug message",{}),u("App","Debug message",{}),u("App","Debug message",{}),u("App","Debug message",{}),u("App","Debug message",{}),s}static createBackup(){const s=this.getAllStoredAppointments(),a={timestamp:new Date().toISOString(),data:s},n=JSON.stringify(a,null,2);return localStorage.setItem("appointment_backup_"+Date.now(),n),u("App","Debug message",{}),n}}function re(){try{return u("App","Debug message",{}),B.createBackup(),B.debugShowAllData(),B.migrateToUnifiedStorage()>0?(u("App","Debug message",{}),u("App","Debug message",{})):u("App","Debug message",{}),!0}catch{return S("App","Error message",{}),!1}}const oe=()=>{const d=[];for(let s=9;s<12;s++)d.push(`${s}:00 AM`),d.push(`${s}:30 AM`);d.push("12:00 PM"),d.push("12:30 PM");for(let s=1;s<=5;s++)d.push(`${s}:00 PM`),d.push(`${s}:30 PM`);return d};function ge(){const{user:d,logout:s}=ee(),a=te(),n=se.getCurrentUser(),o=n?.name||"Dr. Smith",g=n?.id||n?.email||"doctor-default-001",[k,I]=m.useState("slots"),[v,y]=m.useState(!1),[D]=m.useState(!0),[p,N]=m.useState(new Date().toISOString().split("T")[0]),[L,J]=m.useState(!1),[w,j]=m.useState("idle");U("DoctorDashboard","Component initialized",{timestamp:new Date});const[h,T]=m.useState([]),[W,C]=m.useState(!1),[ie,F]=m.useState(""),[x,P]=m.useState(null),[i,b]=m.useState({name:"",mrn:"",appointmentTime:"",phone:"",dob:""}),$=oe();m.useEffect(()=>{re()},[]),m.useEffect(()=>{R()},[p,g]);const R=async()=>{J(!0);try{const t=await E.getScheduleForDate(g,p);T(t),u("DoctorDashboard","Debug message",{})}catch{S("DoctorDashboard","Error message",{}),j("error")}finally{J(!1)}},M=async t=>{j("saving");try{await E.saveAppointment(g,o,t,p)?(j("saved"),setTimeout(()=>j("idle"),2e3),R()):j("error")}catch{S("DoctorDashboard","Error message",{}),j("error")}},H=t=>{a(`/dictation/${t}`)},q=async t=>{const r={id:`placeholder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:`Patient @ ${t}`,mrn:`TBD-${Date.now().toString().slice(-6)}`,appointmentTime:t,status:"pending",isPlaceholder:!0},l=[...h,r].sort((c,f)=>{const _=O(c.appointmentTime),Z=O(f.appointmentTime);return _.localeCompare(Z)});T(l),F(""),await M(r)},z=t=>{P(t),b({name:t.name===`Patient @ ${t.appointmentTime}`?"":t.name,mrn:t.mrn.startsWith("TBD-")?"":t.mrn,appointmentTime:t.appointmentTime,phone:t.phone||"",dob:t.dob||""}),C(!0)},V=async()=>{if(!i.appointmentTime){alert("Please select an appointment time");return}const t={id:x?.id||`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:i.name||`Patient @ ${i.appointmentTime}`,mrn:i.mrn||`MRN${Date.now().toString().slice(-6)}`,appointmentTime:i.appointmentTime,status:x?.status||"pending",phone:i.phone,isPlaceholder:!i.name};let r;x?(r=h.map(l=>l.id===x.id?t:l),x.id&&!x.id.includes("placeholder")?await E.updateAppointment(x.id,t):await M(t)):(r=[...h,t],await M(t)),r.sort((l,c)=>{const f=O(l.appointmentTime),_=O(c.appointmentTime);return f.localeCompare(_)}),T(r),b({name:"",mrn:"",appointmentTime:"",phone:"",dob:""}),C(!1),P(null)},O=t=>{const[r,l]=t.split(" ");let[c,f]=r.split(":");return c==="12"?c=l==="AM"?"00":"12":l==="PM"&&(c=String(parseInt(c,10)+12)),`${c.padStart(2,"0")}:${f}`},Q=async t=>{const r=h.filter(l=>l.id!==t);T(r),t&&!t.includes("placeholder")&&await E.deleteAppointment(t)},K=t=>{const r=new Date(p);r.setDate(r.getDate()+t),N(r.toISOString().split("T")[0])},Y=()=>{N(new Date().toISOString().split("T")[0])},G=t=>{const r=new Date(t),l=new Date,c=new Date(l);c.setDate(c.getDate()-1);const f=new Date(l);return f.setDate(f.getDate()+1),t===l.toISOString().split("T")[0]?"Today":t===c.toISOString().split("T")[0]?"Yesterday":t===f.toISOString().split("T")[0]?"Tomorrow":r.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})},X=h.map(t=>t.appointmentTime);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[D&&e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 text-center text-xl font-bold",children:"🗄️ DATABASE-ENABLED SCHEDULE - SAVE ACROSS DAYS! 🗄️"}),e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex justify-between items-center h-12",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"TSHLA Medical"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[o?.name||d?.name||"Dr. Provider",o?.specialty&&` • ${o.specialty}`]})]}),e.jsx("button",{onClick:()=>a("/quick-note"),className:"px-4 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition flex items-center gap-2",children:"⚡ Quick Note"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>a("/doctor/templates"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"📝 Templates"}),e.jsx("button",{onClick:()=>a("/doctor/profile"),className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"⚙️ Profile"}),e.jsx("button",{onClick:s,className:"text-xs text-gray-600 hover:text-gray-900",children:"Sign Out"})]})]})})}),e.jsxs("div",{className:"flex gap-3 p-3 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"w-44",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-3 mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:h.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total"})]}),e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:h.filter(t=>t.status==="completed").length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Done"})]}),e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:h.filter(t=>t.status==="in-progress").length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Active"})]}),e.jsxs("div",{className:"text-center py-1",children:[e.jsx("p",{className:"text-xl font-bold text-gray-500",children:h.filter(t=>t.status==="pending").length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Pending"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>a("/quick-note"),className:"w-full px-3 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition",children:"⚡ Quick Note"}),e.jsx("button",{onClick:()=>{P(null),b({name:"",mrn:"",appointmentTime:"",phone:"",dob:""}),C(!0)},className:"w-full px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition",children:"+ Add Patient"})]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm h-[calc(100vh-100px)]",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"📅 Schedule - DATABASE ENABLED"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>K(-1),className:"px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm transition",children:"← Previous"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 px-3",children:[G(p)," (",p,")"]}),e.jsx("button",{onClick:()=>K(1),className:"px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm transition",children:"Next →"}),e.jsx("button",{onClick:Y,className:"px-2 py-1 bg-blue-600 text-white hover:bg-blue-700 rounded text-sm transition ml-2",children:"Today"}),e.jsx("input",{type:"date",value:p,onChange:t=>N(t.target.value),className:"px-2 py-1 border rounded text-sm ml-2"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w!=="idle"&&e.jsx("div",{className:`text-xs px-2 py-1 rounded ${w==="saving"?"bg-yellow-100 text-yellow-800":w==="saved"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:w==="saving"?"Saving...":w==="saved"?"Saved ✓":"Error saving"}),e.jsx("span",{className:"text-sm font-medium text-blue-600 bg-blue-50 px-3 py-1 rounded-full",children:L?"Loading...":`${h.length} patients • ${$.length-h.length} open`})]})})]})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(100vh - 230px)"},children:L?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading schedule from database..."})}):e.jsx("div",{children:$.map(t=>{const r=h.find(c=>c.appointmentTime===t),l=!!r;return e.jsxs("div",{className:"flex items-center border-b border-gray-100 hover:bg-blue-50/50 transition-colors",children:[e.jsx("div",{className:"w-24 py-3 px-4 font-semibold text-gray-700 bg-gray-50 border-r text-sm",children:t}),l&&r?e.jsx("div",{className:"flex-1 py-2.5 px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${r.isPlaceholder?"text-gray-400 italic":"text-gray-900"}`,children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["MRN: ",r.mrn]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>z(r),className:"p-1.5 text-yellow-600 hover:bg-yellow-50 rounded transition",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>H(r.id),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition",title:"Dictation",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsx("button",{onClick:()=>Q(r.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition",title:"Remove",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}):e.jsx("div",{className:"flex-1 py-3 px-4",children:e.jsxs("button",{onClick:()=>q(t),className:"w-full text-left flex items-center justify-between group",children:[e.jsx("span",{className:"text-sm text-gray-400 group-hover:text-green-600 transition",children:"Available"}),e.jsx("span",{className:"text-xs text-green-600 opacity-0 group-hover:opacity-100 transition",children:"+ Add"})]})})]},t)})})})]})}),e.jsx("div",{className:"w-96",children:W?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:x?"Edit Patient Information":"Add New Patient"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Patient Name"}),e.jsx("input",{type:"text",value:i.name,onChange:t=>b({...i,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter patient name (or leave blank for placeholder)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MRN (Medical Record Number)"}),e.jsx("input",{type:"text",value:i.mrn,onChange:t=>b({...i,mrn:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter MRN (or leave blank to auto-generate)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Appointment Time *"}),e.jsxs("select",{value:i.appointmentTime,onChange:t=>b({...i,appointmentTime:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select a time slot"}),$.map(t=>{const r=X.includes(t)&&(!x||x.appointmentTime!==t);return e.jsxs("option",{value:t,disabled:r,children:[t," ",r?"(Occupied)":""]},t)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",value:i.phone,onChange:t=>b({...i,phone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"(555) 555-5555"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",value:i.dob,onChange:t=>b({...i,dob:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:V,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:x?"Update Patient":"Add to Schedule"}),e.jsx("button",{onClick:()=>{C(!1),P(null),b({name:"",mrn:"",appointmentTime:"",phone:"",dob:""})},className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition",children:"Cancel"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"📋"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Click ",e.jsx("span",{className:"font-semibold",children:"+ Full Add"})," to add a patient"]})]})})})]}),e.jsx(ae,{isOpen:v,onClose:()=>y(!1),onImportComplete:()=>{window.location.reload()}})]})}export{ge as default};
//# sourceMappingURL=DoctorDashboard-D7X8n-Ug.js.map
