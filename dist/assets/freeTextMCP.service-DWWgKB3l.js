import{l as p,g as m,h as d}from"./index-JAW6HvUl.js";class x{mcpEndpoint="";async saveFreeTextResponse(r,i,t){try{p("freeTextMCP","Debug message",{});const n={tool:"save_free_text_response",args:{sessionId:r,freeText:i,analysis:t?{currentSituation:t.currentSituation||"",fears:t.fears||"",excitement:t.excitement||"",wordCount:t.wordCount||i.split(" ").length,sentimentScore:t.sentimentScore||0,keyThemes:t.keyThemes||""}:void 0}},s=await fetch(this.mcpEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(3e3)});if(!s.ok)throw new Error(`MCP call failed: ${s.status}`);const l=await s.json();return m("freeTextMCP","Info message",{}),l}catch{return d("freeTextMCP","Warning message",{}),{success:!0,responseId:`local_${r}_${Date.now()}`,sessionId:r,wordCount:i.split(" ").filter(s=>s.length>0).length,timestamp:Date.now()}}}async getFreeTextResponse(r){try{p("freeTextMCP","Debug message",{});const i={tool:"get_free_text_response",args:{sessionId:r}},t=await fetch(this.mcpEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(3e3)});if(!t.ok)throw new Error(`MCP call failed: ${t.status}`);const n=await t.json();return m("freeTextMCP","Info message",{}),n}catch{d("freeTextMCP","Warning message",{});try{const t=sessionStorage.getItem("pumpDriveFreeText");if(t){const n=JSON.parse(t);return{success:!0,response:{id:`local_${r}`,sessionId:r,currentSituation:n.currentSituation||"",fears:"",excitement:"",fullResponse:n.currentSituation||"",wordCount:n.currentSituation?.split(" ").filter(s=>s.length>0).length||0,sentimentScore:0,keyThemes:"",createdAt:Date.now(),updatedAt:Date.now()}}}}catch{d("freeTextMCP","Warning message",{})}return{success:!1,response:null}}}analyzeText(r){const t=r.split(/\s+/).filter(o=>o.length>0).length,n=["excited","better","improved","freedom","easier","love","good","great","amazing","happy"],s=["scared","worried","difficult","hard","problem","issue","hate","bad","terrible","afraid"],l=["scared","afraid","worried","anxious","nervous","concern","fear"],h=["excited","looking forward","can't wait","thrilled","eager"];let c=0,u=0,f=0,g=0;const e=r.toLowerCase();n.forEach(o=>{e.includes(o)&&c++}),s.forEach(o=>{e.includes(o)&&u++}),l.forEach(o=>{e.includes(o)&&f++}),h.forEach(o=>{e.includes(o)&&g++});const w=c>0||u>0?(c-u)/(c+u):0,a=[];return(e.includes("current")||e.includes("now")||e.includes("currently"))&&a.push("current situation"),(e.includes("cgm")||e.includes("sensor"))&&a.push("CGM/sensors"),(e.includes("tube")||e.includes("tubing"))&&a.push("tubing concerns"),(e.includes("battery")||e.includes("charging"))&&a.push("power/battery"),(e.includes("control")||e.includes("management"))&&a.push("diabetes control"),(e.includes("exercise")||e.includes("activity")||e.includes("sport"))&&a.push("physical activity"),{wordCount:t,sentimentScore:Math.round(w*100)/100,keyThemes:a.join(", "),fears:f>0?"Mentions fears/concerns":"",excitement:g>0?"Expresses excitement":""}}generateSessionId(){return`ft_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}}const y=new x;export{y as f};
//# sourceMappingURL=freeTextMCP.service-DWWgKB3l.js.map
