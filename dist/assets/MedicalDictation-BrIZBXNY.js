const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-CdX4YT1s.js","assets/index-JAW6HvUl.js","assets/index--GQbvNKg.css"])))=>i.map(i=>d[i]);
import{k as ft,_ as Ve,g as R,b as y,l as g,h as V,j as c,u as _t,r as U,e as Be,C as rt}from"./index-JAW6HvUl.js";import{s as At,m as st}from"./medicalCorrections.service-DDTgANcC.js";import{m as E}from"./microsoft.cognitiveservices.speech.sdk-dKKEa4Bl.js";import{a as be}from"./awsTranscribeMedicalStreamingFixed.service-BNg944jX.js";import{a as nt,T as Ot,S as It,M as zt}from"./awsTranscribeSimple.service-BKxEC8hU.js";import{g as it}from"./patientData.service-CnIeW3dA.js";import{d as ae}from"./doctorProfile.service-D2iM7g3D.js";import{s as Te}from"./scheduleDatabase.service-C2AuUFEu.js";import{a as Pt}from"./azureAI.service--vi5Elg4.js";import"./supabase-ezNangua.js";import{F as Mt}from"./file-text-4DKCZsvQ.js";import{C as Ut}from"./chevron-down-CkM-qfmA.js";import{S as $t}from"./star-IARMEOCM.js";function Ft(a,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in a)){const n=Object.getOwnPropertyDescriptor(r,s);n&&Object.defineProperty(a,s,n.get?n:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}class K extends Error{constructor(e){super(e),this.__dgError=!0,this.name="DeepgramError"}}function _(a){return typeof a=="object"&&a!==null&&"__dgError"in a}class qt extends K{constructor(e,t){super(e),this.name="DeepgramApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Pe extends K{constructor(e,t){super(e),this.name="DeepgramUnknownError",this.originalError=t}}class ce extends K{constructor(){super("You are attempting to use an old format for a newer SDK version. Read more here: https://dpgr.am/js-v3"),this.name="DeepgramVersionError"}}class Lt extends K{constructor(e,t={}){super(e),this.name="DeepgramWebSocketError",this.originalEvent=t.originalEvent,this.statusCode=t.statusCode,this.requestId=t.requestId,this.responseHeaders=t.responseHeaders,this.url=t.url,this.readyState=t.readyState}toJSON(){return{name:this.name,message:this.message,statusCode:this.statusCode,requestId:this.requestId,responseHeaders:this.responseHeaders,url:this.url,readyState:this.readyState,originalEvent:this.originalEvent?{type:this.originalEvent.type,timeStamp:this.originalEvent.timeStamp}:void 0}}}var je={exports:{}},at;function Bt(){if(at)return je.exports;at=1;var a=typeof Reflect=="object"?Reflect:null,e=a&&typeof a.apply=="function"?a.apply:function(f,v,C){return Function.prototype.apply.call(f,v,C)},t;a&&typeof a.ownKeys=="function"?t=a.ownKeys:Object.getOwnPropertySymbols?t=function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:t=function(f){return Object.getOwnPropertyNames(f)};function r(m){console&&console.warn&&console.warn(m)}var s=Number.isNaN||function(f){return f!==f};function n(){n.init.call(this)}je.exports=n,je.exports.once=x,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var i=10;function o(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(m){if(typeof m!="number"||m<0||s(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");i=m}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(f){if(typeof f!="number"||f<0||s(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this};function h(m){return m._maxListeners===void 0?n.defaultMaxListeners:m._maxListeners}n.prototype.getMaxListeners=function(){return h(this)},n.prototype.emit=function(f){for(var v=[],C=1;C<arguments.length;C++)v.push(arguments[C]);var T=f==="error",D=this._events;if(D!==void 0)T=T&&D.error===void 0;else if(!T)return!1;if(T){var j;if(v.length>0&&(j=v[0]),j instanceof Error)throw j;var Q=new Error("Unhandled error."+(j?" ("+j.message+")":""));throw Q.context=j,Q}var J=D[f];if(J===void 0)return!1;if(typeof J=="function")e(J,this,v);else for(var le=J.length,oe=ee(J,le),C=0;C<le;++C)e(oe[C],this,v);return!0};function p(m,f,v,C){var T,D,j;if(o(v),D=m._events,D===void 0?(D=m._events=Object.create(null),m._eventsCount=0):(D.newListener!==void 0&&(m.emit("newListener",f,v.listener?v.listener:v),D=m._events),j=D[f]),j===void 0)j=D[f]=v,++m._eventsCount;else if(typeof j=="function"?j=D[f]=C?[v,j]:[j,v]:C?j.unshift(v):j.push(v),T=h(m),T>0&&j.length>T&&!j.warned){j.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+j.length+" "+String(f)+" listeners added. Use emitter.setMaxListeners() to increase limit");Q.name="MaxListenersExceededWarning",Q.emitter=m,Q.type=f,Q.count=j.length,r(Q)}return m}n.prototype.addListener=function(f,v){return p(this,f,v,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(f,v){return p(this,f,v,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(m,f,v){var C={fired:!1,wrapFn:void 0,target:m,type:f,listener:v},T=u.bind(C);return T.listener=v,C.wrapFn=T,T}n.prototype.once=function(f,v){return o(v),this.on(f,S(this,f,v)),this},n.prototype.prependOnceListener=function(f,v){return o(v),this.prependListener(f,S(this,f,v)),this},n.prototype.removeListener=function(f,v){var C,T,D,j,Q;if(o(v),T=this._events,T===void 0)return this;if(C=T[f],C===void 0)return this;if(C===v||C.listener===v)--this._eventsCount===0?this._events=Object.create(null):(delete T[f],T.removeListener&&this.emit("removeListener",f,C.listener||v));else if(typeof C!="function"){for(D=-1,j=C.length-1;j>=0;j--)if(C[j]===v||C[j].listener===v){Q=C[j].listener,D=j;break}if(D<0)return this;D===0?C.shift():$(C,D),C.length===1&&(T[f]=C[0]),T.removeListener!==void 0&&this.emit("removeListener",f,Q||v)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(f){var v,C,T;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[f]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[f]),this;if(arguments.length===0){var D=Object.keys(C),j;for(T=0;T<D.length;++T)j=D[T],j!=="removeListener"&&this.removeAllListeners(j);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(v=C[f],typeof v=="function")this.removeListener(f,v);else if(v!==void 0)for(T=v.length-1;T>=0;T--)this.removeListener(f,v[T]);return this};function P(m,f,v){var C=m._events;if(C===void 0)return[];var T=C[f];return T===void 0?[]:typeof T=="function"?v?[T.listener||T]:[T]:v?te(T):ee(T,T.length)}n.prototype.listeners=function(f){return P(this,f,!0)},n.prototype.rawListeners=function(f){return P(this,f,!1)},n.listenerCount=function(m,f){return typeof m.listenerCount=="function"?m.listenerCount(f):Y.call(m,f)},n.prototype.listenerCount=Y;function Y(m){var f=this._events;if(f!==void 0){var v=f[m];if(typeof v=="function")return 1;if(v!==void 0)return v.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function ee(m,f){for(var v=new Array(f),C=0;C<f;++C)v[C]=m[C];return v}function $(m,f){for(;f+1<m.length;f++)m[f]=m[f+1];m.pop()}function te(m){for(var f=new Array(m.length),v=0;v<f.length;++v)f[v]=m[v].listener||m[v];return f}function x(m,f){return new Promise(function(v,C){function T(j){m.removeListener(f,D),C(j)}function D(){typeof m.removeListener=="function"&&m.removeListener("error",T),v([].slice.call(arguments))}M(m,f,D,{once:!0}),f!=="error"&&k(m,T,{once:!0})})}function k(m,f,v){typeof m.on=="function"&&M(m,"error",f,v)}function M(m,f,v,C){if(typeof m.on=="function")C.once?m.once(f,v):m.on(f,v);else if(typeof m.addEventListener=="function")m.addEventListener(f,function T(D){C.once&&m.removeEventListener(f,T),v(D)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m)}return je.exports}var Wt=Bt(),Ne={exports:{}},ot;function Ht(){return ot||(ot=1,(function(a,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof window<"u"&&window,r=(function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n})();(function(n){(function(i){var o=typeof n<"u"&&n||typeof self<"u"&&self||typeof window<"u"&&window||{},h={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function p(l){return l&&DataView.prototype.isPrototypeOf(l)}if(h.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],S=ArrayBuffer.isView||function(l){return l&&u.indexOf(Object.prototype.toString.call(l))>-1};function P(l){if(typeof l!="string"&&(l=String(l)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(l)||l==="")throw new TypeError('Invalid character in header field name: "'+l+'"');return l.toLowerCase()}function Y(l){return typeof l!="string"&&(l=String(l)),l}function ee(l){var b={next:function(){var A=l.shift();return{done:A===void 0,value:A}}};return h.iterable&&(b[Symbol.iterator]=function(){return b}),b}function $(l){this.map={},l instanceof $?l.forEach(function(b,A){this.append(A,b)},this):Array.isArray(l)?l.forEach(function(b){if(b.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+b.length);this.append(b[0],b[1])},this):l&&Object.getOwnPropertyNames(l).forEach(function(b){this.append(b,l[b])},this)}$.prototype.append=function(l,b){l=P(l),b=Y(b);var A=this.map[l];this.map[l]=A?A+", "+b:b},$.prototype.delete=function(l){delete this.map[P(l)]},$.prototype.get=function(l){return l=P(l),this.has(l)?this.map[l]:null},$.prototype.has=function(l){return this.map.hasOwnProperty(P(l))},$.prototype.set=function(l,b){this.map[P(l)]=Y(b)},$.prototype.forEach=function(l,b){for(var A in this.map)this.map.hasOwnProperty(A)&&l.call(b,this.map[A],A,this)},$.prototype.keys=function(){var l=[];return this.forEach(function(b,A){l.push(A)}),ee(l)},$.prototype.values=function(){var l=[];return this.forEach(function(b){l.push(b)}),ee(l)},$.prototype.entries=function(){var l=[];return this.forEach(function(b,A){l.push([A,b])}),ee(l)},h.iterable&&($.prototype[Symbol.iterator]=$.prototype.entries);function te(l){if(!l._noBody){if(l.bodyUsed)return Promise.reject(new TypeError("Already read"));l.bodyUsed=!0}}function x(l){return new Promise(function(b,A){l.onload=function(){b(l.result)},l.onerror=function(){A(l.error)}})}function k(l){var b=new FileReader,A=x(b);return b.readAsArrayBuffer(l),A}function M(l){var b=new FileReader,A=x(b),q=/charset=([A-Za-z0-9_-]+)/.exec(l.type),L=q?q[1]:"utf-8";return b.readAsText(l,L),A}function m(l){for(var b=new Uint8Array(l),A=new Array(b.length),q=0;q<b.length;q++)A[q]=String.fromCharCode(b[q]);return A.join("")}function f(l){if(l.slice)return l.slice(0);var b=new Uint8Array(l.byteLength);return b.set(new Uint8Array(l)),b.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(l){this.bodyUsed=this.bodyUsed,this._bodyInit=l,l?typeof l=="string"?this._bodyText=l:h.blob&&Blob.prototype.isPrototypeOf(l)?this._bodyBlob=l:h.formData&&FormData.prototype.isPrototypeOf(l)?this._bodyFormData=l:h.searchParams&&URLSearchParams.prototype.isPrototypeOf(l)?this._bodyText=l.toString():h.arrayBuffer&&h.blob&&p(l)?(this._bodyArrayBuffer=f(l.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):h.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(l)||S(l))?this._bodyArrayBuffer=f(l):this._bodyText=l=Object.prototype.toString.call(l):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof l=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):h.searchParams&&URLSearchParams.prototype.isPrototypeOf(l)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},h.blob&&(this.blob=function(){var l=te(this);if(l)return l;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var l=te(this);return l||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(h.blob)return this.blob().then(k);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var l=te(this);if(l)return l;if(this._bodyBlob)return M(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(m(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},h.formData&&(this.formData=function(){return this.text().then(j)}),this.json=function(){return this.text().then(JSON.parse)},this}var C=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function T(l){var b=l.toUpperCase();return C.indexOf(b)>-1?b:l}function D(l,b){if(!(this instanceof D))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');b=b||{};var A=b.body;if(l instanceof D){if(l.bodyUsed)throw new TypeError("Already read");this.url=l.url,this.credentials=l.credentials,b.headers||(this.headers=new $(l.headers)),this.method=l.method,this.mode=l.mode,this.signal=l.signal,!A&&l._bodyInit!=null&&(A=l._bodyInit,l.bodyUsed=!0)}else this.url=String(l);if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new $(b.headers)),this.method=T(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal||(function(){if("AbortController"in o){var O=new AbortController;return O.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&A)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(A),(this.method==="GET"||this.method==="HEAD")&&(b.cache==="no-store"||b.cache==="no-cache")){var q=/([?&])_=[^&]*/;if(q.test(this.url))this.url=this.url.replace(q,"$1_="+new Date().getTime());else{var L=/\?/;this.url+=(L.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}D.prototype.clone=function(){return new D(this,{body:this._bodyInit})};function j(l){var b=new FormData;return l.trim().split("&").forEach(function(A){if(A){var q=A.split("="),L=q.shift().replace(/\+/g," "),O=q.join("=").replace(/\+/g," ");b.append(decodeURIComponent(L),decodeURIComponent(O))}}),b}function Q(l){var b=new $,A=l.replace(/\r?\n[\t ]+/g," ");return A.split("\r").map(function(q){return q.indexOf(`
`)===0?q.substr(1,q.length):q}).forEach(function(q){var L=q.split(":"),O=L.shift().trim();if(O){var ue=L.join(":").trim();try{b.append(O,ue)}catch(we){console.warn("Response "+we.message)}}}),b}v.call(D.prototype);function J(l,b){if(!(this instanceof J))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(b||(b={}),this.type="default",this.status=b.status===void 0?200:b.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=b.statusText===void 0?"":""+b.statusText,this.headers=new $(b.headers),this.url=b.url||"",this._initBody(l)}v.call(J.prototype),J.prototype.clone=function(){return new J(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $(this.headers),url:this.url})},J.error=function(){var l=new J(null,{status:200,statusText:""});return l.ok=!1,l.status=0,l.type="error",l};var le=[301,302,303,307,308];J.redirect=function(l,b){if(le.indexOf(b)===-1)throw new RangeError("Invalid status code");return new J(null,{status:b,headers:{location:l}})},i.DOMException=o.DOMException;try{new i.DOMException}catch{i.DOMException=function(b,A){this.message=b,this.name=A;var q=Error(b);this.stack=q.stack},i.DOMException.prototype=Object.create(Error.prototype),i.DOMException.prototype.constructor=i.DOMException}function oe(l,b){return new Promise(function(A,q){var L=new D(l,b);if(L.signal&&L.signal.aborted)return q(new i.DOMException("Aborted","AbortError"));var O=new XMLHttpRequest;function ue(){O.abort()}O.onload=function(){var H={statusText:O.statusText,headers:Q(O.getAllResponseHeaders()||"")};L.url.indexOf("file://")===0&&(O.status<200||O.status>599)?H.status=200:H.status=O.status,H.url="responseURL"in O?O.responseURL:H.headers.get("X-Request-URL");var re="response"in O?O.response:O.responseText;setTimeout(function(){A(new J(re,H))},0)},O.onerror=function(){setTimeout(function(){q(new TypeError("Network request failed"))},0)},O.ontimeout=function(){setTimeout(function(){q(new TypeError("Network request timed out"))},0)},O.onabort=function(){setTimeout(function(){q(new i.DOMException("Aborted","AbortError"))},0)};function we(H){try{return H===""&&o.location.href?o.location.href:H}catch{return H}}if(O.open(L.method,we(L.url),!0),L.credentials==="include"?O.withCredentials=!0:L.credentials==="omit"&&(O.withCredentials=!1),"responseType"in O&&(h.blob?O.responseType="blob":h.arrayBuffer&&(O.responseType="arraybuffer")),b&&typeof b.headers=="object"&&!(b.headers instanceof $||o.Headers&&b.headers instanceof o.Headers)){var ke=[];Object.getOwnPropertyNames(b.headers).forEach(function(H){ke.push(P(H)),O.setRequestHeader(H,Y(b.headers[H]))}),L.headers.forEach(function(H,re){ke.indexOf(re)===-1&&O.setRequestHeader(re,H)})}else L.headers.forEach(function(H,re){O.setRequestHeader(re,H)});L.signal&&(L.signal.addEventListener("abort",ue),O.onreadystatechange=function(){O.readyState===4&&L.signal.removeEventListener("abort",ue)}),O.send(typeof L._bodyInit>"u"?null:L._bodyInit)})}return oe.polyfill=!0,o.fetch||(o.fetch=oe,o.Headers=$,o.Request=D,o.Response=J),i.Headers=$,i.Request=D,i.Response=J,i.fetch=oe,Object.defineProperty(i,"__esModule",{value:!0}),i})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=t.fetch?t:r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,a.exports=e})(Ne,Ne.exports)),Ne.exports}var Ge=Ht();const gt=ft(Ge),Kt=Ft({__proto__:null,default:gt},[Ge]);var We,ct;function Vt(){if(ct)return We;ct=1;var a=function(k){return e(k)&&!t(k)};function e(x){return!!x&&typeof x=="object"}function t(x){var k=Object.prototype.toString.call(x);return k==="[object RegExp]"||k==="[object Date]"||n(x)}var r=typeof Symbol=="function"&&Symbol.for,s=r?Symbol.for("react.element"):60103;function n(x){return x.$$typeof===s}function i(x){return Array.isArray(x)?[]:{}}function o(x,k){return k.clone!==!1&&k.isMergeableObject(x)?$(i(x),x,k):x}function h(x,k,M){return x.concat(k).map(function(m){return o(m,M)})}function p(x,k){if(!k.customMerge)return $;var M=k.customMerge(x);return typeof M=="function"?M:$}function u(x){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(x).filter(function(k){return Object.propertyIsEnumerable.call(x,k)}):[]}function S(x){return Object.keys(x).concat(u(x))}function P(x,k){try{return k in x}catch{return!1}}function Y(x,k){return P(x,k)&&!(Object.hasOwnProperty.call(x,k)&&Object.propertyIsEnumerable.call(x,k))}function ee(x,k,M){var m={};return M.isMergeableObject(x)&&S(x).forEach(function(f){m[f]=o(x[f],M)}),S(k).forEach(function(f){Y(x,f)||(P(x,f)&&M.isMergeableObject(k[f])?m[f]=p(f,M)(x[f],k[f],M):m[f]=o(k[f],M))}),m}function $(x,k,M){M=M||{},M.arrayMerge=M.arrayMerge||h,M.isMergeableObject=M.isMergeableObject||a,M.cloneUnlessOtherwiseSpecified=o;var m=Array.isArray(k),f=Array.isArray(x),v=m===f;return v?m?M.arrayMerge(x,k,M):ee(x,k,M):o(k,M)}$.all=function(k,M){if(!Array.isArray(k))throw new Error("first argument should be an array");return k.reduce(function(m,f){return $(m,f,M)},{})};var te=$;return We=te,We}var Jt=Vt();const Se=ft(Jt),mt=typeof process<"u"&&process.versions&&process.versions.node?process.versions.node:"unknown",bt=typeof process<"u"&&process.versions&&process.versions.bun?process.versions.bun:"unknown",yt=typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"unknown",Fe=()=>yt!=="unknown",Gt=()=>mt!=="unknown",vt=()=>bt!=="unknown";function lt(a={},e={}){return Se(e,a)}function Yt(a,e){Object.keys(e).forEach(t=>{Array.isArray(e[t])?e[t].forEach(s=>{a.append(t,String(s))}):a.append(t,String(e[t]))})}const Zt=()=>typeof Headers>"u"?Ge.Headers:Headers,Me=a=>!!(a&&a.url),Je=a=>!!(a&&a.text),ut=a=>!!(Xt(a)||Qt(a)),Qt=a=>a!=null&&Buffer.isBuffer(a),Xt=a=>a==null||Fe()?!1:typeof a=="object"&&typeof a.pipe=="function"&&typeof a.read=="function"&&typeof a._readableState=="object",er=a=>(t=>t.toLowerCase().replace(/^http/,"ws"))(a),tr=a=>{var e,t,r,s,n,i;const o={};return a._experimentalCustomFetch&&(o.global={fetch:{client:a._experimentalCustomFetch}}),a=Se(a,o),!((e=a.restProxy)===null||e===void 0)&&e.url&&(o.global={fetch:{options:{proxy:{url:(t=a.restProxy)===null||t===void 0?void 0:t.url}}}}),a=Se(a,o),!((r=a.global)===null||r===void 0)&&r.url&&(o.global={fetch:{options:{url:a.global.url}},websocket:{options:{url:a.global.url}}}),a=Se(a,o),!((s=a.global)===null||s===void 0)&&s.headers&&(o.global={fetch:{options:{headers:(n=a.global)===null||n===void 0?void 0:n.headers}},websocket:{options:{_nodeOnlyHeaders:(i=a.global)===null||i===void 0?void 0:i.headers}}}),a=Se(a,o),a},dt="4.11.2",rr=()=>Gt()?`node/${mt}`:vt()?`bun/${bt}`:Fe()?`javascript ${yt}`:"unknown",Ue={"Content-Type":"application/json","X-Client-Info":`@deepgram/sdk; ${Fe()?"browser":"server"}; v${dt}`,"User-Agent":`@deepgram/sdk/${dt} ${rr()}`},$e="https://api.deepgram.com",St="wss://agent.deepgram.com",sr={fetch:{options:{url:$e,headers:Ue}},websocket:{options:{url:er($e),_nodeOnlyHeaders:Ue}}},nr={fetch:{options:{url:$e,headers:Ue}},websocket:{options:{url:St,_nodeOnlyHeaders:Ue}}},ir={global:sr,agent:nr};var fe;(function(a){a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed"})(fe||(fe={}));var pe;(function(a){a.Connecting="connecting",a.Open="open",a.Closing="closing",a.Closed="closed"})(pe||(pe={}));var ht={};const wt=()=>{};class De extends Wt.EventEmitter{constructor(e){if(super(),this.factory=void 0,this.key=void 0,this.accessToken=void 0,this.namespace="global",this.version="v1",this.baseUrl=$e,this.logger=wt,typeof e.accessToken=="function"?(this.factory=e.accessToken,this.accessToken=this.factory()):this.accessToken=e.accessToken,typeof e.key=="function"?(this.factory=e.key,this.key=this.factory()):this.key=e.key,!this.key&&!this.accessToken&&(this.accessToken=ht.DEEPGRAM_ACCESS_TOKEN,this.accessToken||(this.key=ht.DEEPGRAM_API_KEY)),!this.key&&!this.accessToken)throw new K("A deepgram API key or access token is required.");e=tr(e),this.options=lt(e,ir)}v(e="v1"){return this.version=e,this}get namespaceOptions(){const e=lt(this.options[this.namespace],this.options.global);return Object.assign(Object.assign({},e),{key:this.key})}getRequestUrl(e,t={version:this.version},r){t.version=this.version,e=e.replace(/:(\w+)/g,function(n,i){return t[i]});const s=new URL(e,this.baseUrl);return r&&Yt(s.searchParams,r),s}log(e,t,r){this.logger(e,t,r)}}var ar=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};const or=typeof WebSocket<"u";class Ye extends De{constructor(e){super(e),this.conn=null,this.sendBuffer=[],this.reconnect=wt;const{key:t,websocket:{options:r,client:s}}=this.namespaceOptions;this.proxy?this.baseUrl=r.proxy.url:this.baseUrl=r.url,s?this.transport=s:this.transport=null,r._nodeOnlyHeaders?this.headers=r._nodeOnlyHeaders:this.headers={},"Authorization"in this.headers||(this.accessToken?this.headers.Authorization=`Bearer ${this.accessToken}`:this.headers.Authorization=`Token ${t}`)}connect(e,t){if(this.conn)return;this.reconnect=(i=e)=>{this.connect(i,t)};const r=this.getRequestUrl(t,{},e),s=this.accessToken,n=this.key;if(!s&&!n)throw new Error("No key or access token provided for WebSocket connection.");if(this.transport){this.conn=new this.transport(r,void 0,{headers:this.headers}),this.setupConnection();return}if(vt()){Ve(async()=>{const{default:i}=await import("./browser-CdX4YT1s.js").then(o=>o.b);return{default:i}},__vite__mapDeps([0,1,2])).then(({default:i})=>{this.conn=new i(r,{headers:this.headers}),console.log("Using WS package"),this.setupConnection()});return}if(or){this.conn=new WebSocket(r,s?["bearer",s]:["token",n]),this.setupConnection();return}this.conn=new cr(r,void 0,{close:()=>{this.conn=null}}),Ve(async()=>{const{default:i}=await import("./browser-CdX4YT1s.js").then(o=>o.b);return{default:i}},__vite__mapDeps([0,1,2])).then(({default:i})=>{this.conn=new i(r,void 0,{headers:this.headers}),this.setupConnection()})}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null)}connectionState(){switch(this.conn&&this.conn.readyState){case fe.connecting:return pe.Connecting;case fe.open:return pe.Open;case fe.closing:return pe.Closing;default:return pe.Closed}}getReadyState(){var e,t;return(t=(e=this.conn)===null||e===void 0?void 0:e.readyState)!==null&&t!==void 0?t:fe.closed}isConnected(){return this.connectionState()===pe.Open}send(e){const t=()=>ar(this,void 0,void 0,function*(){var r;if(e instanceof Blob){if(e.size===0){this.log("warn","skipping `send` for zero-byte blob",e);return}e=yield e.arrayBuffer()}if(typeof e!="string"&&!e?.byteLength){this.log("warn","skipping `send` for zero-byte payload",e);return}(r=this.conn)===null||r===void 0||r.send(e)});this.isConnected()?t():this.sendBuffer.push(t)}get proxy(){var e;return this.key==="proxy"&&!!(!((e=this.namespaceOptions.websocket.options.proxy)===null||e===void 0)&&e.url)}extractErrorInformation(e,t){var r;const s={};if(t&&(s.readyState=t.readyState,s.url=typeof t.url=="string"?t.url:(r=t.url)===null||r===void 0?void 0:r.toString()),t&&typeof t=="object"){const n=t;if(n._req&&n._req.res&&(s.statusCode=n._req.res.statusCode,n._req.res.headers)){s.responseHeaders=Object.assign({},n._req.res.headers);const i=n._req.res.headers["dg-request-id"]||n._req.res.headers["x-dg-request-id"];i&&(s.requestId=i)}if(e&&"target"in e&&e.target){const i=e.target;i.url&&(s.url=i.url),i.readyState!==void 0&&(s.readyState=i.readyState)}}return s}createEnhancedError(e,t){const r=new Lt(e.message||"WebSocket connection error",Object.assign({originalEvent:e},t));return Object.assign(Object.assign({},e),{error:r,statusCode:t.statusCode,requestId:t.requestId,responseHeaders:t.responseHeaders,url:t.url,readyState:t.readyState,message:this.buildEnhancedErrorMessage(e,t)})}buildEnhancedErrorMessage(e,t){let r=e.message||"WebSocket connection error";const s=[];if(t.statusCode&&s.push(`Status: ${t.statusCode}`),t.requestId&&s.push(`Request ID: ${t.requestId}`),t.readyState!==void 0){const i=["CONNECTING","OPEN","CLOSING","CLOSED"][t.readyState]||`Unknown(${t.readyState})`;s.push(`Ready State: ${i}`)}return t.url&&s.push(`URL: ${t.url}`),s.length>0&&(r+=` (${s.join(", ")})`),r}setupConnectionEvents(e){this.conn&&(this.conn.onopen=()=>{this.emit(e.Open,this)},this.conn.onclose=t=>{this.emit(e.Close,t)},this.conn.onerror=t=>{const r=this.extractErrorInformation(t,this.conn||void 0),s=this.createEnhancedError(t,r);this.emit(e.Error,s)})}}class cr{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=fe.connecting,this.send=()=>{},this.url=null,this.url=e.toString(),this.close=r.close}}var xt=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,[])).next())})};const lr=a=>{let e;return a?e=a:typeof fetch>"u"?e=gt:e=fetch,(...t)=>e(...t)},ur=({apiKey:a,customFetch:e,accessToken:t})=>{const r=lr(e),s=Zt();return(n,i)=>xt(void 0,void 0,void 0,function*(){const o=new s(i?.headers);return o.has("Authorization")||o.set("Authorization",t?`Bearer ${t}`:`Token ${a}`),r(n,Object.assign(Object.assign({},i),{headers:o}))})},dr=()=>xt(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ve(()=>Promise.resolve().then(()=>Kt),void 0)).Response:Response});var he=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class ge extends De{constructor(e){if(super(e),Fe()&&!this.proxy)throw new K("Due to CORS we are unable to support REST-based API calls to our API from the browser. Please consider using a proxy: https://dpgr.am/js-proxy for more information.");const{accessToken:t,key:r,fetch:s}=this;this.fetch=ur({accessToken:t,apiKey:r,customFetch:s}),this.proxy?this.baseUrl=this.namespaceOptions.fetch.options.proxy.url:this.baseUrl=this.namespaceOptions.fetch.options.url}_getErrorMessage(e){return e.msg||e.message||e.error_description||e.error||JSON.stringify(e)}_handleError(e,t){return he(this,void 0,void 0,function*(){const r=yield dr();e instanceof r?e.json().then(s=>{t(new qt(this._getErrorMessage(s),e.status||500))}).catch(s=>{t(new Pe(this._getErrorMessage(s),s))}):t(new Pe(this._getErrorMessage(e),e))})}_getRequestOptions(e,t,r){let s={method:e};return e==="GET"||e==="DELETE"?s=Object.assign(Object.assign({},s),t):s=Object.assign(Object.assign({duplex:"half",body:t},s),r),Se(this.namespaceOptions.fetch.options,s,{clone:!1})}_handleRequest(e,t,r,s){return he(this,void 0,void 0,function*(){return new Promise((n,i)=>{const o=this.fetch;o(t,this._getRequestOptions(e,r,s)).then(h=>{if(!h.ok)throw h;n(h)}).catch(h=>this._handleError(h,i))})})}get(e,t){return he(this,void 0,void 0,function*(){return this._handleRequest("GET",e,t)})}post(e,t,r){return he(this,void 0,void 0,function*(){return this._handleRequest("POST",e,t,r)})}put(e,t,r){return he(this,void 0,void 0,function*(){return this._handleRequest("PUT",e,t,r)})}patch(e,t,r){return he(this,void 0,void 0,function*(){return this._handleRequest("PATCH",e,t,r)})}delete(e,t){return he(this,void 0,void 0,function*(){return this._handleRequest("DELETE",e,t)})}get proxy(){var e;return this.key==="proxy"&&!!(!((e=this.namespaceOptions.fetch.options.proxy)===null||e===void 0)&&e.url)}}var se;(function(a){a.Open="Open",a.Close="Close",a.Error="Error",a.Audio="Audio",a.Welcome="Welcome",a.SettingsApplied="SettingsApplied",a.ConversationText="ConversationText",a.UserStartedSpeaking="UserStartedSpeaking",a.AgentThinking="AgentThinking",a.FunctionCallRequest="FunctionCallRequest",a.AgentStartedSpeaking="AgentStartedSpeaking",a.AgentAudioDone="AgentAudioDone",a.InjectionRefused="InjectionRefused",a.PromptUpdated="PromptUpdated",a.SpeakUpdated="SpeakUpdated",a.Unhandled="Unhandled"})(se||(se={}));class hr extends Ye{constructor(e,t="/:version/agent/converse"){var r,s,n,i;super(e),this.namespace="agent",this.baseUrl=(i=(n=(s=(r=e.agent)===null||r===void 0?void 0:r.websocket)===null||s===void 0?void 0:s.options)===null||n===void 0?void 0:n.url)!==null&&i!==void 0?i:St,this.connect({},t)}setupConnection(){this.setupConnectionEvents({Open:se.Open,Close:se.Close,Error:se.Error}),this.conn&&(this.conn.onmessage=e=>{this.handleMessage(e)})}handleMessage(e){var t,r,s,n,i,o;if(typeof e.data=="string")try{const h=JSON.parse(e.data);this.handleTextMessage(h)}catch(h){this.emit(se.Error,{event:e,data:((t=e.data)===null||t===void 0?void 0:t.toString().substring(0,200))+(((r=e.data)===null||r===void 0?void 0:r.toString().length)>200?"...":""),message:"Unable to parse `data` as JSON.",error:h,url:(s=this.conn)===null||s===void 0?void 0:s.url,readyState:(n=this.conn)===null||n===void 0?void 0:n.readyState})}else e.data instanceof Blob?e.data.arrayBuffer().then(h=>{this.handleBinaryMessage(Buffer.from(h))}):e.data instanceof ArrayBuffer?this.handleBinaryMessage(Buffer.from(e.data)):Buffer.isBuffer(e.data)?this.handleBinaryMessage(e.data):(console.log("Received unknown data type",e.data),this.emit(se.Error,{event:e,message:"Received unknown data type.",url:(i=this.conn)===null||i===void 0?void 0:i.url,readyState:(o=this.conn)===null||o===void 0?void 0:o.readyState,dataType:typeof e.data}))}handleBinaryMessage(e){this.emit(se.Audio,e)}handleTextMessage(e){e.type in se?this.emit(e.type,e):this.emit(se.Unhandled,e)}configure(e){const t=JSON.stringify(Object.assign({type:"Settings"},e));this.send(t)}updatePrompt(e){this.send(JSON.stringify({type:"UpdatePrompt",prompt:e}))}updateSpeak(e){this.send(JSON.stringify({type:"UpdateSpeak",speak:e}))}injectAgentMessage(e){this.send(JSON.stringify({type:"InjectAgentMessage",content:e}))}injectUserMessage(e){this.send(JSON.stringify({type:"InjectUserMessage",content:e}))}functionCallResponse(e){this.send(JSON.stringify(Object.assign({type:"FunctionCallResponse"},e)))}keepAlive(){this.send(JSON.stringify({type:"KeepAlive"}))}}var pr=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class fr extends ge{constructor(){super(...arguments),this.namespace="auth"}grantToken(e={},t=":version/auth/grant"){return pr(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t),s=JSON.stringify(e);return{result:yield this.post(r,s,{headers:{"Content-Type":"application/json"}}).then(i=>i.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}}var G;(function(a){a.Open="open",a.Close="close",a.Error="error",a.Transcript="Results",a.Metadata="Metadata",a.UtteranceEnd="UtteranceEnd",a.SpeechStarted="SpeechStarted",a.Unhandled="Unhandled"})(G||(G={}));var X;(function(a){a.Open="Open",a.Close="Close",a.Error="Error",a.Metadata="Metadata",a.Flushed="Flushed",a.Warning="Warning",a.Audio="Audio",a.Unhandled="Unhandled"})(X||(X={}));class gr extends Ye{constructor(e,t={},r=":version/listen"){var s,n;if(super(e),this.namespace="listen",!((s=t.keyterm)===null||s===void 0)&&s.length&&!(!((n=t.model)===null||n===void 0)&&n.startsWith("nova-3")))throw new K("Keyterms are only supported with the Nova 3 models.");this.connect(t,r)}setupConnection(){this.setupConnectionEvents({Open:G.Open,Close:G.Close,Error:G.Error}),this.conn&&(this.conn.onmessage=e=>{var t,r,s,n;try{const i=JSON.parse(e.data.toString());i.type===G.Metadata?this.emit(G.Metadata,i):i.type===G.Transcript?this.emit(G.Transcript,i):i.type===G.UtteranceEnd?this.emit(G.UtteranceEnd,i):i.type===G.SpeechStarted?this.emit(G.SpeechStarted,i):this.emit(G.Unhandled,i)}catch(i){this.emit(G.Error,{event:e,message:"Unable to parse `data` as JSON.",error:i,url:(t=this.conn)===null||t===void 0?void 0:t.url,readyState:(r=this.conn)===null||r===void 0?void 0:r.readyState,data:((s=e.data)===null||s===void 0?void 0:s.toString().substring(0,200))+(((n=e.data)===null||n===void 0?void 0:n.toString().length)>200?"...":"")})}})}configure(e){this.send(JSON.stringify({type:"Configure",processors:e}))}keepAlive(){this.send(JSON.stringify({type:"KeepAlive"}))}finalize(){this.send(JSON.stringify({type:"Finalize"}))}finish(){this.requestClose()}requestClose(){this.send(JSON.stringify({type:"CloseStream"}))}}var _e=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class mr extends ge{constructor(){super(...arguments),this.namespace="listen"}transcribeUrl(e,t,r=":version/listen"){var s,n;return _e(this,void 0,void 0,function*(){try{let i;if(Me(e))i=JSON.stringify(e);else throw new K("Unknown transcription source type");if(t!==void 0&&"callback"in t)throw new K("Callback cannot be provided as an option to a synchronous transcription. Use `transcribeUrlCallback` or `transcribeFileCallback` instead.");if(!((s=t?.keyterm)===null||s===void 0)&&s.length&&!(!((n=t.model)===null||n===void 0)&&n.startsWith("nova-3")))throw new K("Keyterms are only supported with the Nova 3 models.");const o=this.getRequestUrl(r,{},Object.assign({},t));return{result:yield this.post(o,i).then(p=>p.json()),error:null}}catch(i){if(_(i))return{result:null,error:i};throw i}})}transcribeFile(e,t,r=":version/listen"){return _e(this,void 0,void 0,function*(){try{let s;if(ut(e))s=e;else throw new K("Unknown transcription source type");if(t!==void 0&&"callback"in t)throw new K("Callback cannot be provided as an option to a synchronous transcription. Use `transcribeUrlCallback` or `transcribeFileCallback` instead.");const n=this.getRequestUrl(r,{},Object.assign({},t));return{result:yield this.post(n,s,{headers:{"Content-Type":"deepgram/audio+video"}}).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}transcribeUrlCallback(e,t,r,s=":version/listen"){return _e(this,void 0,void 0,function*(){try{let n;if(Me(e))n=JSON.stringify(e);else throw new K("Unknown transcription source type");const i=this.getRequestUrl(s,{},Object.assign(Object.assign({},r),{callback:t.toString()}));return{result:yield this.post(i,n).then(h=>h.json()),error:null}}catch(n){if(_(n))return{result:null,error:n};throw n}})}transcribeFileCallback(e,t,r,s=":version/listen"){return _e(this,void 0,void 0,function*(){try{let n;if(ut(e))n=e;else throw new K("Unknown transcription source type");const i=this.getRequestUrl(s,{},Object.assign(Object.assign({},r),{callback:t.toString()}));return{result:yield this.post(i,n,{headers:{"Content-Type":"deepgram/audio+video"}}).then(h=>h.json()),error:null}}catch(n){if(_(n))return{result:null,error:n};throw n}})}}class br extends De{constructor(){super(...arguments),this.namespace="listen"}get prerecorded(){return new mr(this.options)}live(e={},t=":version/listen"){return new gr(this.options,e,t)}}var B=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class yr extends ge{constructor(){super(...arguments),this.namespace="manage"}getTokenDetails(e=":version/auth/token"){return B(this,void 0,void 0,function*(){try{const t=this.getRequestUrl(e);return{result:yield this.get(t).then(s=>s.json()),error:null}}catch(t){if(_(t))return{result:null,error:t};throw t}})}getProjects(e=":version/projects"){return B(this,void 0,void 0,function*(){try{const t=this.getRequestUrl(e);return{result:yield this.get(t).then(s=>s.json()),error:null}}catch(t){if(_(t))return{result:null,error:t};throw t}})}getProject(e,t=":version/projects/:projectId"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}updateProject(e,t,r=":version/projects/:projectId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t),n=JSON.stringify(t);return{result:yield this.patch(s,n).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}deleteProject(e,t=":version/projects/:projectId"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return yield this.delete(r),{error:null}}catch(r){if(_(r))return{error:r};throw r}})}getProjectKeys(e,t=":version/projects/:projectId/keys"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}getProjectKey(e,t,r=":version/projects/:projectId/keys/:keyId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,keyId:t});return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}createProjectKey(e,t,r=":version/projects/:projectId/keys"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t),n=JSON.stringify(t);return{result:yield this.post(s,n).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}deleteProjectKey(e,t,r=":version/projects/:projectId/keys/:keyId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,keyId:t});return yield this.delete(s),{error:null}}catch(s){if(_(s))return{error:s};throw s}})}getProjectMembers(e,t=":version/projects/:projectId/members"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}removeProjectMember(e,t,r=":version/projects/:projectId/members/:memberId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,memberId:t});return yield this.delete(s),{error:null}}catch(s){if(_(s))return{error:s};throw s}})}getProjectMemberScopes(e,t,r=":version/projects/:projectId/members/:memberId/scopes"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,memberId:t});return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}updateProjectMemberScope(e,t,r,s=":version/projects/:projectId/members/:memberId/scopes"){return B(this,void 0,void 0,function*(){try{const n=this.getRequestUrl(s,{projectId:e,memberId:t},r),i=JSON.stringify(r);return{result:yield this.put(n,i).then(h=>h.json()),error:null}}catch(n){if(_(n))return{result:null,error:n};throw n}})}getProjectInvites(e,t=":version/projects/:projectId/invites"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}sendProjectInvite(e,t,r=":version/projects/:projectId/invites"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t),n=JSON.stringify(t);return{result:yield this.post(s,n).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}deleteProjectInvite(e,t,r=":version/projects/:projectId/invites/:email"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,email:t});return yield this.delete(s),{error:null}}catch(s){if(_(s))return{error:s};throw s}})}leaveProject(e,t=":version/projects/:projectId/leave"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.delete(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}getProjectUsageRequests(e,t,r=":version/projects/:projectId/requests"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t);return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}getProjectUsageRequest(e,t,r=":version/projects/:projectId/requests/:requestId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,requestId:t});return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}getProjectUsageSummary(e,t,r=":version/projects/:projectId/usage"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t);return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}getProjectUsageFields(e,t,r=":version/projects/:projectId/usage/fields"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t);return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}getProjectBalances(e,t=":version/projects/:projectId/balances"){return B(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}getProjectBalance(e,t,r=":version/projects/:projectId/balances/:balanceId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,balanceId:t});return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}getAllModels(e,t={},r=":version/projects/:projectId/models"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e},t);return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}getModel(e,t,r=":version/projects/:projectId/models/:modelId"){return B(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,modelId:t});return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}}var pt=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class vr extends ge{constructor(){super(...arguments),this.namespace="models"}getAll(e=":version/models",t={}){return pt(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(e,{},t);return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}getModel(e,t=":version/models/:modelId"){return pt(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{modelId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}}var Ae=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class Sr extends ge{constructor(){super(...arguments),this.namespace="read"}analyzeUrl(e,t,r=":version/read"){return Ae(this,void 0,void 0,function*(){try{let s;if(Me(e))s=JSON.stringify(e);else throw new K("Unknown source type");if(t!==void 0&&"callback"in t)throw new K("Callback cannot be provided as an option to a synchronous transcription. Use `analyzeUrlCallback` or `analyzeTextCallback` instead.");const n=this.getRequestUrl(r,{},Object.assign({},t));return{result:yield this.post(n,s).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}analyzeText(e,t,r=":version/read"){return Ae(this,void 0,void 0,function*(){try{let s;if(Je(e))s=JSON.stringify(e);else throw new K("Unknown source type");if(t!==void 0&&"callback"in t)throw new K("Callback cannot be provided as an option to a synchronous requests. Use `analyzeUrlCallback` or `analyzeTextCallback` instead.");const n=this.getRequestUrl(r,{},Object.assign({},t));return{result:yield this.post(n,s).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}analyzeUrlCallback(e,t,r,s=":version/read"){return Ae(this,void 0,void 0,function*(){try{let n;if(Me(e))n=JSON.stringify(e);else throw new K("Unknown source type");const i=this.getRequestUrl(s,{},Object.assign(Object.assign({},r),{callback:t.toString()}));return{result:yield this.post(i,n).then(h=>h.json()),error:null}}catch(n){if(_(n))return{result:null,error:n};throw n}})}analyzeTextCallback(e,t,r,s=":version/read"){return Ae(this,void 0,void 0,function*(){try{let n;if(Je(e))n=JSON.stringify(e);else throw new K("Unknown source type");const i=this.getRequestUrl(s,{},Object.assign(Object.assign({},r),{callback:t.toString()}));return{result:yield this.post(i,n,{headers:{"Content-Type":"deepgram/audio+video"}}).then(h=>h.json()),error:null}}catch(n){if(_(n))return{result:null,error:n};throw n}})}}var Oe=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class wr extends ge{constructor(){super(...arguments),this.namespace="selfhosted"}listCredentials(e,t=":version/projects/:projectId/onprem/distribution/credentials"){return Oe(this,void 0,void 0,function*(){try{const r=this.getRequestUrl(t,{projectId:e});return{result:yield this.get(r).then(n=>n.json()),error:null}}catch(r){if(_(r))return{result:null,error:r};throw r}})}getCredentials(e,t,r=":version/projects/:projectId/onprem/distribution/credentials/:credentialsId"){return Oe(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,credentialsId:t});return{result:yield this.get(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}createCredentials(e,t,r=":version/projects/:projectId/onprem/distribution/credentials"){return Oe(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e}),n=JSON.stringify(t);return{result:yield this.post(s,n).then(o=>o.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}deleteCredentials(e,t,r=":version/projects/:projectId/onprem/distribution/credentials/:credentialsId"){return Oe(this,void 0,void 0,function*(){try{const s=this.getRequestUrl(r,{projectId:e,credentialsId:t});return{result:yield this.delete(s).then(i=>i.json()),error:null}}catch(s){if(_(s))return{result:null,error:s};throw s}})}}class xr extends Ye{constructor(e,t={},r=":version/speak"){super(e),this.namespace="speak",this.connect(t,r)}setupConnection(){this.setupConnectionEvents({Open:X.Open,Close:X.Close,Error:X.Error}),this.conn&&(this.conn.onmessage=e=>{this.handleMessage(e)})}handleTextMessage(e){e.type===X.Metadata?this.emit(X.Metadata,e):e.type===X.Flushed?this.emit(X.Flushed,e):e.type===X.Warning?this.emit(X.Warning,e):this.emit(X.Unhandled,e)}handleBinaryMessage(e){this.emit(X.Audio,e)}sendText(e){this.send(JSON.stringify({type:"Speak",text:e}))}flush(){this.send(JSON.stringify({type:"Flush"}))}clear(){this.send(JSON.stringify({type:"Clear"}))}requestClose(){this.send(JSON.stringify({type:"Close"}))}handleMessage(e){var t,r,s,n,i,o;if(typeof e.data=="string")try{const h=JSON.parse(e.data);this.handleTextMessage(h)}catch(h){this.emit(X.Error,{event:e,message:"Unable to parse `data` as JSON.",error:h,url:(t=this.conn)===null||t===void 0?void 0:t.url,readyState:(r=this.conn)===null||r===void 0?void 0:r.readyState,data:((s=e.data)===null||s===void 0?void 0:s.toString().substring(0,200))+(((n=e.data)===null||n===void 0?void 0:n.toString().length)>200?"...":"")})}else e.data instanceof Blob?e.data.arrayBuffer().then(h=>{this.handleBinaryMessage(Buffer.from(h))}):e.data instanceof ArrayBuffer?this.handleBinaryMessage(Buffer.from(e.data)):Buffer.isBuffer(e.data)?this.handleBinaryMessage(e.data):(console.log("Received unknown data type",e.data),this.emit(X.Error,{event:e,message:"Received unknown data type.",url:(i=this.conn)===null||i===void 0?void 0:i.url,readyState:(o=this.conn)===null||o===void 0?void 0:o.readyState,dataType:typeof e.data}))}}var He=function(a,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(u){try{p(r.next(u))}catch(S){i(S)}}function h(u){try{p(r.throw(u))}catch(S){i(S)}}function p(u){u.done?n(u.value):s(u.value).then(o,h)}p((r=r.apply(a,e||[])).next())})};class Cr extends ge{constructor(){super(...arguments),this.namespace="speak"}request(e,t,r=":version/speak"){return He(this,void 0,void 0,function*(){let s;if(Je(e))s=JSON.stringify(e);else throw new K("Unknown transcription source type");const n=this.getRequestUrl(r,{},Object.assign({model:"aura-2-thalia-en"},t));return this.result=yield this.post(n,s,{headers:{Accept:"audio/*","Content-Type":"application/json"}}),this})}getStream(){return He(this,void 0,void 0,function*(){if(!this.result)throw new Pe("Tried to get stream before making request","");return this.result.body})}getHeaders(){return He(this,void 0,void 0,function*(){if(!this.result)throw new Pe("Tried to get headers before making request","");return this.result.headers})}}class Tr extends De{constructor(){super(...arguments),this.namespace="speak"}request(e,t,r=":version/speak"){return new Cr(this.options).request(e,t,r)}live(e={},t=":version/speak"){return new xr(this.options,e,t)}}class Rr extends De{get auth(){return new fr(this.options)}get listen(){return new br(this.options)}get manage(){return new yr(this.options)}get models(){return new vr(this.options)}get onprem(){return this.selfhosted}get selfhosted(){return new wr(this.options)}get read(){return new Sr(this.options)}get speak(){return new Tr(this.options)}agent(e="/:version/agent/converse"){return new hr(this.options,e)}get transcription(){throw new ce}get projects(){throw new ce}get keys(){throw new ce}get members(){throw new ce}get scopes(){throw new ce}get invitation(){throw new ce}get usage(){throw new ce}get billing(){throw new ce}}function Dr(a,e){let t={};return typeof a=="string"||typeof a=="function"?t.key=a:typeof a=="object"&&(t=a),new Rr(t)}class kr{deepgram;config;connection=null;isRecording=!1;currentTranscript="";onTranscriptCallback=null;onErrorCallback=null;mediaRecorder=null;audioStream=null;constructor(){if(this.config={apiKey:"b5ef4cbfc4710667942750e56022a928acb33a51",model:"nova-2-medical",language:"en-US",tier:"enhanced",encoding:"linear16",sampleRate:16e3,channels:1},!this.config.apiKey)throw new Error("VITE_DEEPGRAM_API_KEY environment variable is required");this.deepgram=Dr(this.config.apiKey),R("deepgramSDK",`Initialized with model: ${this.config.model}`)}isConfigured(){try{return!!this.config.apiKey&&!!this.deepgram}catch(e){return y("deepgramSDK",`Configuration check failed: ${e}`),!1}}async startTranscription(e,t,r,s){R("deepgramSDK",`Starting ${e} transcription with medical model`),this.onTranscriptCallback=t,this.onErrorCallback=r;try{this.audioStream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.config.sampleRate,channelCount:this.config.channels,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});const n={model:this.config.model,language:this.config.language,encoding:this.config.encoding,sample_rate:this.config.sampleRate,channels:this.config.channels,punctuate:!0,profanity_filter:!1,redact:!1,diarize:e==="CONVERSATION",smart_format:!0,utterances:!0,endpointing:300,keywords:["medical:2","diagnosis:2","prescription:2","medication:2","symptoms:2","treatment:2","blood pressure:3","diabetes:3","insulin:3"],tier:this.config.tier,interim_results:!0,vad_events:!0};this.connection=this.deepgram.listen.live(n),this.connection.on(G.Open,()=>{R("deepgramSDK","Deepgram connection opened successfully"),this.isRecording=!0}),this.connection.on(G.Transcript,i=>{this.handleTranscriptResult(i,e)}),this.connection.on(G.Error,i=>{y("deepgramSDK",`Deepgram error: ${i}`),this.handleError(new Error(`Deepgram error: ${i.message||i}`))}),this.connection.on(G.Close,()=>{R("deepgramSDK","Deepgram connection closed"),this.isRecording=!1}),this.mediaRecorder=new MediaRecorder(this.audioStream,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=i=>{i.data.size>0&&this.connection&&this.isRecording&&this.connection.send(i.data)},this.mediaRecorder.onerror=i=>{y("deepgramSDK",`MediaRecorder error: ${i}`),this.handleError(new Error("MediaRecorder error"))},this.mediaRecorder.start(100),R("deepgramSDK",`${e} transcription started successfully`)}catch(n){y("deepgramSDK",`Failed to start transcription: ${n}`),this.handleError(new Error(`Failed to start Deepgram transcription: ${n}`))}}async startDictation(e,t,r){return this.startTranscription("DICTATION",e,t,r)}async startConversation(e,t,r){return this.startTranscription("CONVERSATION",e,t,r)}async startRecording(e,t){try{return await this.startTranscription("DICTATION",r=>e(r.transcript,!r.isPartial),r=>t(r.message)),!0}catch(r){return t(`Failed to start recording: ${r}`),!1}}stop(){R("deepgramSDK","Stopping transcription"),this.isRecording=!1,this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&this.mediaRecorder.stop(),this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),this.audioStream=null),this.connection&&(this.connection.finish(),this.connection=null),this.onTranscriptCallback=null,this.onErrorCallback=null,this.mediaRecorder=null,R("deepgramSDK","Transcription stopped successfully")}stopRecording(){return this.stop(),this.currentTranscript}getCurrentTranscript(){return this.currentTranscript}handleTranscriptResult(e,t){try{const r=e.channel?.alternatives?.[0];if(!r||!r.transcript.trim())return;const s=e.is_final===!0,n=r.confidence||0;let i;t==="CONVERSATION"&&r.words?.[0]?.speaker!==void 0&&(i=r.words[0].speaker===0?"CLINICIAN":"PATIENT");const o={transcript:r.transcript,isPartial:!s,confidence:n,timestamp:new Date().toISOString(),speaker:i};s&&(i?this.currentTranscript+=`
[${i}]: ${r.transcript}`:this.currentTranscript+=" "+r.transcript,this.currentTranscript=this.currentTranscript.trim()),this.onTranscriptCallback&&this.onTranscriptCallback(o),g("deepgramSDK",`Transcribed: "${r.transcript}" (final: ${s}, confidence: ${n}, speaker: ${i||"N/A"})`)}catch(r){y("deepgramSDK",`Error processing transcript: ${r}`),this.handleError(new Error(`Failed to process transcript: ${r}`))}}handleError(e){y("deepgramSDK",`Error: ${e.message}`),this.onErrorCallback&&this.onErrorCallback(e)}async testConnection(){try{const e=await fetch("https://api.deepgram.com/v1/projects",{headers:{Authorization:`Token ${this.config.apiKey}`}}),t=e.ok;return t?R("deepgramSDK","Connection test successful"):y("deepgramSDK",`Connection test failed: ${e.status} ${e.statusText}`),t}catch(e){return y("deepgramSDK",`Connection test error: ${e}`),!1}}getStatus(){return{isRecording:this.isRecording,isConfigured:this.isConfigured(),currentTranscript:this.currentTranscript,provider:"deepgram-sdk",model:this.config.model}}async transcribeAudioFile(e){try{R("deepgramSDK",`Transcribing audio file: ${e.name}`);const t=await this.deepgram.listen.prerecorded.transcribeFile(e,{model:this.config.model,language:this.config.language,punctuate:!0,profanity_filter:!1,redact:!1,diarize:!0,smart_format:!0,keywords:["medical:2","diagnosis:2","prescription:2","medication:2","symptoms:2","treatment:2"]}),r=t.result.channels[0]?.alternatives[0];if(!r)throw new Error("No transcription result received from Deepgram");return R("deepgramSDK",`File transcription completed with confidence: ${r.confidence}`),{transcript:r.transcript,confidence:r.confidence,words:r.words?.map(s=>({word:s.word,start:s.start,end:s.end,confidence:s.confidence,speaker:s.speaker}))||[],is_final:!0,metadata:{duration:t.result.metadata.duration,model_version:this.config.model,language:this.config.language}}}catch(t){throw y("deepgramSDK",`File transcription failed: ${t}`),t}}}const ye=new kr;class Er{apiKey;config;websocket=null;isConnected=!1;reconnectAttempts=0;maxReconnectAttempts=5;transcriptionCallback=null;constructor(){if(this.apiKey="b5ef4cbfc4710667942750e56022a928acb33a51",!this.apiKey)throw new Error("VITE_DEEPGRAM_API_KEY environment variable is required");this.config={apiKey:this.apiKey,model:"nova-2-medical",language:"en-US",tier:"enhanced",encoding:"linear16",sampleRate:16e3,channels:1},R("deepgram",`Initialized with model: ${this.config.model}`)}async startRealTimeTranscription(e,t){try{this.transcriptionCallback=e;const r=this.buildWebSocketUrl();g("deepgram",`Connecting to Deepgram WebSocket: ${r}`),this.websocket=new WebSocket(r),this.websocket.onopen=()=>{this.isConnected=!0,this.reconnectAttempts=0,R("deepgram","Real-time transcription session started")},this.websocket.onmessage=s=>{try{const n=JSON.parse(s.data);if(n.channel?.alternatives?.[0]){const i=n.channel.alternatives[0],o={transcript:i.transcript,confidence:i.confidence,words:i.words?.map(h=>({word:h.word,start:h.start,end:h.end,confidence:h.confidence}))||[],speaker:i.words?.[0]?.speaker,is_final:n.is_final!==!1,metadata:n.metadata?{duration:n.metadata.duration,model_version:n.metadata.models?.[0]||"medical",language:this.config.language}:void 0};o.transcript.trim()&&(g("deepgram",`Transcribed: "${o.transcript}" (confidence: ${o.confidence})`),this.transcriptionCallback?.(o))}}catch(n){y("deepgram",`Failed to parse WebSocket message: ${n}`)}},this.websocket.onerror=s=>{y("deepgram",`WebSocket error: ${s}`),t?.(new Error("Deepgram WebSocket error"))},this.websocket.onclose=s=>{this.isConnected=!1,V("deepgram",`WebSocket closed: ${s.code} - ${s.reason}`),s.code!==1e3&&this.reconnectAttempts<this.maxReconnectAttempts&&this.attemptReconnect(e,t)}}catch(r){throw y("deepgram",`Failed to start real-time transcription: ${r}`),r}}sendAudioData(e){if(!this.isConnected||!this.websocket){V("deepgram","Cannot send audio - WebSocket not connected");return}try{e instanceof Blob?e.arrayBuffer().then(t=>{this.websocket?.send(t)}):this.websocket.send(e)}catch(t){y("deepgram",`Failed to send audio data: ${t}`)}}stopRealTimeTranscription(){this.websocket&&(this.isConnected&&this.websocket.send(JSON.stringify({type:"CloseStream"})),this.websocket.close(1e3,"Session ended by user"),this.websocket=null),this.isConnected=!1,this.transcriptionCallback=null,R("deepgram","Real-time transcription session stopped")}async transcribeAudioFile(e){try{R("deepgram",`Transcribing audio file: ${e.name}`);const t=new FormData;t.append("audio",e);const r=await fetch("https://api.deepgram.com/v1/listen",{method:"POST",headers:{Authorization:`Token ${this.apiKey}`},body:t});if(!r.ok)throw new Error(`Deepgram API error: ${r.status} ${r.statusText}`);const s=await r.json();if(!s.channel?.alternatives?.[0])throw new Error("No transcription result received from Deepgram");const n=s.channel.alternatives[0];return R("deepgram",`File transcription completed with confidence: ${n.confidence}`),{transcript:n.transcript,confidence:n.confidence,words:n.words?.map(i=>({word:i.word,start:i.start,end:i.end,confidence:i.confidence}))||[],is_final:!0,metadata:{duration:s.metadata.duration,model_version:s.metadata.models?.[0]||"medical",language:this.config.language}}}catch(t){throw y("deepgram",`File transcription failed: ${t}`),t}}buildWebSocketUrl(){const e="wss://api.deepgram.com/v1/listen",t=new URLSearchParams({model:this.config.model,language:this.config.language,tier:this.config.tier,encoding:this.config.encoding,sample_rate:this.config.sampleRate.toString(),channels:this.config.channels.toString(),punctuate:"true",profanity_filter:"false",redact:"false",diarize:"true",smart_format:"true",utterances:"true",endpointing:"300",keywords:"medical:2,diagnosis:2,prescription:2,medication:2,symptoms:2,treatment:2"});return`${e}?${t.toString()}`}async attemptReconnect(e,t){this.reconnectAttempts++;const r=Math.min(1e3*Math.pow(2,this.reconnectAttempts),1e4);V("deepgram",`Attempting reconnect ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${r}ms`),setTimeout(()=>{this.startRealTimeTranscription(e,t)},r)}getConnectionStatus(){return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts,model:this.config.model,language:this.config.language}}async testConnection(){try{const e=await fetch("https://api.deepgram.com/v1/projects",{headers:{Authorization:`Token ${this.apiKey}`}}),t=e.ok;return t?R("deepgram","Connection test successful"):y("deepgram",`Connection test failed: ${e.status}`),t}catch(e){return y("deepgram",`Connection test error: ${e}`),!1}}}const Ie=new Er;class jr{isRecording=!1;currentTranscript="";onTranscriptCallback=null;onErrorCallback=null;mediaRecorder=null;audioStream=null;constructor(){R("deepgramAdapter","Deepgram adapter initialized")}isConfigured(){try{return!!"b5ef4cbfc4710667942750e56022a928acb33a51"}catch(e){return y("deepgramAdapter",`Configuration check failed: ${e}`),!1}}async startTranscription(e,t,r,s){R("deepgramAdapter",`Starting ${e} transcription`),this.onTranscriptCallback=t,this.onErrorCallback=r;try{this.audioStream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),await Ie.startRealTimeTranscription(this.handleDeepgramResult.bind(this),this.handleDeepgramError.bind(this)),this.mediaRecorder=new MediaRecorder(this.audioStream,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=n=>{n.data.size>0&&Ie.sendAudioData(n.data)},this.mediaRecorder.start(100),this.isRecording=!0,R("deepgramAdapter",`${e} transcription started successfully`)}catch(n){y("deepgramAdapter",`Failed to start transcription: ${n}`),r(new Error(`Deepgram transcription failed: ${n}`))}}async startDictation(e,t,r){return this.startTranscription("DICTATION",e,t,r)}async startConversation(e,t,r){return this.startTranscription("CONVERSATION",e,t,r)}async startRecording(e,t){try{return await this.startTranscription("DICTATION",r=>e(r.transcript,!r.isPartial),r=>t(r.message)),!0}catch(r){return t(`Failed to start recording: ${r}`),!1}}stop(){R("deepgramAdapter","Stopping transcription"),this.isRecording=!1,this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&this.mediaRecorder.stop(),this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),this.audioStream=null),Ie.stopRealTimeTranscription(),this.onTranscriptCallback=null,this.onErrorCallback=null,this.mediaRecorder=null,R("deepgramAdapter","Transcription stopped")}stopRecording(){return this.stop(),this.currentTranscript}getCurrentTranscript(){return this.currentTranscript}handleDeepgramResult(e){try{const t={transcript:e.transcript,isPartial:!e.is_final,confidence:e.confidence,timestamp:new Date().toISOString(),speaker:e.speaker!==void 0?`SPEAKER_${e.speaker}`:void 0};e.is_final&&(this.currentTranscript+=" "+e.transcript,this.currentTranscript=this.currentTranscript.trim()),this.onTranscriptCallback&&this.onTranscriptCallback(t),g("deepgramAdapter",`Transcribed: "${e.transcript}" (final: ${e.is_final})`)}catch(t){y("deepgramAdapter",`Error processing result: ${t}`)}}handleDeepgramError(e){y("deepgramAdapter",`Deepgram error: ${e.message}`),this.onErrorCallback&&this.onErrorCallback(e)}getStatus(){return{isRecording:this.isRecording,isConfigured:this.isConfigured(),currentTranscript:this.currentTranscript,provider:"deepgram"}}async testConnection(){try{return await Ie.testConnection()}catch(e){return y("deepgramAdapter",`Connection test failed: ${e}`),!1}}}const ve=new jr;class Nr{config;speechConfig=null;constructor(){this.config=this.loadConfiguration(),this.initializeSpeechConfig()}loadConfiguration(){const t="centralus";return V("azureSpeechConfig","Warning message",{}),{subscriptionKey:void 0,region:t,language:"en-US",enableDictation:!0,enableConversation:!0,enableMedicalPhrases:!0}}initializeSpeechConfig(){if(!this.config.subscriptionKey){V("azureSpeechConfig","Warning message",{});return}try{this.speechConfig=E.SpeechConfig.fromSubscription(this.config.subscriptionKey,this.config.region),this.speechConfig.speechRecognitionLanguage=this.config.language,this.config.enableMedicalPhrases&&g("azureSpeechConfig","Debug message",{}),this.speechConfig.outputFormat=E.OutputFormat.Detailed,this.speechConfig.setProfanity(E.ProfanityOption.Masked),R("azureSpeechConfig","Info message",{})}catch{y("azureSpeechConfig","Error message",{})}}isConfigured(){return this.speechConfig!==null&&!!this.config.subscriptionKey}getSpeechConfig(){return this.speechConfig}getConfig(){return{...this.config}}createDictationRecognizer(e){if(!this.speechConfig)return null;const t=new E.SpeechRecognizer(this.speechConfig,e);return this.configureMedicalPhrases(t),t}createConversationTranscriber(e){if(!this.speechConfig)return null;const t=new E.ConversationTranscriber(e);return this.configureMedicalPhrases(t),t}configureMedicalPhrases(e){try{const t=E.PhraseListGrammar.fromRecognizer(e);["blood pressure","heart rate","respiratory rate","temperature","oxygen saturation","systolic","diastolic","beats per minute","breaths per minute","chest pain","shortness of breath","nausea","vomiting","dizziness","fatigue","headache","abdominal pain","back pain","joint pain","muscle pain","diabetes","hypertension","asthma","COPD","pneumonia","bronchitis","myocardial infarction","stroke","seizure","fracture","laceration","milligrams","micrograms","units","twice daily","three times daily","as needed","before meals","after meals","at bedtime","anterior","posterior","lateral","medial","proximal","distal","superior","inferior","cervical","thoracic","lumbar","sacral","B P","H R","R R","O two sat","E K G","C T scan","M R I","CBC","BMP","CMP","PT","PTT","INR"].forEach(s=>{t.addPhrase(s)}),g("azureSpeechConfig","Debug message",{})}catch{V("azureSpeechConfig","Warning message",{})}}getOptimizedAudioConfig(){return E.AudioConfig.fromDefaultMicrophoneInput()}updateConfig(e){this.config={...this.config,...e},this.initializeSpeechConfig()}async testConnection(){if(!this.speechConfig)return y("azureSpeechConfig","Error message",{}),!1;try{const e=E.AudioConfig.fromDefaultMicrophoneInput(),t=new E.SpeechRecognizer(this.speechConfig,e);return new Promise(r=>{t.sessionStarted=()=>{R("azureSpeechConfig","Info message",{}),t.close(),r(!0)},t.canceled=(s,n)=>{y("azureSpeechConfig","Error message",{}),t.close(),r(!1)},t.startContinuousRecognitionAsync(),setTimeout(()=>{t.stopContinuousRecognitionAsync()},1e3)})}catch{return y("azureSpeechConfig","Error message",{}),!1}}}const W=new Nr;class _r{recognizer=null;conversationTranscriber=null;isRecording=!1;transcriptCallback=null;errorCallback=null;currentMode="DICTATION";constructor(){R("azureSpeechStreamingFixed","Info message",{})}isConfigured(){return W.isConfigured()}async startTranscription(e,t,r,s){if(!this.isConfigured())return V("azureSpeechStreamingFixed","Warning message",{}),this.startWebSpeechFallback(e,t,r);this.currentMode=e,this.transcriptCallback=t,this.errorCallback=r;try{e==="CONVERSATION"?await this.startConversationMode(s):await this.startDictationMode(s),this.isRecording=!0,g("azureSpeechStreamingFixed","Debug message",{})}catch{return y("azureSpeechStreamingFixed","Error message",{}),V("azureSpeechStreamingFixed","Warning message",{}),this.startWebSpeechFallback(e,t,r)}}async startDictationMode(e){if(!W.getSpeechConfig())throw new Error("Speech config not available");const r=W.getOptimizedAudioConfig();if(this.recognizer=W.createDictationRecognizer(r),!this.recognizer)throw new Error("Failed to create recognizer");this.setupRecognizerEvents(this.recognizer),this.recognizer.startContinuousRecognitionAsync(()=>{R("azureSpeechStreamingFixed","Info message",{})},s=>{y("azureSpeechStreamingFixed","Error message",{}),this.errorCallback&&this.errorCallback(new Error(`Failed to start dictation: ${s}`))})}async startConversationMode(e){const t=W.getOptimizedAudioConfig();if(this.conversationTranscriber=W.createConversationTranscriber(t),!this.conversationTranscriber)throw new Error("Failed to create conversation transcriber");this.setupConversationEvents(this.conversationTranscriber),this.conversationTranscriber.startTranscribingAsync(()=>{R("azureSpeechStreamingFixed","Info message",{})},r=>{y("azureSpeechStreamingFixed","Error message",{}),this.errorCallback&&this.errorCallback(new Error(`Failed to start conversation: ${r}`))})}setupRecognizerEvents(e){e.recognizing=(t,r)=>{r.result.reason===E.ResultReason.RecognizingSpeech&&this.transcriptCallback&&this.transcriptCallback({transcript:r.result.text,isPartial:!0,confidence:.8,timestamp:new Date})},e.recognized=(t,r)=>{if(r.result.reason===E.ResultReason.RecognizedSpeech&&this.transcriptCallback){const s=this.extractConfidence(r.result);this.transcriptCallback({transcript:r.result.text,isPartial:!1,confidence:s,timestamp:new Date})}else r.result.reason===E.ResultReason.NoMatch&&g("azureSpeechStreamingFixed","Debug message",{})},e.canceled=(t,r)=>{r.reason===E.CancellationReason.Error&&(y("azureSpeechStreamingFixed","Error message",{}),this.errorCallback&&this.errorCallback(new Error(`Speech recognition error: ${r.errorDetails}`)))},e.sessionStarted=(t,r)=>{g("azureSpeechStreamingFixed","Debug message",{})},e.sessionStopped=(t,r)=>{g("azureSpeechStreamingFixed","Debug message",{})}}setupConversationEvents(e){e.transcribing=(t,r)=>{if(r.result.reason===E.ResultReason.RecognizingSpeech&&this.transcriptCallback){const s=this.mapSpeakerLabel(r.result.speakerId);this.transcriptCallback({transcript:r.result.text,isPartial:!0,speaker:s,confidence:.8,timestamp:new Date})}},e.transcribed=(t,r)=>{if(r.result.reason===E.ResultReason.RecognizedSpeech&&this.transcriptCallback){const s=this.mapSpeakerLabel(r.result.speakerId),n=this.extractConfidence(r.result);this.transcriptCallback({transcript:r.result.text,isPartial:!1,speaker:s,confidence:n,timestamp:new Date})}},e.canceled=(t,r)=>{r.reason===E.CancellationReason.Error&&(y("azureSpeechStreamingFixed","Error message",{}),this.errorCallback&&this.errorCallback(new Error(`Conversation transcription error: ${r.errorDetails}`)))},e.sessionStarted=(t,r)=>{g("azureSpeechStreamingFixed","Debug message",{})},e.sessionStopped=(t,r)=>{g("azureSpeechStreamingFixed","Debug message",{})}}extractConfidence(e){try{const r=JSON.parse(e.json)?.NBest?.[0]?.Confidence;return r?parseFloat(r):.95}catch{return .95}}mapSpeakerLabel(e){return e==="Guest-0"||e==="0"?"CLINICIAN":"PATIENT"}async startWebSpeechFallback(e,t,r){if(!("webkitSpeechRecognition"in window)){r(new Error("Speech recognition not supported in this browser"));return}try{g("azureSpeechStreamingFixed","Debug message",{});const p=await navigator.mediaDevices.getUserMedia({audio:!0});R("azureSpeechStreamingFixed","Info message",{}),p.getTracks().forEach(u=>u.stop())}catch{y("azureSpeechStreamingFixed","Error message",{}),r(new Error("Microphone permission denied. Please allow microphone access and try again."));return}const s=window.webkitSpeechRecognition,n=new s;n.continuous=!0,n.interimResults=!0,n.maxAlternatives=1,n.lang="en-US";let i=e==="CONVERSATION"?"CLINICIAN":"",o=Date.now(),h=0;n.onresult=p=>{g("azureSpeechStreamingFixed","Debug message",{});let u="",S="";for(let P=p.resultIndex;P<p.results.length;P++){const Y=p.results[P][0].transcript;g("azureSpeechStreamingFixed","Debug message",{}),p.results[P].isFinal?u+=Y:S+=Y}if(e==="CONVERSATION"){const P=Date.now();(P-o>3e3||h>50)&&(i=i==="CLINICIAN"?"PATIENT":"CLINICIAN",h=0),o=P,h+=(u+S).split(" ").length}u?(g("azureSpeechStreamingFixed","Debug message",{}),t({transcript:u,isPartial:!1,speaker:e==="CONVERSATION"?i:void 0,confidence:.95,timestamp:new Date})):S&&(g("azureSpeechStreamingFixed","Debug message",{}),t({transcript:S,isPartial:!0,speaker:e==="CONVERSATION"?i:void 0,confidence:.8,timestamp:new Date}))},n.onerror=p=>{p.error!=="no-speech"&&p.error!=="aborted"&&(y("azureSpeechStreamingFixed","Error message",{}),r(new Error(`Speech recognition error: ${p.error}`)))},n.onstart=()=>{R("azureSpeechStreamingFixed","Info message",{})},n.onend=()=>{if(g("azureSpeechStreamingFixed","Debug message",{}),this.isRecording){g("azureSpeechStreamingFixed","Debug message",{});try{n.start()}catch{y("azureSpeechStreamingFixed","Error message",{})}}};try{n.start(),this.isRecording=!0,this.recognition=n,V("azureSpeechStreamingFixed","Warning message",{}),g("azureSpeechStreamingFixed","Debug message",{})}catch(p){y("azureSpeechStreamingFixed","Error message",{}),r(p)}}stop(){if(g("azureSpeechStreamingFixed","Debug message",{}),this.isRecording=!1,this.recognizer&&this.recognizer.stopContinuousRecognitionAsync(()=>{g("azureSpeechStreamingFixed","Debug message",{}),this.recognizer?.close(),this.recognizer=null},e=>{y("azureSpeechStreamingFixed","Error message",{}),this.recognizer?.close(),this.recognizer=null}),this.conversationTranscriber&&this.conversationTranscriber.stopTranscribingAsync(()=>{g("azureSpeechStreamingFixed","Debug message",{}),this.conversationTranscriber?.close(),this.conversationTranscriber=null},e=>{y("azureSpeechStreamingFixed","Error message",{}),this.conversationTranscriber?.close(),this.conversationTranscriber=null}),this.recognition){try{this.recognition.stop(),g("azureSpeechStreamingFixed","Debug message",{})}catch{}this.recognition=null}R("azureSpeechStreamingFixed","Info message",{})}}new _r;class Ar{recognizer=null;isRecording=!1;transcriptCallback=null;errorCallback=null;cumulativeTranscript="";constructor(){R("azureSpeechDictation","Info message",{})}isConfigured(){return W.isConfigured()}async startDictation(e,t,r){if(!this.isConfigured()){t(new Error("Azure Speech Services not configured. Please set Azure credentials."));return}this.transcriptCallback=e,this.errorCallback=t,this.cumulativeTranscript="";try{if(!W.getSpeechConfig())throw new Error("Speech config not available");const n=this.createOptimizedAudioConfig();if(this.recognizer=W.createDictationRecognizer(n),!this.recognizer)throw new Error("Failed to create recognizer");this.configureDictationSettings(),this.setupDictationEvents(),this.recognizer.startContinuousRecognitionAsync(()=>{this.isRecording=!0,g("azureSpeechDictation","Debug message",{})},i=>{y("azureSpeechDictation","Error message",{}),t(new Error(`Failed to start dictation: ${i}`)),this.cleanup()})}catch(s){y("azureSpeechDictation","Error message",{}),t(s),this.cleanup()}}createOptimizedAudioConfig(){return E.AudioConfig.fromDefaultMicrophoneInput()}configureDictationSettings(){if(!this.recognizer)return;const e=W.getSpeechConfig();e&&(e.enableDictation(),e.setProperty(E.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,"5000"),e.setProperty(E.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,"2000"),e.outputFormat=E.OutputFormat.Detailed)}setupDictationEvents(){this.recognizer&&(this.recognizer.recognizing=(e,t)=>{if(t.result.reason===E.ResultReason.RecognizingSpeech&&this.transcriptCallback){const r={transcript:t.result.text,isPartial:!0,confidence:.8,timestamp:new Date().toISOString()};g("azureSpeechDictation","Debug message",{}),this.transcriptCallback(r)}},this.recognizer.recognized=(e,t)=>{if(t.result.reason===E.ResultReason.RecognizedSpeech&&this.transcriptCallback){const r=this.extractConfidence(t.result),s=this.enhanceTextForMedical(t.result.text);this.cumulativeTranscript+=s+" ";const n={transcript:s,isPartial:!1,confidence:r,timestamp:new Date().toISOString()};R("azureSpeechDictation","Info message",{}),this.transcriptCallback(n)}else t.result.reason===E.ResultReason.NoMatch&&g("azureSpeechDictation","Debug message",{})},this.recognizer.canceled=(e,t)=>{g("azureSpeechDictation","Debug message",{}),t.reason===E.CancellationReason.Error&&(y("azureSpeechDictation","Error message",{}),this.errorCallback&&this.errorCallback(new Error(`Speech recognition error: ${t.errorDetails}`)))},this.recognizer.sessionStarted=(e,t)=>{g("azureSpeechDictation","Debug message",{})},this.recognizer.sessionStopped=(e,t)=>{g("azureSpeechDictation","Debug message",{}),this.isRecording=!1},this.recognizer.speechStartDetected=(e,t)=>{g("azureSpeechDictation","Debug message",{})},this.recognizer.speechEndDetected=(e,t)=>{g("azureSpeechDictation","Debug message",{})})}extractConfidence(e){try{const r=JSON.parse(e.json)?.NBest;if(r&&r.length>0){const s=r[0]?.Confidence;return s?parseFloat(s):.95}return .95}catch{return V("azureSpeechDictation","Warning message",{}),.95}}enhanceTextForMedical(e){if(!e)return e;let t=e;return Object.entries({"b p":"BP","h r":"HR","r r":"RR","o two sat":"O2 sat","oxygen sat":"O2 sat","e k g":"EKG","c t scan":"CT scan","m r i":"MRI","c b c":"CBC","b m p":"BMP","c m p":"CMP","beats per minute":"bpm",milligrams:"mg",micrograms:"mcg",temperature:"temp","blood pressure":"blood pressure","heart rate":"heart rate"}).forEach(([n,i])=>{const o=new RegExp(`\\b${n}\\b`,"gi");t=t.replace(o,i)}),["tylenol","ibuprofen","aspirin","metformin","lisinopril","diabetes","hypertension","asthma","copd","pneumonia"].forEach(n=>{const i=new RegExp(`\\b${n}\\b`,"gi");t=t.replace(i,n.charAt(0).toUpperCase()+n.slice(1))}),t}stop(){g("azureSpeechDictation","Debug message",{}),this.isRecording=!1,this.recognizer?this.recognizer.stopContinuousRecognitionAsync(()=>{g("azureSpeechDictation","Debug message",{}),this.cleanup()},e=>{y("azureSpeechDictation","Error message",{}),this.cleanup()}):this.cleanup()}getFullTranscript(){return this.cumulativeTranscript.trim()}clearTranscript(){this.cumulativeTranscript=""}cleanup(){this.recognizer&&(this.recognizer.close(),this.recognizer=null),this.transcriptCallback=null,this.errorCallback=null,this.isRecording=!1,g("azureSpeechDictation","Debug message",{})}isRecordingActive(){return this.isRecording}}new Ar;class Or{conversationTranscriber=null;conversation=null;isRecording=!1;transcriptCallback=null;errorCallback=null;speakerMapping=new Map;nextSpeakerIndex=0;constructor(){R("azureSpeechConversation","Info message",{})}isConfigured(){return W.isConfigured()}async startConversation(e,t,r){if(!this.isConfigured()){t(new Error("Azure Speech Services not configured. Please set Azure credentials."));return}this.transcriptCallback=e,this.errorCallback=t;try{if(!W.getSpeechConfig())throw new Error("Speech config not available");const n=this.createOptimizedAudioConfig();if(this.conversationTranscriber=W.createConversationTranscriber(n),!this.conversationTranscriber)throw new Error("Failed to create conversation transcriber");this.configureConversationSettings(),this.setupConversationEvents(),this.conversationTranscriber.startTranscribingAsync(()=>{this.isRecording=!0,g("azureSpeechConversation","Debug message",{})},i=>{y("azureSpeechConversation","Error message",{}),t(new Error(`Failed to start conversation: ${i}`)),this.cleanup()})}catch(s){y("azureSpeechConversation","Error message",{}),t(s),this.cleanup()}}createOptimizedAudioConfig(){return E.AudioConfig.fromDefaultMicrophoneInput()}configureConversationSettings(){const e=W.getSpeechConfig();e&&(e.setProperty(E.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,"5000"),e.setProperty(E.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,"1000"),e.outputFormat=E.OutputFormat.Detailed,e.setProperty("SpeechServiceConnection_LanguageIdMode","Continuous"))}setupConversationEvents(){this.conversationTranscriber&&(this.conversationTranscriber.transcribing=(e,t)=>{if(t.result.reason===E.ResultReason.RecognizingSpeech&&this.transcriptCallback){const r=this.identifySpeaker(t.result.speakerId),s={transcript:t.result.text,isPartial:!0,speaker:r,confidence:.8,timestamp:new Date().toISOString()};g("azureSpeechConversation","Debug message",{}),this.transcriptCallback(s)}},this.conversationTranscriber.transcribed=(e,t)=>{if(t.result.reason===E.ResultReason.RecognizedSpeech&&this.transcriptCallback){const r=this.identifySpeaker(t.result.speakerId),s=this.extractConfidence(t.result),i={transcript:this.enhanceTextForMedical(t.result.text),isPartial:!1,speaker:r,confidence:s,timestamp:new Date().toISOString()};R("azureSpeechConversation","Info message",{}),this.transcriptCallback(i)}else t.result.reason===E.ResultReason.NoMatch&&g("azureSpeechConversation","Debug message",{})},this.conversationTranscriber.canceled=(e,t)=>{g("azureSpeechConversation","Debug message",{}),t.reason===E.CancellationReason.Error&&(y("azureSpeechConversation","Error message",{}),this.errorCallback&&this.errorCallback(new Error(`Conversation transcription error: ${t.errorDetails}`)))},this.conversationTranscriber.sessionStarted=(e,t)=>{g("azureSpeechConversation","Debug message",{})},this.conversationTranscriber.sessionStopped=(e,t)=>{g("azureSpeechConversation","Debug message",{}),this.isRecording=!1},this.conversationTranscriber.participantAdded=(e,t)=>{g("azureSpeechConversation","Debug message",{}),this.mapParticipantToRole(t.participant.id)},this.conversationTranscriber.participantRemoved=(e,t)=>{g("azureSpeechConversation","Debug message",{}),this.speakerMapping.delete(t.participant.id)})}identifySpeaker(e){return e?this.speakerMapping.has(e)?this.speakerMapping.get(e):this.mapParticipantToRole(e):"CLINICIAN"}mapParticipantToRole(e){const t=this.nextSpeakerIndex===0?"CLINICIAN":"PATIENT";return this.speakerMapping.set(e,t),this.nextSpeakerIndex=(this.nextSpeakerIndex+1)%2,g("azureSpeechConversation","Debug message",{}),t}extractConfidence(e){try{const r=JSON.parse(e.json)?.NBest;if(r&&r.length>0){const s=r[0]?.Confidence;return s?parseFloat(s):.95}return .95}catch{return V("azureSpeechConversation","Warning message",{}),.95}}enhanceTextForMedical(e){if(!e)return e;let t=e;return Object.entries({"b p":"BP","h r":"HR","r r":"RR","o two sat":"O2 sat","oxygen sat":"O2 sat","e k g":"EKG","c t scan":"CT scan","m r i":"MRI","c b c":"CBC","b m p":"BMP","c m p":"CMP","beats per minute":"bpm",milligrams:"mg",micrograms:"mcg"}).forEach(([s,n])=>{const i=new RegExp(`\\b${s}\\b`,"gi");t=t.replace(i,n)}),t}assignSpeakerRole(e,t){this.speakerMapping.set(e,t),g("azureSpeechConversation","Debug message",{})}getSpeakerMappings(){return new Map(this.speakerMapping)}stop(){g("azureSpeechConversation","Debug message",{}),this.isRecording=!1,this.conversationTranscriber?this.conversationTranscriber.stopTranscribingAsync(()=>{g("azureSpeechConversation","Debug message",{}),this.cleanup()},e=>{y("azureSpeechConversation","Error message",{}),this.cleanup()}):this.cleanup()}isRecordingActive(){return this.isRecording}cleanup(){this.conversationTranscriber&&(this.conversationTranscriber.close(),this.conversationTranscriber=null),this.conversation&&(this.conversation.close(),this.conversation=null),this.speakerMapping.clear(),this.nextSpeakerIndex=0,this.transcriptCallback=null,this.errorCallback=null,this.isRecording=!1,g("azureSpeechConversation","Debug message",{})}}new Or;class Ir{conversationTranscriber=null;isRecording=!1;transcriptCallback=null;errorCallback=null;speakerMapping=new Map;speakerCount=0;constructor(){R("azureSpeechAmbient","Info message",{})}isConfigured(){return W.isConfigured()}async startConversation(e,t){if(!this.isConfigured())return V("azureSpeechAmbient","Warning message",{}),this.fallbackToWebSpeech(e,t);this.transcriptCallback=e,this.errorCallback=t;try{const r=this.createAmbientAudioConfig();if(this.conversationTranscriber=W.createConversationTranscriber(r),!this.conversationTranscriber)throw new Error("Failed to create conversation transcriber");this.configureAmbientSettings(),this.setupAmbientEvents(),this.conversationTranscriber.startTranscribingAsync(()=>{this.isRecording=!0,g("azureSpeechAmbient","Debug message",{})},s=>{y("azureSpeechAmbient","Error message",{}),t(new Error(`Failed to start ambient conversation: ${s}`)),this.cleanup()})}catch{return y("azureSpeechAmbient","Error message",{}),V("azureSpeechAmbient","Warning message",{}),this.fallbackToWebSpeech(e,t)}}createAmbientAudioConfig(){return E.AudioConfig.fromDefaultMicrophoneInput()}configureAmbientSettings(){const e=W.getSpeechConfig();e&&(e.setProperty(E.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,"10000"),e.setProperty(E.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,"500"),e.setProperty("SpeechServiceConnection_Mode","Conversation"),e.setProperty("ConversationTranscriptionInRoomAndOnline","true"))}setupAmbientEvents(){this.conversationTranscriber&&(this.conversationTranscriber.transcribing=(e,t)=>{if(t.result.reason===E.ResultReason.RecognizingSpeech&&this.transcriptCallback){const r=this.getSpeakerLabel(t.result.speakerId);this.transcriptCallback({transcript:t.result.text,isPartial:!0,speaker:r,confidence:.8,timestamp:new Date().toISOString()})}},this.conversationTranscriber.transcribed=(e,t)=>{if(t.result.reason===E.ResultReason.RecognizedSpeech&&this.transcriptCallback){const r=this.getSpeakerLabel(t.result.speakerId),s=this.extractConfidence(t.result);g("azureSpeechAmbient","Debug message",{}),this.transcriptCallback({transcript:t.result.text,isPartial:!1,speaker:r,confidence:s,timestamp:new Date().toISOString()})}},this.conversationTranscriber.canceled=(e,t)=>{t.reason===E.CancellationReason.Error&&(y("azureSpeechAmbient","Error message",{}),this.errorCallback&&t.errorDetails!=="No speech was detected"&&this.errorCallback(new Error(`Ambient conversation error: ${t.errorDetails}`)))},this.conversationTranscriber.sessionStarted=(e,t)=>{g("azureSpeechAmbient","Debug message",{})},this.conversationTranscriber.sessionStopped=(e,t)=>{g("azureSpeechAmbient","Debug message",{}),this.isRecording=!1},this.conversationTranscriber.participantAdded=(e,t)=>{this.addSpeaker(t.participant.id),g("azureSpeechAmbient","Debug message",{})},this.conversationTranscriber.participantRemoved=(e,t)=>{g("azureSpeechAmbient","Debug message",{})})}getSpeakerLabel(e){return e?this.speakerMapping.has(e)?this.speakerMapping.get(e):this.addSpeaker(e):"Speaker_1"}addSpeaker(e){this.speakerCount++;const t=`Speaker_${this.speakerCount}`;return this.speakerMapping.set(e,t),t}extractConfidence(e){try{const r=JSON.parse(e.json)?.NBest?.[0]?.Confidence;return r?parseFloat(r):.95}catch{return .95}}async fallbackToWebSpeech(e,t){if(!("webkitSpeechRecognition"in window)){t(new Error("Speech recognition not supported"));return}const r=window.webkitSpeechRecognition,s=new r;s.continuous=!0,s.interimResults=!0,s.maxAlternatives=1;let n="Speaker_1",i,o=0;s.onresult=h=>{let p="",u="";for(let S=h.resultIndex;S<h.results.length;S++){const P=h.results[S][0].transcript;h.results[S].isFinal?p+=P:u+=P}clearTimeout(i),i=setTimeout(()=>{n=n==="Speaker_1"?"Speaker_2":"Speaker_1",o=0},3e3),o+=(p+u).split(" ").length,o>50&&(n=n==="Speaker_1"?"Speaker_2":"Speaker_1",o=0),p?e({transcript:p,isPartial:!1,speaker:n,confidence:.95,timestamp:new Date().toISOString()}):u&&e({transcript:u,isPartial:!0,speaker:n,confidence:.8,timestamp:new Date().toISOString()})},s.onerror=h=>{y("azureSpeechAmbient","Error message",{}),h.error!=="no-speech"&&t(new Error(`Speech recognition error: ${h.error}`))},s.onend=()=>{this.isRecording&&s.start()},s.start(),this.isRecording=!0,this.recognition=s,V("azureSpeechAmbient","Warning message",{})}stop(){g("azureSpeechAmbient","Debug message",{}),this.isRecording=!1,this.conversationTranscriber&&this.conversationTranscriber.stopTranscribingAsync(()=>{g("azureSpeechAmbient","Debug message",{}),this.cleanup()},e=>{y("azureSpeechAmbient","Error message",{}),this.cleanup()}),this.recognition&&this.recognition.stop(),this.cleanup()}getSpeakers(){return new Map(this.speakerMapping)}resetSpeakers(){this.speakerMapping.clear(),this.speakerCount=0}cleanup(){this.conversationTranscriber&&(this.conversationTranscriber.close(),this.conversationTranscriber=null),this.speakerMapping.clear(),this.speakerCount=0,this.transcriptCallback=null,this.errorCallback=null,this.isRecording=!1,g("azureSpeechAmbient","Debug message",{})}}new Ir;class zr{recognizer=null;isRecording=!1;currentTranscript="";constructor(){R("azureSpeechSimple","Info message",{})}async startRecording(e,t){if(!W.isConfigured())return t("Azure Speech Services not configured. Please set VITE_AZURE_SPEECH_KEY and VITE_AZURE_SPEECH_REGION environment variables."),!1;try{if(g("azureSpeechSimple","Debug message",{}),!W.getSpeechConfig())throw new Error("Failed to get speech configuration");const s=W.getOptimizedAudioConfig();if(this.recognizer=W.createDictationRecognizer(s),!this.recognizer)throw new Error("Failed to create speech recognizer");return this.currentTranscript="",this.isRecording=!0,R("azureSpeechSimple","Info message",{}),this.setupEventHandlers(e,t),this.recognizer.startContinuousRecognitionAsync(()=>{R("azureSpeechSimple","Info message",{})},n=>{y("azureSpeechSimple","Error message",{}),t(`Failed to start recognition: ${n}`),this.cleanup()}),!0}catch(r){y("azureSpeechSimple","Error message",{});let s="Azure Speech Services error: ";return r.message?.includes("Invalid subscription key")?s+="Invalid subscription key. Please check your VITE_AZURE_SPEECH_KEY.":r.message?.includes("Invalid region")?s+="Invalid region. Please check your VITE_AZURE_SPEECH_REGION.":r.message?.includes("Forbidden")?s+="Access forbidden. Your Azure subscription may not have Speech Services enabled.":r.message?.includes("Network")?s+="Network error. Please check your internet connection.":s+=r.message||"Failed to start recording",t(s),this.cleanup(),!1}}setupEventHandlers(e,t){this.recognizer&&(this.recognizer.recognizing=(r,s)=>{if(s.result.reason===E.ResultReason.RecognizingSpeech){const n=this.enhanceTranscript(s.result.text);g("azureSpeechSimple","Debug message",{}),e(n,!1)}},this.recognizer.recognized=(r,s)=>{if(s.result.reason===E.ResultReason.RecognizedSpeech){const n=this.enhanceTranscript(s.result.text);this.currentTranscript+=n+" ",this.extractConfidence(s.result),R("azureSpeechSimple","Info message",{}),e(n,!0)}else s.result.reason===E.ResultReason.NoMatch&&g("azureSpeechSimple","Debug message",{})},this.recognizer.canceled=(r,s)=>{g("azureSpeechSimple","Debug message",{}),s.reason===E.CancellationReason.Error&&(y("azureSpeechSimple","Error message",{}),s.errorDetails.includes("1006")?t("Connection lost. Please check your internet connection and try again."):s.errorDetails.includes("Forbidden")?t("Access denied. Please check your Azure Speech Services subscription."):t(`Recognition error: ${s.errorDetails}`))},this.recognizer.sessionStarted=(r,s)=>{g("azureSpeechSimple","Debug message",{})},this.recognizer.sessionStopped=(r,s)=>{g("azureSpeechSimple","Debug message",{}),this.isRecording=!1},this.recognizer.speechStartDetected=(r,s)=>{g("azureSpeechSimple","Debug message",{})},this.recognizer.speechEndDetected=(r,s)=>{g("azureSpeechSimple","Debug message",{})})}extractConfidence(e){try{const r=JSON.parse(e.json)?.NBest;if(r&&r.length>0){const s=r[0]?.Confidence;return s?parseFloat(s):.95}return .95}catch{return V("azureSpeechSimple","Warning message",{}),.95}}enhanceTranscript(e){if(!e)return e;let t=e;return Object.entries({"b p":"BP","blood pressure":"blood pressure","h r":"HR","heart rate":"heart rate","r r":"RR","respiratory rate":"respiratory rate","o two sat":"O2 sat","oxygen saturation":"O2 sat","e k g":"EKG","c t scan":"CT scan","m r i":"MRI","c b c":"CBC","b m p":"BMP","c m p":"CMP","beats per minute":"bpm","breaths per minute":"bpm",milligrams:"mg",milligram:"mg",micrograms:"mcg",microgram:"mcg",temperature:"temp","degrees fahrenheit":"°F","degrees celsius":"°C"}).forEach(([n,i])=>{const o=new RegExp(`\\b${n}\\b`,"gi");t=t.replace(o,i)}),["tylenol","acetaminophen","ibuprofen","aspirin","metformin","lisinopril","atorvastatin","amlodipine","omeprazole","diabetes","hypertension","hyperlipidemia","asthma","copd","pneumonia","bronchitis","sinusitis","pharyngitis"].forEach(n=>{const i=new RegExp(`\\b${n}\\b`,"gi");t=t.replace(i,n.charAt(0).toUpperCase()+n.slice(1))}),t}stopRecording(){return g("azureSpeechSimple","Debug message",{}),this.isRecording=!1,this.recognizer&&this.recognizer.stopContinuousRecognitionAsync(()=>{g("azureSpeechSimple","Debug message",{}),this.cleanup()},e=>{y("azureSpeechSimple","Error message",{}),this.cleanup()}),R("azureSpeechSimple","Info message",{}),this.currentTranscript}cleanup(){this.recognizer&&(this.recognizer.close(),this.recognizer=null),this.isRecording=!1,g("azureSpeechSimple","Debug message",{})}isInitialized(){return W.isConfigured()}isConfigured(){return W.isConfigured()}stop(){this.stopRecording()}getCurrentTranscript(){return this.currentTranscript}clearTranscript(){this.currentTranscript=""}isRecordingActive(){return this.isRecording}}new zr;class Pr{primaryProvider="deepgram";constructor(){this.primaryProvider="deepgram",R("speechServiceRouter",`Primary STT provider: ${this.primaryProvider}`)}getStreamingService(){if(this.primaryProvider==="deepgram"&&ye.isConfigured())return R("speechServiceRouter","Using Deepgram SDK for streaming (primary)"),ye;if(this.primaryProvider==="deepgram"&&ve.isConfigured())return R("speechServiceRouter","Using Deepgram Adapter for streaming (fallback)"),ve;if(this.primaryProvider==="aws"&&be.isConfigured())return R("speechServiceRouter","Using AWS Transcribe Medical for streaming"),be;if(ye.isConfigured())return V("speechServiceRouter","Falling back to Deepgram SDK"),ye;if(ve.isConfigured())return V("speechServiceRouter","Falling back to Deepgram Adapter"),ve;if(be.isConfigured())return V("speechServiceRouter","Falling back to AWS Transcribe Medical (last resort)"),be;throw y("speechServiceRouter","No speech services available - Azure out of credits, check Deepgram/AWS config"),new Error("No speech transcription services available")}getDictationService(){return this.getStreamingService()}getConversationService(){return this.getStreamingService()}getAmbientService(){return this.getStreamingService()}getSimpleService(){return this.getStreamingService()}isAnyServiceAvailable(){return ye.isConfigured()||ve.isConfigured()||be.isConfigured()||nt.isInitialized()}getServiceStatus(){return{primaryProvider:this.primaryProvider,deepgram:{sdk:ye.isConfigured(),adapter:ve.isConfigured()},aws:{streaming:be.isConfigured(),simple:nt.isInitialized()},azure:{status:"DISABLED - Out of credits/quota issues",streaming:!1,dictation:!1,conversation:!1,ambient:!1,simple:!1}}}setPrimaryProvider(e){this.primaryProvider=e,g("speechServiceRouter",`Primary provider switched to: ${e}`,{})}async startRecording(e,t){try{const r=this.getStreamingService();if(this.primaryProvider==="deepgram"){const s=e==="dictation"?"DICTATION":"CONVERSATION";return await r.startTranscription(s,n=>{t.onTranscript(n.transcript,!n.isPartial)},n=>{t.onError(n.message)}),!0}else return r.startRecording?await r.startRecording((s,n)=>t.onTranscript(s,n),s=>t.onError(s)):!1}catch(r){return y("speechServiceRouter","Error message",{}),t.onError(r instanceof Error?r.message:"Unknown error"),!1}}stopRecording(){const e=this.getStreamingService();e.stopRecording?e.stopRecording():e.stop()}}const Ke=new Pr;class Mr{client;audioStream=null;audioContext=null;processor=null;isRecording=!1;onTranscript=null;onError=null;currentConfig={mode:"DICTATION",specialty:"PRIMARYCARE",enableSpeakerDiarization:!1};constructor(){const e="us-east-1";V("awsTranscribe","Warning message",{}),this.client=new Ot({region:e,credentials:{accessKeyId:"not-configured",secretAccessKey:"not-configured"}})}isConfigured(){return g("awsTranscribe","Debug message",{}),!1}async startTranscription(e={},t,r){if(this.onTranscript=t,this.onError=r,!this.isConfigured()){V("awsTranscribe","Warning message",{});try{this.audioStream=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:16e3,echoCancellation:!0,noiseSuppression:!0}}),this.isRecording=!0,t&&t({transcript:"[Recording audio - real-time transcription unavailable]",isPartial:!0});return}catch(s){y("awsTranscribe","Error message",{}),r(s);return}}this.currentConfig={...this.currentConfig,...e};try{this.audioStream=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:16e3,echoCancellation:!0,noiseSuppression:!0}}),this.audioContext=new AudioContext({sampleRate:16e3});const s=this.audioContext.createMediaStreamSource(this.audioStream);this.processor=this.audioContext.createScriptProcessor(4096,1,1),s.connect(this.processor),this.processor.connect(this.audioContext.destination);try{g("awsTranscribe","Debug message",{}),await this.startAWSTranscribeStream(),this.isRecording=!0,g("awsTranscribe","Debug message",{})}catch{y("awsTranscribe","Error message",{}),y("awsTranscribe","Error message",{}),this.isRecording=!0,t&&t({transcript:"[Recording audio - real-time transcription unavailable]",isPartial:!0})}}catch{y("awsTranscribe","Error message",{});try{this.audioStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}}),this.isRecording=!0,t&&t({transcript:"[Recording audio...]",isPartial:!0})}catch(n){y("awsTranscribe","Error message",{}),r(n),this.cleanup()}}}async startAWSTranscribeStream(){const e=new It({LanguageCode:"en-US",MediaEncoding:"pcm",MediaSampleRateHertz:16e3,Specialty:this.currentConfig.specialty,Type:this.currentConfig.mode,ContentIdentificationType:zt.PHI,ShowSpeakerLabel:this.currentConfig.mode==="CONVERSATION",NumberOfChannels:1,EnableChannelIdentification:!1});try{const t=await this.client.send(e);t.TranscriptResultStream&&this.processTranscriptStream(t.TranscriptResultStream),this.processor&&(this.processor.onaudioprocess=r=>{if(this.isRecording){const s=r.inputBuffer.getChannelData(0),n=this.float32ToPCM16(s);this.sendAudioChunk(n)}})}catch(t){throw y("awsTranscribe","Error message",{}),t}}async processTranscriptStream(e){try{if(!e||typeof e[Symbol.asyncIterator]!="function"){y("awsTranscribe","Error message",{});return}for await(const t of e)if(t.TranscriptEvent?.Transcript?.Results){for(const r of t.TranscriptEvent.Transcript.Results)if(!r.IsPartial&&r.Alternatives&&r.Alternatives[0]){const s=r.Alternatives[0],n=s.Items||[];let i="",o="";for(const h of n)if(h.Content){if(this.currentConfig.mode==="CONVERSATION"&&h.Speaker){const p=`Speaker_${h.Speaker}`;p!==o&&(i&&(i+=`
`),i+=`[${p==="Speaker_0"?"DOCTOR":"PATIENT"}]: `,o=p)}i+=h.Content+" "}this.onTranscript&&i.trim()&&this.onTranscript({transcript:i.trim(),isPartial:!1,confidence:s.Transcript?.95:0,speaker:o})}else if(r.IsPartial&&r.Alternatives&&r.Alternatives[0]){const s=r.Alternatives[0];this.onTranscript&&s.Transcript&&this.onTranscript({transcript:s.Transcript,isPartial:!0,confidence:0})}}}catch(t){y("awsTranscribe","Error message",{}),this.onError&&this.onError(t)}}float32ToPCM16(e){const t=new ArrayBuffer(e.length*2),r=new DataView(t);let s=0;for(let n=0;n<e.length;n++,s+=2){const i=Math.max(-1,Math.min(1,e[n]));r.setInt16(s,i<0?i*32768:i*32767,!0)}return t}sendAudioChunk(e){g("awsTranscribe","Debug message",{})}stopTranscription(){this.isRecording=!1,this.cleanup(),g("awsTranscribe","Debug message",{})}cleanup(){this.processor&&(this.processor.disconnect(),this.processor=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),this.audioStream=null),this.onTranscript=null,this.onError=null}setMode(e){this.currentConfig.mode=e,this.currentConfig.enableSpeakerDiarization=e==="CONVERSATION"}setSpecialty(e){this.currentConfig.specialty=e}}new Mr;const Re="https://tshla-schedule-api-container.redpebble-e4551b7a.eastus.azurecontainerapps.io";class Ur{authToken=null;constructor(){this.authToken=localStorage.getItem("auth_token")}getHeaders(){const e={"Content-Type":"application/json"};return this.authToken&&(e.Authorization=`Bearer ${this.authToken}`),e}async saveDictatedNote(e){try{const t=await fetch(`${Re}/api/dictated-notes`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({...e,visit_date:e.visit_date||new Date().toISOString().split("T")[0],note_title:e.note_title||`Note for ${e.patient_name}`,status:e.status||"draft"})});if(!t.ok)throw new Error(`Failed to save note: ${t.statusText}`);const r=await t.json();return R("dictatedNotesService","Info message",{}),r.noteId}catch(t){throw y("dictatedNotesService","Error message",{}),t}}async getProviderNotes(e,t={}){try{const r=new URLSearchParams;t.limit&&r.append("limit",t.limit.toString()),t.offset&&r.append("offset",t.offset.toString()),t.status&&r.append("status",t.status),t.startDate&&r.append("startDate",t.startDate),t.endDate&&r.append("endDate",t.endDate);const s=r.toString(),n=`${Re}/api/providers/${e}/notes${s?`?${s}`:""}`,i=await fetch(n,{method:"GET",headers:this.getHeaders()});if(!i.ok)throw new Error(`Failed to fetch notes: ${i.statusText}`);return(await i.json()).notes||[]}catch(r){throw y("dictatedNotesService","Error message",{}),r}}async getNoteDetails(e){try{const t=await fetch(`${Re}/api/notes/${e}`,{method:"GET",headers:this.getHeaders()});if(!t.ok)throw new Error(`Failed to fetch note details: ${t.statusText}`);const r=await t.json();return{note:r.note,versions:r.versions||[],comments:r.comments||[]}}catch(t){throw y("dictatedNotesService","Error message",{}),t}}async updateNote(e,t){try{const r=await fetch(`${Re}/api/notes/${e}`,{method:"PUT",headers:this.getHeaders(),body:JSON.stringify(t)});if(!r.ok)throw new Error(`Failed to update note: ${r.statusText}`);return(await r.json()).version}catch(r){throw y("dictatedNotesService","Error message",{}),r}}async searchNotes(e){try{const t=new URLSearchParams;Object.entries(e).forEach(([o,h])=>{h&&t.append(o,h)});const r=t.toString(),s=`${Re}/api/notes/search${r?`?${r}`:""}`,n=await fetch(s,{method:"GET",headers:this.getHeaders()});if(!n.ok)throw new Error(`Failed to search notes: ${n.statusText}`);return(await n.json()).results||[]}catch(t){throw y("dictatedNotesService","Error message",{}),t}}async saveFromDictationSession(e){const t={provider_id:e.providerId,provider_name:e.providerName,provider_email:e.providerEmail,patient_name:e.patientDetails.name||"Unknown Patient",patient_phone:e.patientDetails.phone||"",patient_email:e.patientDetails.email,patient_mrn:e.patientDetails.mrn,appointment_id:e.appointmentId,raw_transcript:e.transcript,processed_note:e.processedNote,recording_mode:e.recordingMode,template_id:e.selectedTemplate?.id,template_name:e.selectedTemplate?.name,template_sections:e.selectedTemplate?.sections,ai_model_used:"claude-3-5-sonnet",status:"draft"};return this.saveDictatedNote(t)}async getRecentNotes(e,t=7){const r=new Date().toISOString().split("T")[0],s=new Date(Date.now()-t*24*60*60*1e3).toISOString().split("T")[0];return this.getProviderNotes(e,{startDate:s,endDate:r,limit:20})}async getNotesRequiringReview(e){return this.getProviderNotes(e,{status:"pending-review",limit:50})}async signNote(e,t,r){return this.updateNote(e,{status:"signed",updated_by_provider_id:t,updated_by_provider_name:r,change_description:"Note signed by provider"})}async getPatientNotes(e,t){return this.searchNotes({patient_name:e,provider_id:t})}formatStatus(e){return{draft:"Draft","pending-review":"Pending Review",reviewed:"Reviewed",final:"Final",signed:"Signed",amended:"Amended",cancelled:"Cancelled"}[e]||e}getStatusColor(e){return{draft:"gray","pending-review":"yellow",reviewed:"blue",final:"green",signed:"green",amended:"orange",cancelled:"red"}[e]||"gray"}estimateReadingTime(e){const r=e.split(/\s+/).length;return Math.ceil(r/200)}extractKeyInfo(e){return{patientInfo:`${e.patient_name}${e.patient_phone?` • ${e.patient_phone}`:""}`,visitInfo:`${this.formatVisitType(e.visit_type)} • ${this.formatDate(e.visit_date)}`,duration:this.formatDuration(e.recording_duration_seconds),wordCount:e.processed_note.split(/\s+/).length}}formatVisitType(e){return{"new-patient":"New Patient","follow-up":"Follow-up",consultation:"Consultation",emergency:"Emergency","annual-exam":"Annual Exam",other:"Other"}[e]||e}formatDate(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}formatDuration(e){if(e<60)return`${e}s`;const t=Math.floor(e/60),r=e%60;return r>0?`${t}m ${r}s`:`${t}m`}}new Ur;const ze="https://tshla-schedule-api-container.redpebble-e4551b7a.eastus.azurecontainerapps.io";class $r{authToken=null;constructor(){this.authToken=localStorage.getItem("auth_token")}getHeaders(){const e={"Content-Type":"application/json"};return this.authToken&&(e.Authorization=`Bearer ${this.authToken}`),e}async getProviderSchedule(e,t,r,s){try{const n=new URLSearchParams;t&&n.append("date",t),r&&n.append("startDate",r),s&&n.append("endDate",s);const i=n.toString(),o=`${ze}/api/providers/${e}/schedule${i?`?${i}`:""}`,h=await fetch(o,{method:"GET",headers:this.getHeaders()});if(!h.ok)throw new Error(`Failed to fetch schedule: ${h.statusText}`);return(await h.json()).appointments||[]}catch(n){throw y("scheduleService","Error message",{}),n}}async createAppointment(e){try{const t=await fetch(`${ze}/api/appointments`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)});if(!t.ok)throw new Error(`Failed to create appointment: ${t.statusText}`);return(await t.json()).appointmentId}catch(t){throw y("scheduleService","Error message",{}),t}}async updateAppointment(e,t){try{const r=await fetch(`${ze}/api/appointments/${e}`,{method:"PUT",headers:this.getHeaders(),body:JSON.stringify(t)});if(!r.ok)throw new Error(`Failed to update appointment: ${r.statusText}`)}catch(r){throw y("scheduleService","Error message",{}),r}}async getTodaysSchedule(){try{const e=await fetch(`${ze}/api/schedule/today`,{method:"GET",headers:this.getHeaders()});if(!e.ok)throw new Error(`Failed to fetch today's schedule: ${e.statusText}`);return(await e.json()).schedule||[]}catch(e){throw y("scheduleService","Error message",{}),e}}async getProviderTodaySchedule(e){const t=new Date().toISOString().split("T")[0];return this.getProviderSchedule(e,t)}async getProviderWeeklySchedule(e,t){const r=t||this.getStartOfWeek(new Date),s=new Date(r);s.setDate(r.getDate()+6);const n=r.toISOString().split("T")[0],i=s.toISOString().split("T")[0];return this.getProviderSchedule(e,void 0,n,i)}async completeAppointment(e){return this.updateAppointment(e,{status:"completed",updated_at:new Date().toISOString()})}async cancelAppointment(e,t){const r={status:"cancelled",updated_at:new Date().toISOString()};return t&&(r.provider_notes=t),this.updateAppointment(e,r)}async createQuickAppointment(e,t,r,s,n){const i=new Date,o=i.toISOString().split("T")[0],h=i.toTimeString().slice(0,5),p=new Date(i.getTime()+30*6e4).toTimeString().slice(0,5),u={provider_id:e,provider_name:t,patient_name:r,patient_phone:s,appointment_type:"follow-up",appointment_title:`Quick Note - ${r}`,scheduled_date:o,start_time:h,end_time:p,chief_complaint:n,urgency_level:"routine",is_telehealth:!1};return this.createAppointment(u)}getStartOfWeek(e){const t=new Date(e),r=t.getDay(),s=t.getDate()-r+(r===0?-6:1);return new Date(t.setDate(s))}formatTime(e){const[t,r]=e.split(":"),s=parseInt(t),n=s>=12?"PM":"AM";return`${s===0?12:s>12?s-12:s}:${r} ${n}`}formatDate(e){return new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}getAppointmentDuration(e,t){const r=new Date(`2000-01-01T${e}`),s=new Date(`2000-01-01T${t}`);return Math.round((s.getTime()-r.getTime())/6e4)}}new $r;function Fr({content:a}){const e=i=>{const o=i.split(`
`),h=[];let p=[],u=0;for(let S=0;S<o.length;S++){const P=o[S].trim();if(P.startsWith("###")){p.length>0&&(h.push(c.jsx("div",{className:"mb-4",children:t(p.join(`
`))},`section-${u}`)),u++,p=[]);const Y=P.replace(/^###\s*/,"");h.push(c.jsxs("h3",{className:"text-lg font-bold text-blue-800 border-b-2 border-blue-200 pb-2 mb-3 mt-6",children:[n(Y)," ",Y]},`header-${u}`)),u++}else p.push(P)}return p.length>0&&h.push(c.jsx("div",{className:"mb-4",children:t(p.join(`
`))},`section-${u}`)),h},t=i=>i.split(`
`).filter(h=>h.trim()).map((h,p)=>{const u=h.trim();if(u.match(/^Assessment\s*\/\s*Plan$/i))return c.jsx("h4",{className:"font-bold text-gray-900 mt-3 mb-2 text-base",children:u},p);if(u.match(/^[A-Z0-9]+:/)&&u.length<30){const[S,...P]=u.split(":");return c.jsxs("div",{className:"mb-2",children:[c.jsxs("span",{className:"font-bold text-purple-700 mr-2",children:[S,":"]}),c.jsx("span",{className:"text-gray-700",children:P.join(":").trim()})]},p)}if(u.match(/^[A-Z]\d{2}\.?\d*/)){const[S,...P]=u.split(":");return c.jsxs("div",{className:"ml-4 mb-1",children:[c.jsx("span",{className:"inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm font-mono mr-2",children:S.trim()}),c.jsx("span",{className:"text-gray-700",children:P.join(":").trim()})]},p)}return u.match(/^\d+\./)?c.jsxs("div",{className:"ml-4 mb-2 flex",children:[c.jsx("span",{className:"text-blue-600 font-semibold mr-2",children:u.match(/^\d+\./)[0]}),c.jsx("span",{className:"text-gray-700 flex-1",children:u.replace(/^\d+\.\s*/,"")})]},p):u.startsWith("•")||u.startsWith("-")?c.jsxs("div",{className:"ml-4 mb-1 flex",children:[c.jsx("span",{className:"text-green-600 mr-2",children:"•"}),c.jsx("span",{className:"text-gray-700 flex-1",children:u.replace(/^[•-]\s*/,"")})]},p):u.match(/\d+\s*(mg|ml|units|mcg|%|mmHg)/i)?c.jsx("div",{className:"ml-4 mb-1",children:c.jsx("span",{className:"text-gray-700",children:r(u)})},p):u.match(/(mg|mcg|units?|tablet|capsule|injection|daily|twice|three times)/i)?c.jsx("div",{className:"ml-4 mb-2 bg-blue-50 border-l-4 border-blue-400 p-2",children:c.jsx("span",{className:"text-gray-800",children:s(u)})},p):u.match(/A1[Cc].*:\s*\d/)?c.jsxs("div",{className:"ml-4 mb-1",children:[c.jsx("span",{className:"font-semibold text-orange-600",children:"A1C: "}),c.jsx("span",{className:"text-gray-700",children:u.replace(/A1[Cc].*?:\s*/,"")})]},p):u.toLowerCase().includes("return")&&u.toLowerCase().includes("office")?c.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:c.jsxs("span",{className:"text-gray-800 font-medium",children:["📅 ",u]})},p):c.jsx("p",{className:"text-gray-700 mb-2 leading-relaxed",children:u},p)}),r=i=>{const o=i.split(/(\d+\.?\d*\s*(?:mg|ml|units|mcg|%|mmHg))/gi);return c.jsx(c.Fragment,{children:o.map((h,p)=>h.match(/\d+\.?\d*\s*(?:mg|ml|units|mcg|%|mmHg)/i)?c.jsx("span",{className:"font-semibold text-indigo-600 bg-indigo-50 px-1 rounded",children:h},p):c.jsx("span",{children:h},p))})},s=i=>{const o=i.split(/^([A-Za-z]+(?:\s+[A-Za-z]+)?)\s*/);return o.length>1?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"font-bold text-blue-700",children:o[1]}),c.jsx("span",{children:r(o.slice(2).join(""))})]}):c.jsx(c.Fragment,{children:r(i)})},n=i=>{const o=i.toLowerCase();return o.includes("presenting")?"🏥":o.includes("diabetes")||o.includes("t1d")?"🩺":o.includes("hypertension")||o.includes("htn")?"❤️":o.includes("mental")||o.includes("depression")?"🧠":o.includes("vitamin")?"💊":o.includes("lipid")||o.includes("cholesterol")?"🫀":o.includes("assessment")||o.includes("plan")?"📋":o.includes("pump")||o.includes("insulin")?"💉":o.includes("monitoring")?"📊":o.includes("management")?"⚕️":o.includes("problem list")||o.includes("icd")?"📝":o.includes("laboratory")||o.includes("lab")?"🧪":o.includes("prescription")?"💊":o.includes("return")||o.includes("follow")?"📅":"📌"};return c.jsx("div",{className:"prose prose-sm max-w-none",children:c.jsx("div",{className:"bg-white rounded-lg p-6",children:e(a)})})}function es({patientId:a,preloadPatientData:e=!1}){const t=_t(),[r,s]=U.useState(!1),[n,i]=U.useState(""),[o,h]=U.useState(""),[p,u]=U.useState(""),[S,P]=U.useState(!1),[Y,ee]=U.useState(!1),[$,te]=U.useState(""),[x,k]=U.useState(null),[M,m]=U.useState(""),[f,v]=U.useState(null),[C,T]=U.useState(!1),[D,j]=U.useState([]),[Q,J]=U.useState([]),[le,oe]=U.useState([]),[l,b]=U.useState(""),[A,q]=U.useState(!1),[L,O]=U.useState("idle"),[ue,we]=U.useState(null),[ke,H]=U.useState(!1),[re,Ze]=U.useState(!1),[Ct,qe]=U.useState(null),[Tt,Qe]=U.useState(!1),[xe,de]=U.useState("idle"),[Ee,Rt]=U.useState(null),[I,ne]=U.useState({name:"",mrn:"",dob:"",email:"",visitDate:new Date().toLocaleDateString()}),Le=Be.getCurrentUser(),me=Le?.id||Le?.email||"doctor-default-001",Xe=Le?.name||"Dr. Default";U.useEffect(()=>{(async()=>{if(a&&e)try{const d=new Date().toISOString().split("T")[0],N=(await Te.getScheduleForDate(me,d)).find(F=>F.id===a||F.name.includes(a)||F.mrn===a);if(N)ne({name:N.name||"",mrn:N.mrn||"",dob:N.dob||"",email:N.phone||"",visitDate:new Date().toLocaleDateString()}),R("MedicalDictation","Info message",{});else{const F=it(a);F&&(ne({name:F.name||"",mrn:F.mrn||"",dob:F.dob||"",email:F.email||"",visitDate:new Date().toLocaleDateString()}),R("MedicalDictation","Info message",{}))}}catch{y("MedicalDictation","Error message",{});const z=it(a);z&&ne({name:z.name||"",mrn:z.mrn||"",dob:z.dob||"",email:z.email||"",visitDate:new Date().toLocaleDateString()})}})()},[a,e,me]),U.useEffect(()=>{const w=async()=>{if(a&&I.name)try{g("MedicalDictation","Debug message",{});const z=(await Te.getNotes(me)).filter(N=>N.patientName===I.name||N.patientMrn&&I.mrn&&N.patientMrn===I.mrn);if(z.length>0){const N=z[0];N.rawTranscript&&i(N.rawTranscript),N.aiProcessedNote&&u(N.aiProcessedNote),qe(String(N.id||"")),R("MedicalDictation","Info message",{}),setTimeout(()=>{alert(`📋 Loaded previous notes for ${I.name}

You can continue editing where you left off!`)},1e3)}}catch{y("MedicalDictation","Error message",{})}};a&&I.name&&!n&&!p&&w()},[a,I.name,I.mrn,me]),U.useEffect(()=>{(async()=>{const d=Be.getCurrentUser(),z=d?.id||d?.email||"doctor-default-001";g("MedicalDictation","Debug message",{}),ae.initialize(z);try{const N=await ae.getTemplates(z),F=await ae.getRecentTemplates(z),Z=await ae.getFavoriteTemplates(z);g("MedicalDictation","Debug message",{}),j(N),J(F),oe(Z);const ie=await ae.getDefaultTemplate(z);ie&&v(ie)}catch{y("MedicalDictation","Error message",{}),j([]),J([]),oe([])}})()},[]),U.useEffect(()=>{const w=setInterval(()=>{if(n||p){O("saving");const d={transcript:n,processedNote:p,patientDetails:I,previousVisitNote:l,selectedTemplate:f?.id,recordingMode:x,timestamp:new Date().toISOString()};localStorage.setItem("autosave_dictation",JSON.stringify(d)),we(new Date),O("saved"),g("MedicalDictation","Debug message",{}),setTimeout(()=>O("idle"),2e3)}},1e4);return()=>clearInterval(w)},[n,p,I,l,f,x]),U.useEffect(()=>{const w=setInterval(async()=>{if((n||p)&&I.name&&xe!=="saving")try{de("saving");const d=await Te.saveNote(me,Xe,{patientName:I.name,patientMrn:I.mrn,rawTranscript:n,aiProcessedNote:p,recordingMode:x||"dictation",isQuickNote:!a});d?(qe(String(d)),Rt(new Date),de("saved"),g("MedicalDictation",`Auto-saved at ${new Date().toLocaleTimeString()}`),setTimeout(()=>de("idle"),3e3)):(de("error"),setTimeout(()=>de("idle"),5e3))}catch{y("MedicalDictation","Error message",{}),de("error"),setTimeout(()=>de("idle"),5e3)}},3e4);return()=>clearInterval(w)},[n,p,I.name,I.mrn,x,a,me,Xe,xe]),U.useEffect(()=>{const w=localStorage.getItem("autosave_dictation");if(w)try{const d=JSON.parse(w),z=new Date(d.timestamp),F=(new Date().getTime()-z.getTime())/(1e3*60*60);if(F<1){if(i(d.transcript||""),u(d.processedNote||""),ne(d.patientDetails||I),b(d.previousVisitNote||""),k(d.recordingMode||null),d.selectedTemplate){const Z=D.find(ie=>ie.id===d.selectedTemplate);Z&&v(Z)}ee(!!d.processedNote),H(!0),setTimeout(()=>H(!1),5e3),g("MedicalDictation","Debug message",{})}else if(F<24)if(window.confirm(`Found saved work from ${z.toLocaleString()}. Continue where you left off?`)){if(i(d.transcript||""),u(d.processedNote||""),ne(d.patientDetails||I),b(d.previousVisitNote||""),k(d.recordingMode||null),d.selectedTemplate){const Z=D.find(ie=>ie.id===d.selectedTemplate);Z&&v(Z)}ee(!!d.processedNote),H(!0),setTimeout(()=>H(!1),5e3)}else localStorage.removeItem("autosave_dictation");else localStorage.removeItem("autosave_dictation")}catch{y("MedicalDictation","Error message",{}),localStorage.removeItem("autosave_dictation")}},[D]),U.useEffect(()=>{const w=(F="activity")=>{const Z=new Date(Date.now()+72e5);localStorage.setItem("session_expires",Z.toISOString()),g("MedicalDictation","Debug message",{})};if(r){const F=setInterval(()=>{w("recording")},3e4);return()=>clearInterval(F)}const d=["click","keypress","input"],z=()=>w("user-interaction");d.forEach(F=>{window.addEventListener(F,z)});const N=setInterval(()=>{const F=localStorage.getItem("session_expires");if(F){const Z=new Date(F),ie=new Date,Ce=(Z.getTime()-ie.getTime())/(1e3*60);Ce<10&&(n.length>0||p.length>0)?w("auto-extend-active-work"):Ce<5&&Ce>0&&!n&&!p&&window.confirm("Your session will expire in less than 5 minutes. Click OK to extend your session.")&&w("manual-extension")}},6e4);return()=>{d.forEach(F=>{window.removeEventListener(F,z)}),clearInterval(N)}},[r,n,p]),U.useEffect(()=>{const w=localStorage.getItem("user_data");if(w)try{const d=JSON.parse(w);if(d.specialty){const z={id:d.id||"default",name:d.name||"Doctor",specialty:d.specialty};At.setCurrentDoctor(z);const N=d.specialty==="endocrinology"?"Endocrinology":d.specialty==="psychiatry"?"Psychiatry":d.specialty==="nutrition"?"Nutrition":d.specialty;m(N),g("MedicalDictation","Debug message",{})}}catch{y("MedicalDictation","Error message",{})}},[]),U.useEffect(()=>{if(g("MedicalDictation","Debug message",{}),!Ke.isAnyServiceAvailable()){te("HIPAA-compliant speech services are not configured. Please contact administrator."),V("MedicalDictation","Warning message",{});return}return R("MedicalDictation","Info message",{}),g("MedicalDictation","Debug message",{}),()=>{g("MedicalDictation","Debug message",{})}},[]);const Dt=async()=>{if(!r){if(!x){alert("Please select a recording mode (Dictation or Conversation) before starting.");return}try{g("MedicalDictation","Debug message",{}),await Ke.startRecording(x==="conversation"?"conversation":"dictation",{onTranscript:(d,z)=>{g("MedicalDictation","Debug message",{});const N=st.correctTranscription(d);z?(i(F=>{const Z=F+(F?" ":"")+N;return g("MedicalDictation","Debug message",{}),Z}),h("")):h(N)},onError:d=>{y("MedicalDictation","Error message",{}),te(`Speech Recognition Error: ${d}`),s(!1)}})?(s(!0),te(""),R("MedicalDictation","Info message",{})):te("Failed to start AWS Transcribe Medical")}catch{y("MedicalDictation","Error message",{}),te("Failed to start recording. Please try again.")}}},kt=async()=>{if(!r){g("MedicalDictation","Debug message",{});return}g("MedicalDictation","Debug message",{}),s(!1);try{Ke.stopRecording(),g("MedicalDictation","Debug message",{})}catch{y("MedicalDictation","Error message",{})}let w=n;if(o.trim()){const d=st.correctTranscription(o);w=n+(n?" ":"")+d,g("MedicalDictation","Debug message",{})}(w!==n||o.trim())&&(i(w),h("")),g("MedicalDictation","Debug message",{}),g("MedicalDictation","Debug message",{}),g("MedicalDictation","Debug message",{}),w.trim()||n.trim()||o.trim()?(g("MedicalDictation","Debug message",{}),!w.trim()&&(n.trim()||o.trim())&&(w=n+(n&&o?" ":"")+o,i(w)),setTimeout(()=>{et(w)},100)):(g("MedicalDictation","Debug message",{}),alert("No audio was captured. Please check your microphone permissions and try again."))},et=async w=>{const d=w||n;if(g("MedicalDictation","Debug message",{}),!d.trim()){y("MedicalDictation","Error message",{}),alert("Please record some content first");return}P(!0),ee(!1);try{const z=`
PATIENT INFORMATION:
Name: ${I.name||"[Not provided]"}
MRN: ${I.mrn||"[Not provided]"}
DOB: ${I.dob||"[Not provided]"}
Email: ${I.email||"[Not provided]"}
Visit Date: ${I.visitDate}

${l?`PREVIOUS VISIT NOTE:
${l}

INSTRUCTIONS: Create a comprehensive note that builds upon the previous visit. Include:
- Reference to previous conditions and their current status
- Trend analysis for chronic conditions
- Updated assessment incorporating historical context
- Continuity in the treatment plan`:""}
      `.trim(),N=x==="conversation"?`CONVERSATION TRANSCRIPT:
${d}`:d;g("MedicalDictation","Debug message",{});const F={id:a||"quick-note",name:I.name||"Unknown Patient",mrn:I.mrn||"Unknown MRN",dob:I.dob||"",email:I.email||"",diagnosis:[],medications:[],labResults:[],vitalSigns:{bp:"",hr:"",temp:"",weight:"",bmi:""}};let Z;if(f)try{const tt=await ae.getSettings();Z={template:f,doctorSettings:tt}}catch{y("MedicalDictation","Error message",{}),Z={template:f,doctorSettings:null}}const Ce=(await Pt.processMedicalTranscription(N,F,null,`Patient context: ${z}`,Z)).formatted;g("MedicalDictation","Debug message",{}),u(Ce),ee(!0)}catch(z){y("MedicalDictation","Error message",{});const N=z instanceof Error?z.message:"Unknown error";alert(`Failed to process with AI: ${N}`)}finally{P(!1)}},Et=()=>{i(""),h(""),u(""),ee(!1)},jt=async w=>{try{await navigator.clipboard.writeText(w),alert("Copied to clipboard!")}catch{y("MedicalDictation","Error message",{}),alert("Failed to copy to clipboard")}},Nt=async()=>{if(!n&&!p){alert("No content to save. Please dictate some notes first.");return}if(!I.name){alert("Please enter patient name before saving to database.");return}Ze(!0);try{const w=Be.getCurrentUser();if(!w)throw new Error("No authenticated user found");const d=w.id||w.email||"doctor-default-001",z=w.name||"Dr. Provider",N=await Te.saveNote(d,z,{patientName:I.name,patientMrn:I.mrn,rawTranscript:n,aiProcessedNote:p,recordingMode:x||"dictation",isQuickNote:!a});if(N)a||await Te.addQuickNotePatientToSchedule(d,z,I.name,I.mrn),qe(N.toString()),Qe(!0),setTimeout(()=>Qe(!1),5e3),R("MedicalDictation","Info message",{}),localStorage.removeItem("autosave_dictation");else throw new Error("Failed to save note - no ID returned")}catch(w){y("MedicalDictation","Error message",{}),alert(`Failed to save to database: ${w instanceof Error?w.message:"Unknown error"}`)}finally{Ze(!1)}};return c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("div",{className:"bg-white shadow-sm border-b",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4",children:c.jsxs("div",{className:"flex justify-between items-center py-2 border-b",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("h1",{className:"text-lg font-bold text-gray-900",children:a?"Patient Dictation":"Quick Note"}),M&&c.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:M})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>t("/doctor"),className:"px-3 py-1 text-xs bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"← Dashboard"}),c.jsx("button",{onClick:()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("session_expires"),window.location.href="/login"},className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Logout"})]})]})})}),ke&&c.jsx("div",{className:"fixed top-4 right-4 z-50 animate-fade-in",children:c.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-lg p-3 flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),c.jsx("span",{className:"text-sm font-medium text-green-800",children:"Work restored - continue where you left off!"})]})}),Tt&&c.jsx("div",{className:"fixed top-16 right-4 z-50 animate-fade-in",children:c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg shadow-lg p-3 flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 1.79 4 4 4h8c2.21 0 4-1.79 4-4V7M4 7l2-3h12l2 3M4 7h16M12 11v4"})}),c.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["✅ Note saved to database! ID: ",Ct?.slice(-8)," | Added to schedule"]})]})}),c.jsxs("div",{className:"fixed top-4 left-4 z-40",children:[L==="saving"&&c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg shadow-sm p-2 flex items-center gap-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),c.jsx("span",{className:"text-xs text-blue-800",children:"Saving..."})]}),L==="saved"&&c.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-sm p-2 flex items-center gap-2",children:[c.jsx("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),c.jsxs("span",{className:"text-xs text-green-800",children:["Saved ",ue?ue.toLocaleTimeString():""]})]})]}),c.jsxs("div",{className:"fixed top-4 right-4 z-40",children:[xe==="saving"&&c.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg shadow-sm p-2 flex items-center gap-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-purple-600"}),c.jsx("span",{className:"text-xs text-purple-800",children:"Saving to database..."})]}),xe==="saved"&&c.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg shadow-sm p-2 flex items-center gap-2",children:[c.jsx("svg",{className:"w-3 h-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),c.jsxs("span",{className:"text-xs text-green-800",children:["📊 Database saved ",Ee?Ee.toLocaleTimeString():""]})]}),xe==="error"&&c.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg shadow-sm p-2 flex items-center gap-2",children:[c.jsx("svg",{className:"w-3 h-3 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),c.jsx("span",{className:"text-xs text-red-800",children:"Database save failed"})]})]}),c.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[c.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mb-4 border-2 border-blue-200",children:c.jsxs("div",{className:"flex items-center justify-between gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-sm font-bold text-gray-700",children:"MODE:"}),c.jsx("button",{onClick:()=>{k("dictation")},className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${x==="dictation"?"bg-green-500 text-white shadow-lg scale-105":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"🎤 DICTATION"}),c.jsx("button",{onClick:()=>{k("conversation")},className:`px-4 py-2 rounded-lg text-sm font-bold transition-all ${x==="conversation"?"bg-purple-500 text-white shadow-lg scale-105":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"👥 CONVERSATION"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:r?kt:Dt,disabled:S||!x,className:`px-8 py-3 rounded-lg font-bold transition-all flex items-center gap-2 text-lg shadow-lg ${x?S?"bg-gray-400 cursor-not-allowed text-gray-200":r?"bg-red-500 hover:bg-red-600 text-white animate-pulse ring-4 ring-red-300":"bg-green-500 hover:bg-green-600 text-white ring-2 ring-green-300":"bg-gray-300 cursor-not-allowed text-gray-500"}`,children:r?"⏹ STOP RECORDING":"🎙️ START RECORDING"}),c.jsx("button",{onClick:()=>et(),disabled:!n.trim()||S,className:"px-6 py-3 bg-blue-600 text-white text-base font-bold rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all flex items-center gap-2 shadow-lg",children:S?"⏳ PROCESSING...":"🤖 PROCESS WITH AI"}),c.jsx("button",{onClick:Nt,disabled:!n.trim()&&!p.trim()||!I.name.trim()||re,className:"px-6 py-3 bg-green-600 text-white text-base font-bold rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all flex items-center gap-2 shadow-lg",title:"Save note and create appointment in database",children:re?"💾 SAVING...":"💾 SAVE TO DATABASE"}),c.jsx("button",{onClick:Et,className:"px-4 py-3 bg-red-100 text-red-700 text-base font-bold rounded-lg hover:bg-red-200 transition shadow",title:"Clear All",children:"🗑️ Clear"})]})]})}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[2fr_3fr] gap-4",children:[c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[c.jsx("h2",{className:"text-md font-semibold text-gray-800 mb-2",children:"📋 Previous Visit Note"}),c.jsx("textarea",{value:l,onChange:w=>b(w.target.value),placeholder:"Paste previous visit note from EMR here...",className:"w-full h-20 px-2 py-1 border border-gray-300 rounded-lg text-xs focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),c.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"This will be used to create continuity with today's visit"})]}),c.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[c.jsxs("h2",{className:"text-md font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[c.jsx(Mt,{className:"w-4 h-4"}),"Change Template"]}),c.jsxs("button",{onClick:()=>T(!C),className:"w-full px-3 py-2 text-left border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center justify-between",children:[c.jsx("span",{className:"text-sm",children:f?f.name:"No Template Selected"}),c.jsx(Ut,{className:`w-4 h-4 transition-transform ${C?"rotate-180":""}`})]}),C&&c.jsxs("div",{className:"mt-2 border rounded-lg max-h-96 overflow-y-auto",children:[c.jsx("button",{onClick:()=>{v(null),T(!1)},className:"w-full px-3 py-2 text-left hover:bg-gray-50 text-sm border-b",children:"No Template (Standard SOAP)"}),Q.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 bg-gray-50 flex items-center gap-1",children:[c.jsx(rt,{className:"w-3 h-3"})," Recent"]}),Q.map(w=>c.jsxs("button",{onClick:()=>{v(w),T(!1),ae.addToRecent(w.id)},className:"w-full px-3 py-2 text-left hover:bg-blue-50 text-sm border-b flex items-center justify-between",children:[c.jsx("span",{children:w.name}),w.visitType&&c.jsx("span",{className:"text-xs text-gray-500",children:w.visitType})]},w.id))]}),le.length>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 bg-gray-50 flex items-center gap-1",children:[c.jsx($t,{className:"w-3 h-3"})," Favorites"]}),le.map(w=>c.jsxs("button",{onClick:()=>{v(w),T(!1),ae.addToRecent(w.id)},className:"w-full px-3 py-2 text-left hover:bg-yellow-50 text-sm border-b flex items-center justify-between",children:[c.jsx("span",{children:w.name}),w.visitType&&c.jsx("span",{className:"text-xs text-gray-500",children:w.visitType})]},w.id))]}),D.length>0?(()=>{const w={Endocrinology:D.filter(d=>d.name.includes("Endo -")||d.name.includes("Diabetes")||d.name.includes("Thyroid")||d.name.includes("Tess")||d.name.includes("Elina")||d.name.includes("Radha")||d.name.includes("Shannon")),"Primary Care":D.filter(d=>d.name.includes("Primary Care -")||d.name.includes("Quick Progress")||d.name.includes("Annual")),"Sports Medicine":D.filter(d=>d.name.includes("Sports Med -")),Psychiatry:D.filter(d=>d.name.includes("Psychiatry")||d.name.includes("Nikki")||d.name.includes("Ghislaine")),Nutrition:D.filter(d=>d.name.includes("Nutrition")||d.name.includes("Vanessa")),"General/Other":D.filter(d=>!d.name.includes("Endo -")&&!d.name.includes("Primary Care -")&&!d.name.includes("Sports Med -")&&!d.name.includes("Diabetes")&&!d.name.includes("Thyroid")&&!d.name.includes("Psychiatry")&&!d.name.includes("Nutrition")&&!d.name.includes("Tess")&&!d.name.includes("Nikki")&&!d.name.includes("Vanessa")&&!d.name.includes("Elina")&&!d.name.includes("Radha")&&!d.name.includes("Shannon")&&!d.name.includes("Ghislaine")&&!d.name.includes("Quick Progress")&&!d.name.includes("Annual"))};return Object.entries(w).map(([d,z])=>z.length===0?null:c.jsxs("div",{children:[c.jsxs("div",{className:"px-3 py-1 text-xs font-semibold text-gray-500 bg-gray-50 flex items-center gap-2",children:[d==="Endocrinology"&&"🩺",d==="Primary Care"&&"👩‍⚕️",d==="Sports Medicine"&&"🏃‍♂️",d==="Psychiatry"&&"🧠",d==="Nutrition"&&"🥗",d==="General/Other"&&"📝",d," (",z.length,")"]}),z.map(N=>c.jsxs("button",{onClick:()=>{v(N),T(!1),ae.addToRecent(N.id)},className:"w-full px-3 py-2 text-left hover:bg-gray-50 text-sm border-b flex items-center justify-between",children:[c.jsx("span",{className:"text-gray-800",children:N.name}),c.jsx("div",{className:"flex items-center gap-2",children:N.visitType&&c.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:N.visitType})})]},N.id))]},d)).filter(Boolean)})():c.jsxs("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:["No templates created yet.",c.jsx("button",{onClick:()=>t("/doctor/templates"),className:"block w-full mt-2 text-blue-600 hover:text-blue-700",children:"Create your first template →"})]})]}),f&&c.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-xs text-blue-700",children:["Using: ",f.name]})]}),c.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[c.jsx("h2",{className:"text-md font-semibold text-gray-800 mb-3",children:"📝 Transcript"}),$&&c.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-700",children:$})}),c.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 min-h-[200px] max-h-[300px] overflow-y-auto bg-gray-50",children:[c.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:x==="conversation"?"Conversation Transcript:":"Dictation Transcript:"}),n||o?c.jsxs("div",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:[n,o&&c.jsx("span",{className:"text-gray-500 italic",children:o})]}):c.jsx("p",{className:"text-sm text-gray-400 italic",children:r?"Listening...":'Click "Start Recording" to begin'})]})]})]}),c.jsx("div",{className:"space-y-4",children:c.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[c.jsxs("div",{className:"flex justify-between items-center mb-3",children:[c.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["📝 Processed Clinical Note",l&&c.jsx("span",{className:"ml-2 text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded",children:"+ History"})]}),Y&&c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>jt(p.replace(/###\s*/g,"").replace(/\*\*(.*?)\*\*/g,"$1")),className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"📋 Copy"}),c.jsx("button",{onClick:()=>{const w=p.replace(/###\s*/g,"").replace(/\*\*(.*?)\*\*/g,"$1"),d=window.open("","_blank");d&&(d.document.write(`
                            <html>
                              <head>
                                <title>Medical Note - ${I.name||"Patient"}</title>
                                <style>
                                  body { font-family: Arial, sans-serif; padding: 20px; white-space: pre-wrap; }
                                  @media print { body { padding: 10px; } }
                                </style>
                              </head>
                              <body>${w.replace(/\n/g,"<br>")}</body>
                            </html>
                          `),d.document.close(),d.print())},className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200",children:"🖨️ Print"})]})]}),c.jsx("div",{className:"border border-gray-200 rounded-lg p-4 min-h-[700px] max-h-[800px] overflow-y-auto bg-gradient-to-br from-white to-blue-50",children:Y&&p?c.jsx(Fr,{content:p}):c.jsx("p",{className:"text-sm text-gray-400 italic",children:'Processed note will appear here after clicking "Process with AI"'})})]})})]}),c.jsxs("div",{className:"mt-4 bg-white rounded-lg shadow-sm p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Patient Information"}),Ee&&c.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[c.jsx(rt,{className:"w-3 h-3"}),"Last saved: ",Ee.toLocaleTimeString()]})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Patient Name"}),c.jsx("input",{type:"text",value:I.name,onChange:w=>ne(d=>({...d,name:w.target.value})),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter patient name"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-medium text-gray-600",children:"MRN"}),c.jsx("input",{type:"text",value:I.mrn,onChange:w=>ne(d=>({...d,mrn:w.target.value})),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Medical Record #"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Date of Birth"}),c.jsx("input",{type:"date",value:I.dob,onChange:w=>ne(d=>({...d,dob:w.target.value})),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Email"}),c.jsx("input",{type:"email",value:I.email,onChange:w=>ne(d=>({...d,email:w.target.value})),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"patient@email.com"})]})]}),c.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Visit Date: ",I.visitDate]})]})]})]})}export{es as M};
//# sourceMappingURL=MedicalDictation-BrIZBXNY.js.map
