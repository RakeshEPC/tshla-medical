const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/awsTranscribeSimple.service-DgqysyDz.js","assets/index-CFDQeSWK.js","assets/index--GQbvNKg.css","assets/resolveDefaultsModeConfig-R7vZuTP0.js"])))=>i.map(i=>d[i]);
import{h as g,_ as p,l as e,b as c,g as h}from"./index-CFDQeSWK.js";class w{client=null;mediaRecorder=null;mediaStream=null;isRecording=!1;transcriptCallback=null;errorCallback=null;audioChunks=[];processingInterval=null;constructor(){this.initializeClient()}initializeClient(){{g("awsTranscribeMedicalStreamingFixed","Warning message",{});return}}isConfigured(){return this.client!==null}async startTranscription(i,s,t,m="PRIMARYCARE"){if(!this.isConfigured())return g("awsTranscribeMedicalStreamingFixed","Warning message",{}),this.startWebSpeechFallback(i,s,t);try{const{awsTranscribeSimple:a}=await p(async()=>{const{awsTranscribeSimple:d}=await import("./awsTranscribeSimple.service-DgqysyDz.js").then(n=>n.b);return{awsTranscribeSimple:d}},__vite__mapDeps([0,1,2,3]));e("awsTranscribeMedicalStreamingFixed","Debug message",{}),await a.startRecording((d,n)=>{s({transcript:d,isPartial:!n,speaker:i==="CONVERSATION"?"CLINICIAN":void 0,confidence:n?.95:.8,timestamp:new Date().toISOString()})},d=>{c("awsTranscribeMedicalStreamingFixed","Error message",{}),g("awsTranscribeMedicalStreamingFixed","Warning message",{}),this.startWebSpeechFallback(i,s,t)})&&(this.isRecording=!0,this.awsTranscribeSimple=a,h("awsTranscribeMedicalStreamingFixed","Info message",{}))}catch{return c("awsTranscribeMedicalStreamingFixed","Error message",{}),g("awsTranscribeMedicalStreamingFixed","Warning message",{}),this.startWebSpeechFallback(i,s,t)}}async setupMediaRecorder(i,s){if(!this.mediaStream)throw new Error("No media stream available");const t=this.getSupportedMimeType();this.mediaRecorder=new MediaRecorder(this.mediaStream,{mimeType:t,audioBitsPerSecond:128e3}),this.mediaRecorder.ondataavailable=m=>{m.data.size>0&&this.audioChunks.push(m.data)},this.mediaRecorder.start(1e3),this.processingInterval=setInterval(()=>{this.audioChunks.length>0&&this.processAudioChunks(i,s)},3e3)}getSupportedMimeType(){const i=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4","audio/wav"];for(const s of i)if(MediaRecorder.isTypeSupported(s))return e("awsTranscribeMedicalStreamingFixed","Debug message",{}),s;return""}async processAudioChunks(i,s){this.audioChunks.length!==0&&(new Blob(this.audioChunks,{type:"audio/webm"}),this.audioChunks=[],e("awsTranscribeMedicalStreamingFixed","Debug message",{}),this.isRecording&&g("awsTranscribeMedicalStreamingFixed","Warning message",{}))}async startWebSpeechFallback(i,s,t){if(!("webkitSpeechRecognition"in window)){t(new Error("Speech recognition not supported in this browser"));return}try{e("awsTranscribeMedicalStreamingFixed","Debug message",{});const r=await navigator.mediaDevices.getUserMedia({audio:!0});h("awsTranscribeMedicalStreamingFixed","Info message",{}),r.getTracks().forEach(l=>l.stop())}catch{c("awsTranscribeMedicalStreamingFixed","Error message",{}),t(new Error("Microphone permission denied. Please allow microphone access and try again."));return}const m=window.webkitSpeechRecognition,a=new m;a.continuous=!0,a.interimResults=!0,a.maxAlternatives=1,a.lang="en-US";let u=i==="CONVERSATION"?"CLINICIAN":"",d=Date.now(),n=0;a.onresult=r=>{e("awsTranscribeMedicalStreamingFixed","Debug message",{});let l="",b="";for(let o=r.resultIndex;o<r.results.length;o++){const S=r.results[o][0].transcript;e("awsTranscribeMedicalStreamingFixed","Debug message",{}),r.results[o].isFinal?l+=S:b+=S}if(i==="CONVERSATION"){const o=Date.now();(o-d>3e3||n>50)&&(u=u==="CLINICIAN"?"PATIENT":"CLINICIAN",n=0),d=o,n+=(l+b).split(" ").length}l?(e("awsTranscribeMedicalStreamingFixed","Debug message",{}),s({transcript:l,isPartial:!1,speaker:i==="CONVERSATION"?u:void 0,confidence:.95,timestamp:new Date().toISOString()})):b?(e("awsTranscribeMedicalStreamingFixed","Debug message",{}),s({transcript:b,isPartial:!0,speaker:i==="CONVERSATION"?u:void 0,confidence:.8,timestamp:new Date().toISOString()})):e("awsTranscribeMedicalStreamingFixed","Debug message",{})},a.onerror=r=>{r.error!=="no-speech"&&r.error!=="aborted"&&(c("awsTranscribeMedicalStreamingFixed","Error message",{}),t(new Error(`Speech recognition error: ${r.error}`)))},a.onstart=()=>{h("awsTranscribeMedicalStreamingFixed","Info message",{})},a.onspeechstart=()=>{e("awsTranscribeMedicalStreamingFixed","Debug message",{})},a.onspeechend=()=>{e("awsTranscribeMedicalStreamingFixed","Debug message",{})},a.onnomatch=()=>{e("awsTranscribeMedicalStreamingFixed","Debug message",{})},a.onend=()=>{if(e("awsTranscribeMedicalStreamingFixed","Debug message",{}),this.isRecording){e("awsTranscribeMedicalStreamingFixed","Debug message",{});try{a.start()}catch{c("awsTranscribeMedicalStreamingFixed","Error message",{})}}};try{a.start(),this.isRecording=!0,this.recognition=a,g("awsTranscribeMedicalStreamingFixed","Warning message",{}),e("awsTranscribeMedicalStreamingFixed","Debug message",{}),e("awsTranscribeMedicalStreamingFixed","Debug message",{})}catch(r){c("awsTranscribeMedicalStreamingFixed","Error message",{}),t(r)}}stop(){if(e("awsTranscribeMedicalStreamingFixed","Debug message",{}),this.isRecording=!1,this.awsTranscribeSimple){try{this.awsTranscribeSimple.stopRecording(),e("awsTranscribeMedicalStreamingFixed","Debug message",{})}catch{c("awsTranscribeMedicalStreamingFixed","Error message",{})}this.awsTranscribeSimple=null}if(this.mediaRecorder){try{this.mediaRecorder.state==="recording"?(this.mediaRecorder.stop(),e("awsTranscribeMedicalStreamingFixed","Debug message",{})):this.mediaRecorder.state==="paused"&&(this.mediaRecorder.resume(),this.mediaRecorder.stop(),e("awsTranscribeMedicalStreamingFixed","Debug message",{}))}catch{c("awsTranscribeMedicalStreamingFixed","Error message",{})}this.mediaRecorder=null}if(this.processingInterval&&(clearInterval(this.processingInterval),this.processingInterval=null),this.recognition){try{this.recognition.stop(),e("awsTranscribeMedicalStreamingFixed","Debug message",{})}catch{}this.recognition=null}this.cleanup(),h("awsTranscribeMedicalStreamingFixed","Info message",{})}cleanup(){this.mediaStream&&(this.mediaStream.getTracks().forEach(i=>i.stop()),this.mediaStream=null),this.audioChunks=[],this.transcriptCallback=null,this.errorCallback=null,this.mediaRecorder=null}}const F=new w;export{F as a};
//# sourceMappingURL=awsTranscribeMedicalStreamingFixed.service-B0ubQFD5.js.map
