import{l as $,b as Q,r as c,j as e,u as Ce,e as ce,R as be}from"./index-CFDQeSWK.js";import{a as W,s as A,S as Se,c as me}from"./ScheduleImportModal-CQFUD8RN.js";import{patientService as Ie}from"./patient.service-Cq6NQU3g.js";import"./azureAI.service-CZPi9VqR.js";import"./medicalCorrections.service-DDTgANcC.js";import"./resolveDefaultsModeConfig-R7vZuTP0.js";class ke{async extractActions(a){const n=this.extractMedications(a),s=this.extractLabs(a);return $("actionExtraction","Debug message",{}),{meds:n,labs:s}}extractMedications(a){const n=[];a.toLowerCase();const s={start:[/\bstart(?:ing|ed)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi,/\binitiate(?:d)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi,/\bbegin(?:ning)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi],stop:[/\bstop(?:ping|ped)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\b/gi,/\bdiscontinue(?:d)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\b/gi,/\bhold(?:ing)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\b/gi],refill:[/\brefill(?:ing|ed)?\s+(?:all\s+)?(?:meds|medications|([a-z\-]+(?:\s+[a-z\-]+)?))\b/gi,/\brenew(?:ing|ed)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\b/gi,/\bcontinue\s+(?:all\s+)?(?:current\s+)?(?:meds|medications|([a-z\-]+(?:\s+[a-z\-]+)?))\b/gi],increase:[/\bincrease(?:d)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(?:to\s+)?(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi,/\braise(?:d)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(?:to\s+)?(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi,/\bup\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(?:to\s+)?(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi],decrease:[/\bdecrease(?:d)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(?:to\s+)?(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi,/\blower(?:ed)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(?:to\s+)?(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi,/\breduce(?:d)?\s+([a-z\-]+(?:\s+[a-z\-]+)?)\s+(?:to\s+)?(\d+(?:\.\d+)?)\s*(mg|mcg|units?|ml|g)\b/gi]};for(const[o,y]of Object.entries(s))for(const x of y){const l=new RegExp(x.source,x.flags);let p;for(;(p=l.exec(a))!==null;){const g=this.cleanDrugName(p[1]);if(g&&!this.isGenericTerm(g)){const N={action:o,drug:g};p[2]&&p[3]&&(N.dose=`${p[2]} ${p[3]}`);const k=this.extractFrequency(a,p.index);k&&(N.frequency=k),n.push(N)}}}return this.extractCommonMedications(a,n),this.deduplicateMedications(n)}extractLabs(a){const n=[],s=["A1C","HbA1c","hemoglobin A1C","CBC","complete blood count","CMP","comprehensive metabolic panel","BMP","basic metabolic panel","TSH","thyroid stimulating hormone","T3","T4","free T3","free T4","lipid panel","cholesterol","LDL","HDL","triglycerides","liver function","LFT","AST","ALT","kidney function","creatinine","BUN","eGFR","urinalysis","UA","urine","glucose","fasting glucose","random glucose","B12","vitamin B12","folate","vitamin D","25-OH vitamin D","iron","ferritin","TIBC","PSA","prostate specific antigen","PT","INR","PTT","blood culture","urine culture","chest x-ray","CXR","EKG","ECG","cortisol","ACTH","testosterone","estrogen","progesterone","microalbumin","urine microalbumin"],o=[/\border(?:ing|ed)?\s+(?:labs?|blood\s+work|tests?)?\s*:?\s*([^.]+)/gi,/\bcheck(?:ing)?\s+(?:labs?|blood\s+work)?\s*:?\s*([^.]+)/gi,/\bget(?:ting)?\s+(?:labs?|blood\s+work)?\s*:?\s*([^.]+)/gi,/\bdraw(?:ing)?\s+(?:labs?|blood)?\s*:?\s*([^.]+)/gi,/\blabs?\s+(?:to\s+)?(?:order|check|draw)\s*:?\s*([^.]+)/gi,/\brepeat\s+(?:labs?|([^.]+))/gi];for(const l of o){let p;for(;(p=l.exec(a))!==null;){const g=p[1];if(g){const N=this.extractTestNames(g,s);N.length>0&&n.push({action:"order",tests:N})}}}const y=new RegExp(`\\b(?:order|check|repeat|draw|get)\\s+(?:a\\s+)?(?:${s.join("|")})\\b`,"gi");let x;for(;(x=y.exec(a))!==null;){const l=this.extractSingleTest(x[0],s);l&&(n.some(g=>g.tests.some(N=>N.toLowerCase()===l.toLowerCase()))||n.push({action:"order",tests:[l]}))}return this.mergeLabs(n)}extractCommonMedications(a,n){const s=["metformin","glipizide","glyburide","glimepiride","insulin","lantus","humalog","novolog","tresiba","ozempic","semaglutide","trulicity","victoza","jardiance","farxiga","invokana"],o=["levothyroxine","synthroid","armour thyroid","liothyronine","cytomel"],y=["lisinopril","enalapril","losartan","valsartan","metoprolol","atenolol","carvedilol","amlodipine","diltiazem","verapamil","furosemide","hydrochlorothiazide","spironolactone"],x=[...s,...o,...y];for(const l of x)if(new RegExp(`\\b${l}\\b`,"gi").test(a)){const N=new RegExp(`(start|stop|continue|refill|increase|decrease|hold|discontinue)\\s+(?:\\w+\\s+){0,3}${l}|${l}\\s+(?:\\w+\\s+){0,3}(started|stopped|continued|refilled|increased|decreased)`,"gi").exec(a);if(N){const k=this.determineAction(N[1]||N[2]);k&&!this.medicationExists(n,l)&&n.push({action:k,drug:l})}}}extractTestNames(a,n){const s=[],o=a.toUpperCase();for(const l of n){const p=l.toUpperCase();o.includes(p)&&s.push(l)}const y=/\b([A-Z0-9]+(?:\s+[A-Z0-9]+)?)\b/g;let x;for(;(x=y.exec(o))!==null;){const l=x[1];this.isLikelyLabTest(l)&&!s.includes(l)&&s.push(l)}return[...new Set(s)]}extractSingleTest(a,n){const s=a.toUpperCase();for(const o of n)if(s.includes(o.toUpperCase()))return o;return null}extractFrequency(a,n){const s=["QD","daily","once daily","once a day","BID","twice daily","twice a day","two times daily","TID","three times daily","three times a day","QID","four times daily","four times a day","QHS","at bedtime","bedtime","QAM","in the morning","morning","QPM","in the evening","evening","PRN","as needed","when needed","weekly","once weekly","every week","monthly","once monthly","every month"],o=Math.max(0,n-50),y=Math.min(a.length,n+100),x=a.substring(o,y).toLowerCase();for(const l of s)if(x.includes(l.toLowerCase()))return l;return null}cleanDrugName(a){return a?a.trim().replace(/\s+/g," ").replace(/[^\w\s\-]/g,"").toLowerCase():""}isGenericTerm(a){return["medication","medications","meds","drug","drugs","medicine","all"].includes(a.toLowerCase())}medicationExists(a,n){return a.some(s=>s.drug.toLowerCase()===n.toLowerCase())}determineAction(a){const n=a.toLowerCase();return n.includes("start")||n.includes("begin")||n.includes("initiate")?"start":n.includes("stop")||n.includes("discontinue")||n.includes("hold")?"stop":n.includes("continue")||n.includes("refill")||n.includes("renew")?"refill":n.includes("increase")||n.includes("raise")?"increase":n.includes("decrease")||n.includes("lower")||n.includes("reduce")?"decrease":null}isLikelyLabTest(a){return/^[A-Z]{2,4}$/.test(a)||/^[A-Z]\d+$/.test(a)||/^\d+-[A-Z]+/.test(a)}deduplicateMedications(a){const n=new Set;return a.filter(s=>{const o=`${s.action}-${s.drug}-${s.dose||""}`;return n.has(o)?!1:(n.add(o),!0)})}mergeLabs(a){const n=[];for(const s of a){const o=n.find(y=>y.action===s.action);if(o){const y=[...o.tests,...s.tests];o.tests=[...new Set(y)]}else n.push({...s,tests:[...new Set(s.tests)]})}return n}async processExtractionRequest(a){const n=await this.extractActions(a.noteBody);return{meds:n.meds,labs:n.labs}}}const Pe=new ke;class Te{pendingActions=[];constructor(){this.loadActions(),this.initializeSampleData()}async extractAndSaveActions(a,n,s,o,y,x){const l=await Pe.extractActions(a),p=new Date;return l.meds.forEach(g=>{const N={id:`med-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,patientId:n,patientName:s,doctorId:o,doctorName:y,noteId:x,itemType:"medication",action:this.formatMedicationAction(g),details:g,status:"pending",createdAt:p,dateExtracted:p,processed:!1};this.pendingActions.push(N)}),l.labs.forEach(g=>{const N={id:`lab-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,patientId:n,patientName:s,doctorId:o,doctorName:y,noteId:x,itemType:"lab",action:`Order ${g.test}`,details:g,status:"pending",createdAt:p,dateExtracted:p,processed:!1};this.pendingActions.push(N)}),this.saveActions(),W.log("create","action_items",void 0,{patientId:n,doctorId:o,medicationCount:l.meds.length,labCount:l.labs.length}),this.pendingActions.filter(g=>g.noteId===x)}formatMedicationAction(a){let n=`${a.action.charAt(0).toUpperCase()+a.action.slice(1)} ${a.drug}`;return a.dose&&(n+=` ${a.dose}`),a.frequency&&(n+=` ${a.frequency}`),n}getPendingActions(a){let n=this.pendingActions.filter(s=>!s.processed);return a?.doctorId&&a.doctorId!=="all"&&(n=n.filter(s=>s.doctorId===a.doctorId)),a?.patientId&&(n=n.filter(s=>s.patientId===a.patientId)),a?.itemType&&(n=n.filter(s=>s.itemType===a.itemType)),n.sort((s,o)=>o.dateExtracted.getTime()-s.dateExtracted.getTime())}processAction(a,n){const s=this.pendingActions.find(o=>o.id===a);return s?(s.processed=!0,s.processedBy=n,s.processedDate=new Date,s.status="completed",this.saveActions(),W.log("update","action_item",a,{processed:!0,processedBy:n}),!0):!1}getPendingCount(a){const n=this.pendingActions.filter(s=>!s.processed);return a?n.filter(s=>s.itemType===a).length:n.length}loadActions(){try{const a=localStorage.getItem("tshla_pending_actions");if(a){const n=JSON.parse(a);this.pendingActions=n.map(s=>({...s,createdAt:new Date(s.createdAt),dateExtracted:new Date(s.dateExtracted),processedDate:s.processedDate?new Date(s.processedDate):void 0}))}}catch{Q("noteActions","Error message",{})}}saveActions(){try{localStorage.setItem("tshla_pending_actions",JSON.stringify(this.pendingActions))}catch{Q("noteActions","Error message",{})}}async initializeSampleData(){if(this.pendingActions.length===0){const a=A.getAppointments({weekOf:new Date}),n=[{appointmentId:a[0]?.id,patientId:a[0]?.patientId,patientName:a[0]?.patientName,doctorId:a[0]?.doctorId,doctorName:a[0]?.doctorName,note:"Patient here for diabetes follow-up. A1C is 8.2, up from 7.8. Will start metformin 500mg BID. Also order A1C in 3 months and comprehensive metabolic panel. Patient education on diet provided."},{appointmentId:a[1]?.id,patientId:a[1]?.patientId,patientName:a[1]?.patientName,doctorId:a[1]?.doctorId,doctorName:a[1]?.doctorName,note:"New patient with hypertension. BP 150/95. Starting lisinopril 10mg daily. Order CBC, CMP, and lipid panel. Follow up in 2 weeks."},{appointmentId:a[2]?.id,patientId:a[2]?.patientId,patientName:a[2]?.patientName,doctorId:a[2]?.doctorId,doctorName:a[2]?.doctorName,note:"Blood pressure check. Current meds working well. Continue amlodipine 5mg daily. Refill all medications. Order TSH and basic metabolic panel."},{appointmentId:a[3]?.id,patientId:a[3]?.patientId,patientName:a[3]?.patientName,doctorId:a[3]?.doctorId,doctorName:a[3]?.doctorName,note:"Thyroid follow-up. TSH elevated at 8.5. Increase levothyroxine to 100mcg daily. Will recheck TSH in 6 weeks."},{appointmentId:a[4]?.id,patientId:a[4]?.patientId,patientName:a[4]?.patientName,doctorId:a[4]?.doctorId,doctorName:a[4]?.doctorName,note:"Cholesterol management. LDL 165. Start atorvastatin 20mg at bedtime. Order lipid panel in 6 weeks. Discussed lifestyle modifications."},{appointmentId:a[5]?.id,patientId:a[5]?.patientId,patientName:a[5]?.patientName,doctorId:a[5]?.doctorId,doctorName:a[5]?.doctorName,note:"Annual physical exam. All vitals stable. Order CBC with differential, CMP, lipid panel, A1C, and urinalysis. Continue current medications."},{appointmentId:a[6]?.id,patientId:a[6]?.patientId,patientName:a[6]?.patientName,doctorId:a[6]?.doctorId,doctorName:a[6]?.doctorName,note:"Weight management consultation. BMI 32. Start phentermine 37.5mg daily for 3 months. Check thyroid function - order TSH and free T4."},{appointmentId:a[7]?.id,patientId:a[7]?.patientId,patientName:a[7]?.patientName,doctorId:a[7]?.doctorId,doctorName:a[7]?.doctorName,note:"Migraine management. Frequent headaches. Start sumatriptan 100mg as needed for migraines. Begin propranolol 20mg BID for prophylaxis."},{appointmentId:a[8]?.id,patientId:a[8]?.patientId,patientName:a[8]?.patientName,doctorId:a[8]?.doctorId,doctorName:a[8]?.doctorName,note:"Asthma control visit. Still using rescue inhaler frequently. Increase fluticasone to 220mcg BID. Continue albuterol as needed. Order pulmonary function tests."},{appointmentId:a[9]?.id,patientId:a[9]?.patientId,patientName:a[9]?.patientName,doctorId:a[9]?.doctorId,doctorName:a[9]?.doctorName,note:"Anxiety medication review. Current dose helping but not adequate. Increase sertraline to 100mg daily. Continue alprazolam 0.5mg as needed."}];for(const s of n)s.patientId&&s.doctorId&&await this.extractAndSaveActions(s.note,s.patientId,s.patientName||"Unknown Patient",s.doctorId,s.doctorName||"Unknown Doctor",s.appointmentId);a[10]&&await this.extractAndSaveActions("Post-surgery follow-up looks good. Stop tramadol. Switch to ibuprofen 600mg TID as needed for pain.",a[10].patientId,a[10].patientName,a[10].doctorId,a[10].doctorName,a[10].id),a[11]&&await this.extractAndSaveActions("Lab review shows A1C improved to 6.8. Continue metformin 1000mg BID. Order repeat A1C in 3 months.",a[11].patientId,a[11].patientName,a[11].doctorId,a[11].doctorName,a[11].id),a[12]&&await this.extractAndSaveActions("Sleep apnea evaluation. Order sleep study. Start melatonin 5mg at bedtime while waiting for study results.",a[12].patientId,a[12].patientName,a[12].doctorId,a[12].doctorName,a[12].id)}}clearAllActions(){this.pendingActions=[],this.saveActions()}async regenerateWithRealData(){return this.pendingActions=[],this.saveActions(),await this.initializeSampleData(),this.pendingActions}}const w=new Te,fe={"veena r watwe":{id:"doc2",fullName:"Dr. Veena Watwe"},"veena watwe":{id:"doc2",fullName:"Dr. Veena Watwe"},"kamili wade-reescano":{id:"doc7",fullName:"Kamili Wade-Reescano, LMFT"},"nadia younus":{id:"doc8",fullName:"Dr. Nadia Younus"},"rakesh patel":{id:"doc1",fullName:"Dr. Rakesh Patel"},"rakesh raman patel":{id:"doc1",fullName:"Dr. Rakesh Patel"},"tess chamakkala":{id:"doc3",fullName:"Dr. Tess Chamakkala"},"radha bernander":{id:"doc4",fullName:"Dr. Radha Bernander"},"shannon gregroek":{id:"doc5",fullName:"Dr. Shannon Gregroek"},"elinia shakya":{id:"doc6",fullName:"Dr. Elinia Shakya"},"elina shakya":{id:"doc6",fullName:"Dr. Elinia Shakya"},"ghislaine tonye":{id:"doc9",fullName:"Dr. Ghislaine Tonye"},"cindy laverde":{id:"doc10",fullName:"Dr. Cindy Laverde"},"vanessa laverde":{id:"doc10",fullName:"Dr. Vanessa Laverde"}},Me=()=>{const[M,a]=c.useState(""),[n,s]=c.useState(new Date().toISOString().split("T")[0]),[o,y]=c.useState([]),[x,l]=c.useState("idle"),[p,g]=c.useState(""),[N,k]=c.useState(!1),X=()=>{l("parsing"),g("Parsing schedule data...");try{const d=[],i=M.split(`
`).map(m=>m.trim()).filter(m=>m);let V="",U="",Y="",F=1;for(let m=0;m<i.length;m++){const C=i[m],J=C.toLowerCase(),E=Object.entries(fe).find(([P])=>J.includes(P));if(E){V=E[1].fullName,U=E[1].id,m+1<i.length&&i[m+1].toLowerCase().includes("office")&&(Y=i[m+1],m++);continue}if(J.includes("office")&&!V){Y=C;continue}if(C.match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i)&&V){const P=C;let ee=15,O="",S="",z="",I="scheduled",te=!1,xe=!1;if(m+1<i.length){const D=i[m+1];if(D==="OPEN")I="open",m++;else if(D==="FROZEN")I="frozen",m++;else if(D.includes("min")){const v=D.match(/(\d+)min/);if(v&&(ee=parseInt(v[1])),m++,m+1<i.length){O=i[m+1],m++,m+1<i.length&&i[m+1].includes("|")&&(S=i[m+1],m++);const q=[];for(;m+1<i.length;){const ae=i[m+1];if(ae.match(/^\d{1,2}:\d{2}\s*(AM|PM)$/i)||Object.keys(fe).some(se=>ae.toLowerCase().includes(se)))break;q.push(ae),m++}z=q.join("; "),te=z.toLowerCase().includes("virtual")||z.toLowerCase().includes("telemedicine")||z.toLowerCase().includes("not online")}}}let H=!1;if(m+1<i.length){const D=i[m+1];D.match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i)&&D===P&&(H=!0)}if(I==="open"||I==="frozen"||O){const D={id:`import-${n}-${F++}`,doctorName:V,doctorId:U,patientName:I==="open"?"OPEN SLOT":I==="frozen"?"FROZEN":O,date:n,time:P,duration:ee,visitType:te?"telemedicine":"in-person",visitReason:z||(I==="open"?"Available":I==="frozen"?"Frozen Slot":"Appointment"),status:I,location:Y,isVirtual:te};if(S){const v=S.match(/(\d+)yo\s*([MF])\s*\|\s*([\d-]+)/);v&&(D.patientAge=v[1],D.patientGender=v[2],D.patientDOB=v[3])}d.push(D)}}}y(d),k(!0),l("idle"),g(`Parsed ${d.length} appointments. Review and click Import to add them.`)}catch(d){l("error"),g(`Error parsing schedule: ${d instanceof Error?d.message:"Unknown error"}`)}},L=async()=>{l("importing"),g("Importing appointments...");try{let d=0;for(const i of o)i.status==="scheduled"&&i.patientName&&i.patientName!=="OPEN SLOT"&&(await A.createAppointment({patientId:`imported-patient-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,patientName:i.patientName,doctorId:i.doctorId||"doc1",doctorName:i.doctorName,date:i.date,time:i.time,duration:i.duration,visitType:i.isVirtual?"telemedicine":"follow-up",visitReason:i.visitReason}),d++);l("success"),g(`Successfully imported ${d} appointments!`),a(""),y([]),k(!1),window.dispatchEvent(new Event("appointmentsUpdated"))}catch(d){l("error"),g(`Error importing appointments: ${d instanceof Error?d.message:"Unknown error"}`)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Import Schedule Data"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule Date"}),e.jsx("input",{type:"date",value:n,onChange:d=>s(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paste Schedule Data"}),e.jsx("textarea",{value:M,onChange:d=>a(d.target.value),placeholder:"Paste schedule data here (times, patient names, visit types, etc.)",className:"w-full h-48 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:X,disabled:!M||x==="parsing",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400",children:x==="parsing"?"Parsing...":"Parse Schedule"}),o.length>0&&e.jsx("button",{onClick:L,disabled:x==="importing",className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:x==="importing"?"Importing...":`Import ${o.length} Appointments`})]}),p&&e.jsx("div",{className:`p-3 rounded-md ${x==="error"?"bg-red-50 text-red-700":x==="success"?"bg-green-50 text-green-700":"bg-blue-50 text-blue-700"}`,children:p}),N&&o.length>0&&e.jsxs("div",{className:"border rounded-md p-4 max-h-96 overflow-y-auto",children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Preview (",o.length," appointments)"]}),e.jsx("div",{className:"space-y-2 text-sm",children:o.map((d,i)=>e.jsxs("div",{className:`p-2 rounded ${d.status==="open"?"bg-gray-50":d.status==="frozen"?"bg-yellow-50":"bg-blue-50"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-medium",children:[d.time," - ",d.doctorName]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${d.status==="open"?"bg-gray-200":d.status==="frozen"?"bg-yellow-200":d.isVirtual?"bg-purple-200":"bg-blue-200"}`,children:d.status==="open"?"OPEN":d.status==="frozen"?"FROZEN":d.isVirtual?"Virtual":"In-Person"})]}),d.patientName&&d.patientName!=="OPEN SLOT"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.patientName," ",d.patientAge&&`(${d.patientAge}yo ${d.patientGender})`]}),e.jsx("div",{className:"text-gray-600",children:d.visitReason})]}),e.jsxs("div",{className:"text-gray-500",children:[d.duration," min"]})]},i))})]})]})]})};function Be(){const M=Ce(),[a]=c.useState(ce.getCurrentUser()),[n]=c.useState(ce.getPermissions()),[s,o]=c.useState("patients"),[y,x]=c.useState(!1),[l,p]=c.useState(!1),[g,N]=c.useState(!1),[k,X]=c.useState(!1),[L,d]=c.useState(null),[i,V]=c.useState("all"),[U,Y]=c.useState("list"),[F,m]=c.useState(new Date),[C,J]=c.useState(!0),[E,he]=c.useState([]),[P,ee]=c.useState([]),[O,S]=c.useState([]),[z,I]=c.useState([]),[te,xe]=c.useState([]),[H,D]=c.useState("medications"),[v,q]=c.useState(new Date),[ae,se]=c.useState(new Map),ie=[{id:"all",name:"All Doctors",email:"all"},{id:"doc_adeleke",name:"Dr. Adenike Adeleke",email:"adeleke@tshla.ai"},{id:"doc_radha",name:"Dr. Radha Bernander",email:"radha@tshla.ai"},{id:"doc_tess",name:"Dr. Tess Chamakkala",email:"tess@tshla.ai"},{id:"doc_shannon",name:"Dr. Shannon Gregorek",email:"shannon@tshla.ai"},{id:"doc_vanessa",name:"Dr. Cindy Laverde",email:"vanessa@tshla.ai"},{id:"doc_elizabeth",name:"Dr. Elizabeth Leal",email:"elizabeth@tshla.ai"},{id:"doc_ogechi",name:"Dr. Ogechi Nebeolisa",email:"ogechi@tshla.ai"},{id:"doc_neha",name:"Dr. Neha Patel",email:"neha@tshla.ai"},{id:"doc_rakesh_patel",name:"Dr. Rakesh Patel",email:"rakesh.patel@tshla.ai"},{id:"doc_kruti",name:"Dr. Kruti Patel-Konasagar",email:"kruti@tshla.ai"},{id:"doc_preeya",name:"Dr. Preeya Raghu",email:"preeya@tshla.ai"},{id:"doc_elina",name:"Dr. Elina Shakya",email:"elina@tshla.ai"},{id:"doc_dilnavaz",name:"Dr. Dilnavaz Subawalla",email:"dilnavaz@tshla.ai"},{id:"doc_ghislaine",name:"Dr. Ghislaine Tonye",email:"ghislaine@tshla.ai"},{id:"doc_kamili",name:"Dr. Kamili Wade-Reescano",email:"kamili@tshla.ai"},{id:"doc_veena",name:"Dr. Veena Watwe",email:"veena@tshla.ai"},{id:"doc_nadia",name:"Dr. Nadia Younus",email:"nadia@tshla.ai"}],[_,Ne]=c.useState(""),[G,ue]=c.useState({patients:[],charts:[]}),[j,Z]=c.useState({firstName:"",lastName:"",dateOfBirth:"",phone:"",email:""}),[T,re]=c.useState({chartId:"",notes:""});c.useEffect(()=>{if(!a){M("/login");return}pe(),W.log("view","patient",void 0,{dashboard:"staff-workflow"})},[a,M]),c.useEffect(()=>{const t=()=>{const b=A.getCalendarData(v,i==="all"?void 0:i);se(b)};return window.addEventListener("appointmentsUpdated",t),()=>window.removeEventListener("appointmentsUpdated",t)},[v,i]);const pe=async()=>{try{const t=await W.getAuditLogs({limit:10});I(t);const b=w.getPendingActions();S(b);const f=A.getAppointments({weekOf:new Date});xe(f)}catch{Q("StaffWorkflowDashboard","Error message",{})}},ye=async()=>{try{if(!j.firstName&&!j.lastName&&!j.email){alert("Please provide at least one field (name or email)");return}const t=await Ie.registerPatient({firstName:j.firstName,lastName:j.lastName,dateOfBirth:j.dateOfBirth,phone:j.phone,email:j.email||`patient${Date.now()}@tshla.ai`,program:"pumpdrive"});await W.logCreate("patient",t.internalId,{name:`${t.firstName} ${t.lastName}`,avaId:t.patientAvaId}),he([...E,t]),d(t),x(!1),Z({firstName:"",lastName:"",dateOfBirth:"",phone:"",email:""}),alert(`Patient created!
AVA ID: ${t.patientAvaId}

You can now create a chart for this patient.`)}catch{Q("StaffWorkflowDashboard","Error message",{}),alert("Failed to create patient")}},ve=async()=>{if(!L){alert("Please select a patient first");return}try{const t=await me.createChart({patientId:L.internalId,clinicId:"default"});await W.logCreate("chart",t.chart.id,{patientId:L.internalId,avaId:t.avaId,tshId:t.tshId}),ee([...P,t.chart]),p(!1),alert(`Chart created successfully!

AVA ID (Patient Portal): ${t.avaId}
TSH ID (EMR/Doctor): ${t.tshId}

These IDs have been saved.`)}catch{Q("StaffWorkflowDashboard","Error message",{}),alert("Failed to create chart")}},je=async()=>{if(!T.chartId||!T.notes){alert("Please select a chart and enter notes");return}try{await me.addOldNotes(T.chartId,T.notes),await W.log("update","chart",T.chartId,{action:"added_old_notes",notesLength:T.notes.length}),re({chartId:"",notes:""}),N(!1),alert("Old notes added successfully")}catch{Q("StaffWorkflowDashboard","Error message",{}),alert("Failed to add old notes")}},ge=async()=>{if(!_){ue({patients:[],charts:[]});return}const t=E.filter(f=>f.firstName?.toLowerCase().includes(_.toLowerCase())||f.lastName?.toLowerCase().includes(_.toLowerCase())||f.email?.toLowerCase().includes(_.toLowerCase())||f.patientAvaId?.includes(_)),b=await me.searchCharts(_);ue({patients:t,charts:b})},we=()=>{W.logLogout(),ce.logout(),M("/login")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Staff Workflow Dashboard"}),e.jsxs("span",{className:"ml-4 text-sm text-gray-500",children:[a?.name," (",a?.role,")"]})]}),e.jsx("button",{onClick:we,className:"text-sm text-red-600 hover:text-red-800",children:"Logout"})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>o("patients"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="patients"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Patients"}),e.jsx("button",{onClick:()=>o("charts"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="charts"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Charts"}),e.jsx("button",{onClick:()=>o("calendar"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="calendar"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Calendar"}),e.jsxs("button",{onClick:()=>o("actions"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="actions"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Action Items",w.getPendingCount()>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:w.getPendingCount()})]}),e.jsx("button",{onClick:()=>o("import"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="import"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Import Schedule"})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search patients by name, email, AVA ID, or TSH ID...",value:_,onChange:t=>Ne(t.target.value),onKeyDown:t=>t.key==="Enter"&&ge(),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{onClick:ge,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Search"})]}),(G.patients.length>0||G.charts.length>0)&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Search Results"}),G.patients.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Patients:"}),G.patients.map(t=>e.jsxs("div",{className:"text-sm text-gray-600",children:[t.firstName," ",t.lastName," - AVA: ",t.patientAvaId]},t.internalId))]}),G.charts.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Charts:"}),G.charts.map(t=>e.jsxs("div",{className:"text-sm text-gray-600",children:["AVA: ",t.avaId," | TSH: ",t.tshId]},t.id))]})]})]}),s==="patients"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Patients"}),e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"+ New Patient"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"How to Get Started"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:'Click "New Patient" to create a patient (not all fields required)'}),e.jsx("li",{children:"After creating a patient, you'll receive their AVA ID"}),e.jsx("li",{children:'Click "Create Chart" to generate both AVA and TSH IDs'}),e.jsx("li",{children:"Use TSH ID for EMR/doctor access, AVA ID for patient portal"})]})]}),E.length>0?e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:E.map(t=>e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50 cursor-pointer",onClick:()=>d(t),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[t.firstName," ",t.lastName]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["AVA: ",t.patientAvaId," | Email: ",t.email]})]}),e.jsx("button",{onClick:b=>{b.stopPropagation(),d(t),p(!0)},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Create Chart"})]})})},t.internalId))})}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No patients yet"}),e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Create Your First Patient"})]})]}),s==="charts"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Charts"}),e.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:P.length===0,children:"+ Add Old Notes"})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-amber-900 mb-2",children:"Understanding Chart IDs"}),e.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"AVA ID:"})," For patient portal access (cross-clinic)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"TSH ID:"})," For EMR/doctor use (clinic-specific)"]})]})]}),P.length>0?e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:P.map(t=>e.jsx("li",{children:e.jsx("div",{className:"px-4 py-4 sm:px-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Chart ID: ",t.id]}),e.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:["AVA: ",t.avaId]}),e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["TSH: ",t.tshId]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})]})})})},t.id))})}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"No charts created yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Create a patient first, then create their chart"})]})]}),s==="calendar"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Calendar"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"View calendar for:"}),e.jsx("select",{value:i,onChange:t=>V(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:ie.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:i==="all"?"All Doctors - Combined Schedule":`${ie.find(t=>t.id===i)?.name}'s Schedule`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{const t=new Date(v);t.setDate(t.getDate()-7),q(t)},className:"p-1 hover:bg-gray-200 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Week of ",new Date(v).toLocaleDateString()]}),e.jsx("button",{onClick:()=>{const t=new Date(v);t.setDate(t.getDate()+7),q(t)},className:"p-1 hover:bg-gray-200 rounded",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[A.getAppointmentCount(i==="all"?void 0:i)," total appointments"]}),e.jsxs("select",{value:U,onChange:t=>Y(t.target.value),className:"px-2 py-1 text-sm border rounded",children:[e.jsx("option",{value:"week",children:"Week View"}),e.jsx("option",{value:"day",children:"Day View"}),e.jsx("option",{value:"list",children:"List View"})]}),e.jsxs("label",{className:"flex items-center space-x-1 text-sm",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>J(t.target.checked),className:"rounded"}),e.jsx("span",{children:"Show All"})]}),e.jsx("input",{type:"date",value:F.toISOString().split("T")[0],onChange:t=>{const b=new Date(t.target.value);m(b),q(b),J(!1)},className:"px-2 py-1 text-sm border rounded",disabled:C}),e.jsx("button",{onClick:()=>X(!0),className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700",children:"📥 Import Schedule"}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to clear ALL appointments? This cannot be undone.")&&(A.clearAllAppointments(),window.location.reload())},className:"px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700",children:"🗑️ Clear All"}),e.jsx("button",{className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add Appointment"})]})]})}),U==="list"?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-2",children:(()=>{const t=C?new Date("2000-01-01"):(()=>{const r=new Date(v),h=r.getDay();return r.setDate(r.getDate()-h+(h===0?-6:1)),r})(),b=C?new Date("2100-01-01"):(()=>{const r=new Date(t);return r.setDate(r.getDate()+6),r})(),f=A.getAppointments();$("StaffWorkflowDashboard","Debug message",{}),$("StaffWorkflowDashboard","Debug message",{}),f.length>0&&(f.map(r=>({date:r.date,patient:r.patientName,doctorId:r.doctorId,doctorName:r.doctorName})),f.reduce((r,h)=>(r[h.doctorId]=(r[h.doctorId]||0)+1,r),{}),$("StaffWorkflowDashboard","Debug message",{})),$("StaffWorkflowDashboard","Debug message",{},{endDate:b.toISOString(),selectedDate:F.toISOString()});const R=f.filter(r=>{if(i!=="all"&&r.doctorId!==i)return!1;let h;if(r.date.includes("/")){const[u,K,ne]=r.date.split("/");h=new Date(`${ne}-${u.padStart(2,"0")}-${K.padStart(2,"0")}`)}else h=new Date(r.date);return isNaN(h.getTime())?($("StaffWorkflowDashboard","Debug message",{}),!1):C?!0:h>=t&&h<=b}).sort((r,h)=>{const u=r.date.includes("/")?(()=>{const[oe,de,le]=r.date.split("/");return new Date(`${le}-${oe.padStart(2,"0")}-${de.padStart(2,"0")}`)})():new Date(r.date),K=h.date.includes("/")?(()=>{const[oe,de,le]=h.date.split("/");return new Date(`${le}-${oe.padStart(2,"0")}-${de.padStart(2,"0")}`)})():new Date(h.date),ne=u.getTime()-K.getTime();if(ne!==0)return ne;const De=new Date(`2000-01-01 ${r.time}`).getTime(),Ae=new Date(`2000-01-01 ${h.time}`).getTime();return De-Ae});if($("StaffWorkflowDashboard","Debug message",{}),$("StaffWorkflowDashboard","Debug message",{}),$("StaffWorkflowDashboard","Debug message",{}),R.length===0)return e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No appointments found for the selected period"}),e.jsxs("p",{className:"text-sm mt-2",children:["Total appointments in system: ",f.length]}),!C&&f.length>0&&e.jsx("p",{className:"text-sm mt-1",children:'Try checking "Show All" to see all appointments'})]});const B=R.reduce((r,h)=>{const u=h.date;return r[u]||(r[u]=[]),r[u].push(h),r},{});return Object.entries(B).map(([r,h])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3",children:[new Date(r).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",h.length," appointments)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:h.map(u=>e.jsx("div",{className:`p-2 rounded border ${A.getDoctorColor(u.doctorId)}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:u.time}),e.jsx("div",{className:"text-sm",children:u.patientName}),e.jsx("div",{className:"text-xs text-gray-600",children:u.doctorName}),e.jsx("div",{className:"text-xs text-gray-500",children:u.visitType})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",u.patientId]})]})},u.id))})]},r))})()})}):U==="day"?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-0 border-t border-l",children:[e.jsx("div",{className:"border-r border-b bg-gray-50",children:e.jsx("div",{className:"h-12 flex items-center justify-center text-xs font-medium text-gray-500",children:"Time"})}),e.jsx("div",{className:"border-r border-b bg-gray-50",children:e.jsx("div",{className:"h-12 flex items-center justify-center text-xs font-medium text-gray-900",children:F.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})})}),["8:00 AM","9:00 AM","10:00 AM","11:00 AM","12:00 PM","1:00 PM","2:00 PM","3:00 PM","4:00 PM","5:00 PM","6:00 PM"].map(t=>{const f=A.getCalendarData(F,i==="all"?void 0:i).get(t),R=F.toISOString().split("T")[0],B=f?.get(R)||[];return e.jsxs(be.Fragment,{children:[e.jsx("div",{className:"border-r border-b bg-gray-50",children:e.jsx("div",{className:"h-20 px-2 py-1 text-xs text-gray-500",children:t})}),e.jsx("div",{className:"border-r border-b hover:bg-blue-50 cursor-pointer relative",children:e.jsx("div",{className:"h-20 p-1 overflow-y-auto",children:B.map((r,h)=>e.jsxs("div",{className:`${A.getDoctorColor(r.doctorId)} text-xs p-1 rounded border mb-1`,title:`${r.patientName}
${r.visitReason}
${r.notes||""}`,children:[i==="all"&&e.jsx("div",{className:"font-semibold truncate",children:r.doctorName}),e.jsx("div",{className:"truncate",children:r.patientName}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:r.visitType})]},r.id))})})]},t)})]})}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-8 gap-0 border-t border-l",children:[e.jsx("div",{className:"border-r border-b bg-gray-50",children:e.jsx("div",{className:"h-12 flex items-center justify-center text-xs font-medium text-gray-500",children:"Time"})}),["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(t=>e.jsx("div",{className:"border-r border-b bg-gray-50",children:e.jsx("div",{className:"h-12 flex items-center justify-center text-xs font-medium text-gray-900",children:t})},t)),["8:00 AM","9:00 AM","10:00 AM","11:00 AM","12:00 PM","1:00 PM","2:00 PM","3:00 PM","4:00 PM","5:00 PM"].map(t=>{const f=A.getCalendarData(v,i==="all"?void 0:i).get(t),R=Array.from({length:7},(B,r)=>{const h=new Date(v),u=h.getDay(),K=h.getDate()-u+(u===0?-6:1)+r;return h.setDate(K),h.toISOString().split("T")[0]});return e.jsxs(be.Fragment,{children:[e.jsx("div",{className:"border-r border-b bg-gray-50",children:e.jsx("div",{className:"h-20 px-2 py-1 text-xs text-gray-500",children:t})}),R.map((B,r)=>{const h=f?.get(B)||[];return e.jsx("div",{className:"border-r border-b hover:bg-blue-50 cursor-pointer relative",children:e.jsx("div",{className:"h-20 p-1 overflow-hidden",children:h.map((u,K)=>e.jsxs("div",{className:`${A.getDoctorColor(u.doctorId)} text-xs p-1 rounded border mb-1`,title:`${u.patientName}
${u.visitReason}
${u.notes||""}`,children:[i==="all"&&e.jsx("div",{className:"font-semibold truncate",children:u.doctorName}),e.jsx("div",{className:"truncate",children:u.patientName}),e.jsx("div",{className:"text-xs opacity-75 truncate",children:u.visitType})]},u.id))})},`${t}-${r}`)})]},t)})]})}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 border-t",children:e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 rounded mr-1"}),e.jsx("span",{children:"Dr. Patel"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-100 rounded mr-1"}),e.jsx("span",{children:"Dr. Watwe"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 rounded mr-1"}),e.jsx("span",{children:"Dr. Chamakkala"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-100 rounded mr-1"}),e.jsx("span",{children:"Dr. Bernander"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-100 rounded mr-1"}),e.jsx("span",{children:"Dr. Gregroek"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-100 rounded mr-1"}),e.jsx("span",{children:"Dr. Shakya"})]})]})})]})]}),s==="actions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Action Items from Dictation"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by doctor:"}),e.jsx("select",{value:i,onChange:t=>{V(t.target.value);const b=w.getPendingActions(t.target.value==="all"?void 0:{doctorId:t.target.value});S(b)},className:"px-3 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:ie.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8 px-6","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>D("medications"),className:`py-3 px-1 border-b-2 font-medium text-sm ${H==="medications"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Medications",w.getPendingCount("medication")>0&&e.jsx("span",{className:"ml-2 bg-indigo-100 text-indigo-600 text-xs rounded-full px-2 py-0.5",children:w.getPendingCount("medication")})]}),e.jsxs("button",{onClick:()=>D("labs"),className:`py-3 px-1 border-b-2 font-medium text-sm ${H==="labs"?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["Lab Orders",w.getPendingCount("lab")>0&&e.jsx("span",{className:"ml-2 bg-indigo-100 text-indigo-600 text-xs rounded-full px-2 py-0.5",children:w.getPendingCount("lab")})]})]})}),e.jsxs("div",{className:"p-6",children:[H==="medications"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Medication Orders to Process"}),O.filter(t=>t.itemType==="medication").length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No pending medication orders"}):e.jsx("div",{className:"space-y-3",children:O.filter(t=>t.itemType==="medication").map(t=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:t.details?.action||"Action"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.action})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsxs("p",{children:["Patient: ",e.jsx("span",{className:"font-medium",children:t.patientName})]}),e.jsxs("p",{children:["Doctor: ",e.jsx("span",{className:"font-medium",children:t.doctorName})]}),e.jsxs("p",{children:["Extracted: ",new Date(t.dateExtracted).toLocaleString()]})]})]}),e.jsx("button",{onClick:()=>{if(w.processAction(t.id,a?.name||"Staff")){const b=w.getPendingActions(i==="all"?void 0:{doctorId:i});S(b)}},className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700",children:"Process"})]})},t.id))})]}),H==="labs"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-4",children:"Lab Orders to Process"}),O.filter(t=>t.itemType==="lab").length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No pending lab orders"}):e.jsx("div",{className:"space-y-3",children:O.filter(t=>t.itemType==="lab").map(t=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:"Lab Order"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.action})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsxs("p",{children:["Patient: ",e.jsx("span",{className:"font-medium",children:t.patientName})]}),e.jsxs("p",{children:["Doctor: ",e.jsx("span",{className:"font-medium",children:t.doctorName})]}),e.jsxs("p",{children:["Extracted: ",new Date(t.dateExtracted).toLocaleString()]})]})]}),e.jsx("button",{onClick:()=>{if(w.processAction(t.id,a?.name||"Staff")){const b=w.getPendingActions(i==="all"?void 0:{doctorId:i});S(b)}},className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700",children:"Process"})]})},t.id))})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Action Management"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"Actions are automatically extracted from doctor's dictation notes during appointments."}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:async()=>{await w.regenerateWithRealData();const t=w.getPendingActions(i==="all"?void 0:{doctorId:i});S(t),alert("Actions regenerated with real patient appointment data!")},className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700",children:"Load Real Patient Actions"}),e.jsx("button",{onClick:async()=>{const t="Start metformin 500mg BID. Increase lisinopril to 20mg daily. Stop atorvastatin. Order A1C, CMP, and lipid panel.",b=A.getAppointments({weekOf:new Date}),f=b[Math.floor(Math.random()*b.length)];if(f){const R=await w.extractAndSaveActions(t,f.patientId,f.patientName,f.doctorId,f.doctorName),B=w.getPendingActions(i==="all"?void 0:{doctorId:i});S(B),alert(`Extracted ${R.length} action items for ${f.patientName}!`)}},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add Test Dictation"}),e.jsx("button",{onClick:()=>{w.clearAllActions(),S([]),alert("All actions cleared!")},className:"px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700",children:"Clear All"})]})]})})]})]})]}),s==="import"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Me,{})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Patient"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Not all fields are required - provide what you have"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"First Name (optional)",value:j.firstName,onChange:t=>Z({...j,firstName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),e.jsx("input",{type:"text",placeholder:"Last Name (optional)",value:j.lastName,onChange:t=>Z({...j,lastName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),e.jsx("input",{type:"date",placeholder:"Date of Birth",value:j.dateOfBirth,onChange:t=>Z({...j,dateOfBirth:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),e.jsx("input",{type:"tel",placeholder:"Phone (optional)",value:j.phone,onChange:t=>Z({...j,phone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),e.jsx("input",{type:"email",placeholder:"Email (optional)",value:j.email,onChange:t=>Z({...j,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:ye,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Create Patient"})]})]})}),l&&L&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create Chart"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Creating chart for: ",e.jsxs("strong",{children:[L.firstName," ",L.lastName]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Current AVA ID: ",e.jsx("strong",{children:L.patientAvaId})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-6",children:e.jsx("p",{className:"text-sm text-blue-700",children:"This will generate a new TSH ID for EMR use while keeping the existing AVA ID for patient portal access."})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:ve,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Create Chart"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add Old Notes to Chart"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("select",{value:T.chartId,onChange:t=>re({...T,chartId:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Select a chart..."}),P.map(t=>e.jsxs("option",{value:t.id,children:["AVA: ",t.avaId," | TSH: ",t.tshId]},t.id))]}),e.jsx("textarea",{placeholder:"Paste old notes here...",value:T.notes,onChange:t=>re({...T,notes:t.target.value}),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:je,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Add Notes"})]})]})}),e.jsx(Se,{isOpen:k,onClose:()=>X(!1),onImportComplete:()=>{const t=A.getCalendarData(v,i==="all"?void 0:i);se(t),pe()}}),e.jsxs("div",{className:"fixed right-0 top-16 w-64 h-screen bg-white border-l p-4 overflow-y-auto",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:z.length>0?z.map(t=>e.jsxs("div",{className:"text-xs text-gray-600 pb-2 border-b",children:[e.jsxs("p",{className:"font-medium text-gray-800",children:[t.action," - ",t.entityType]}),e.jsx("p",{className:"text-gray-600",children:t.actorName||t.actorId}),e.jsx("p",{className:"text-gray-500",children:new Date(t.createdAt).toLocaleString()})]},t.id)):e.jsx("p",{className:"text-sm text-gray-500",children:"No recent activity"})})]})]})}export{Be as default};
//# sourceMappingURL=StaffWorkflowDashboard-CqNuFBsl.js.map
