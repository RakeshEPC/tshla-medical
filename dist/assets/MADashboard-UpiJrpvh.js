import{g as C,f as T,u as L,r as u,b as f,j as e}from"./index-JAW6HvUl.js";import{g as U,p as w,a as k}from"./patientMaster.service-CQ1I3A0J.js";class q{db=U();async createOrdersFromExtraction(s,r,a,i,n){const d=[],x=(await w.getPatientById(r,"uuid"))?.name||"Unknown Patient";for(const o of s.medications)d.push(await this.createOrder({patient_id:r,doctor_id:a,order_type:"medication",order_text:o.text,action:o.action,urgency:o.urgency||"routine",source_dictation_id:n,patient_name:x,doctor_name:i}));for(const o of s.labs)d.push(await this.createOrder({patient_id:r,doctor_id:a,order_type:"lab",order_text:o.text,action:o.action,urgency:o.urgency||"routine",source_dictation_id:n,patient_name:x,doctor_name:i}));for(const o of s.imaging)d.push(await this.createOrder({patient_id:r,doctor_id:a,order_type:"imaging",order_text:o.text,action:o.action,urgency:o.urgency||"routine",source_dictation_id:n,patient_name:x,doctor_name:i}));for(const o of s.priorAuths)d.push(await this.createOrder({patient_id:r,doctor_id:a,order_type:"prior_auth",order_text:o.text,action:o.action,urgency:o.urgency||"routine",source_dictation_id:n,patient_name:x,doctor_name:i}));for(const o of s.referrals)d.push(await this.createOrder({patient_id:r,doctor_id:a,order_type:"referral",order_text:o.text,action:o.action,urgency:o.urgency||"routine",source_dictation_id:n,patient_name:x,doctor_name:i}));return C("maOrders","Info message",{}),d}async createOrder(s){const r={...s,order_id:k(),status:"pending",created_at:new Date,priority_score:this.calculatePriority(s.order_type,s.urgency),estimated_time_minutes:this.estimateCompletionTime(s.order_type)};return await this.db.execute("add:orders",r),await this.logOrderAction(r.order_id,"order_created",{doctor_id:s.doctor_id,patient_id:s.patient_id,order_type:s.order_type}),r}async getAllPendingOrders(){return(await this.db.query("orders")).filter(r=>r.status==="pending").sort((r,a)=>{if(r.urgency!==a.urgency){const i={stat:3,urgent:2,routine:1};return(i[a.urgency]||1)-(i[r.urgency]||1)}return r.priority_score!==a.priority_score?a.priority_score-r.priority_score:new Date(r.created_at).getTime()-new Date(a.created_at).getTime()})}async getOrdersByMA(s,r){return(await this.db.query("orders")).filter(i=>{const n=i.ma_id===s,d=!r||i.status===r;return n&&d})}async getOrdersByDoctor(s,r){return(await this.db.query("orders")).filter(i=>{const n=i.doctor_id===s,d=!r||i.status===r;return n&&d})}async assignOrderToMA(s,r,a){const i=await this.getOrderById(s);if(!i)throw new Error("Order not found");const n={...i,ma_id:r,status:"in_progress",assigned_at:new Date,started_at:new Date};await this.db.execute("put:orders",n),await this.logOrderAction(s,"order_assigned",{ma_id:r,ma_name:a})}async completeOrder(s,r,a,i){const n=await this.getOrderById(s);if(!n)throw new Error("Order not found");const d={...n,status:"completed",completed_at:new Date,completed_by:r,notes:i||n.notes};await this.db.execute("put:orders",d),await this.logOrderAction(s,"order_completed",{ma_id:r,ma_name:a,completion_notes:i}),C("maOrders","Info message",{})}async getOrderById(s){try{return await this.db.queryOne("orders",s)||null}catch{return null}}async getOrderStats(){const s=await this.db.query("orders");return{pending:s.filter(r=>r.status==="pending").length,inProgress:s.filter(r=>r.status==="in_progress").length,completed:s.filter(r=>r.status==="completed").length,urgent:s.filter(r=>r.urgency==="urgent"||r.urgency==="stat").length,total:s.length}}async getMAWorkloads(){const s=await this.db.query("orders"),r={},a=new Date().toDateString();[...new Set(s.map(n=>n.ma_id).filter(Boolean))].forEach(n=>{r[n]={ma_id:n,ma_name:n,pending_orders:0,in_progress_orders:0,completed_today:0,total_workload:0,avg_completion_time:0}});for(const n of s){if(!n.ma_id)continue;r[n.ma_id]||(r[n.ma_id]={ma_id:n.ma_id,ma_name:n.ma_id,pending_orders:0,in_progress_orders:0,completed_today:0,total_workload:0,avg_completion_time:0});const d=r[n.ma_id];n.status==="pending"&&d.pending_orders++,n.status==="in_progress"&&d.in_progress_orders++,n.status==="completed"&&new Date(n.completed_at).toDateString()===a&&d.completed_today++,d.total_workload=d.pending_orders+d.in_progress_orders}return Object.values(r)}async autoAssignOrders(){const s=await this.getAllPendingOrders(),r=await this.getMAWorkloads(),a=[];let i=0;if(r.length===0)return{assigned:0,errors:["No MAs available for assignment"]};for(const n of s.slice(0,10))try{const d=r.reduce((h,x)=>x.total_workload<h.total_workload?x:h);await this.assignOrderToMA(n.order_id,d.ma_id,d.ma_name),d.total_workload++,i++}catch(d){a.push(`Failed to assign order ${n.order_id}: ${d}`)}return{assigned:i,errors:a}}calculatePriority(s,r){let a=5;switch(r){case"stat":a+=5;break;case"urgent":a+=3;break}switch(s){case"medication":a+=2;break;case"lab":a+=2;break;case"prior_auth":a+=3;break;case"imaging":a+=1;break;case"referral":a+=1;break}return Math.min(a,10)}estimateCompletionTime(s){switch(s){case"medication":return 5;case"lab":return 10;case"imaging":return 15;case"prior_auth":return 30;case"referral":return 20;default:return 10}}async logOrderAction(s,r,a){const i={log_id:k(),order_id:s,action_type:r,details:JSON.stringify(a||{}),timestamp:new Date,user_agent:navigator.userAgent};await this.db.execute("add:ma_actions_log",{...i,ma_id:a?.ma_id||"system",patient_id:a?.patient_id||""})}async getRecentActivity(s=20){return(await this.db.query("ma_actions_log")).filter(a=>a.action_type.includes("order")).sort((a,i)=>new Date(i.timestamp).getTime()-new Date(a.timestamp).getTime()).slice(0,s)}async cleanupOldOrders(){const s=await this.db.query("orders"),r=new Date;r.setDate(r.getDate()-30);let a=0;for(const i of s)i.status==="completed"&&i.completed_at&&new Date(i.completed_at)<r&&(await this.db.execute("delete:orders",i.order_id),a++);return a}}const j=new q;function F(){const{user:m}=T(),s=L(),[r,a]=u.useState("orders"),[i,n]=u.useState([]),[d,h]=u.useState(null),[x,o]=u.useState([]),[D,S]=u.useState(!0),[g,P]=u.useState(""),[l,_]=u.useState(null),[c,p]=u.useState({name:"",dob:"",email:"",phone:"",emr_number:"",address:"",insurance_info:"",emergency_contact:""});u.useEffect(()=>{if(!m||m.role!=="medical_assistant"){s("/login");return}y();const t=setInterval(y,1e4);return()=>clearInterval(t)},[m,s]);const y=async()=>{try{const[t,b,E]=await Promise.all([j.getAllPendingOrders(),j.getOrderStats(),w.getAllActivePatients()]);n(t),h(b),o(E)}catch{f("MADashboard","Error message",{})}finally{S(!1)}},N=async t=>{try{await j.completeOrder(t.order_id,m.id,m.name,`Completed by ${m.name}`),await y(),_(null)}catch{f("MADashboard","Error message",{}),alert("Failed to complete order")}},v=async t=>{try{await j.assignOrderToMA(t.order_id,m.id,m.name),await y()}catch{f("MADashboard","Error message",{}),alert("Failed to assign order")}},M=async t=>{if(t.preventDefault(),!c.name||!c.dob){alert("Name and Date of Birth are required");return}try{await w.createPatient({...c,created_by_ma_id:m.id},m.id),p({name:"",dob:"",email:"",phone:"",emr_number:"",address:"",insurance_info:"",emergency_contact:""}),await y(),alert("Patient created successfully with AVA and TSH numbers!")}catch(b){f("MADashboard","Error message",{}),alert(b.message||"Failed to create patient")}},O=i.filter(t=>t.patient_name?.toLowerCase().includes(g.toLowerCase())||t.doctor_name?.toLowerCase().includes(g.toLowerCase())||t.order_text.toLowerCase().includes(g.toLowerCase())),A=x.filter(t=>t.name.toLowerCase().includes(g.toLowerCase())||t.ava_number.includes(g.toLowerCase())||t.tsh_number.includes(g.toLowerCase())||t.emr_number&&t.emr_number.includes(g.toLowerCase()));return D?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading MA Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Medical Assistant Dashboard"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Welcome back, ",m?.name]})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("orders"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${r==="orders"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"ðŸ“‹ Orders Management"}),e.jsx("button",{onClick:()=>a("chart-prep"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${r==="chart-prep"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"ðŸ“Š Chart Prep Station"})]})]}),d&&e.jsxs("div",{className:"grid grid-cols-5 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d.pending}),e.jsx("div",{className:"text-sm text-blue-800",children:"Pending Orders"})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:d.inProgress}),e.jsx("div",{className:"text-sm text-yellow-800",children:"In Progress"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.completed}),e.jsx("div",{className:"text-sm text-green-800",children:"Completed"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.urgent}),e.jsx("div",{className:"text-sm text-red-800",children:"Urgent"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:d.total}),e.jsx("div",{className:"text-sm text-gray-800",children:"Total Orders"})]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:r==="orders"?"Search orders by patient, doctor, or order text...":"Search patients by name, AVA#, TSH#, or EMR#...",value:g,onChange:t=>P(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),r==="orders"?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Pending Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Orders from all doctors needing attention"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Doctor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Urgency"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Priority"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.patient_name||"Unknown"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.doctor_name||"Unknown"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.order_type==="medication"?"bg-blue-100 text-blue-800":t.order_type==="lab"?"bg-green-100 text-green-800":t.order_type==="imaging"?"bg-purple-100 text-purple-800":t.order_type==="prior_auth"?"bg-red-100 text-red-800":t.order_type==="referral"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.order_type.replace("_"," ").toUpperCase()})}),e.jsxs("td",{className:"px-6 py-4 max-w-xs",children:[e.jsx("div",{className:"text-sm text-gray-900 truncate",title:t.order_text,children:t.order_text}),t.action&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Action: ",t.action.toUpperCase()]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.urgency==="stat"?"bg-red-100 text-red-800":t.urgency==="urgent"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:t.urgency.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${t.priority_score>=8?"bg-red-500":t.priority_score>=6?"bg-yellow-500":"bg-green-500"}`}),e.jsxs("span",{className:"text-sm text-gray-900",children:[t.priority_score,"/10"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[t.status==="pending"&&e.jsx("button",{onClick:()=>v(t),className:"text-blue-600 hover:text-blue-900",children:"Assign to Me"}),t.ma_id===m?.id&&e.jsx("button",{onClick:()=>N(t),className:"text-green-600 hover:text-green-900",children:"âœ“ Complete"}),e.jsx("button",{onClick:()=>_(t),className:"text-gray-600 hover:text-gray-900",children:"View"})]})]},t.order_id))})]})}),O.length===0&&e.jsx("div",{className:"px-6 py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No pending orders found."})})]})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Patient"}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",required:!0,value:c.name,onChange:t=>p({...c,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth *"}),e.jsx("input",{type:"date",required:!0,value:c.dob,onChange:t=>p({...c,dob:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:c.email,onChange:t=>p({...c,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:c.phone,onChange:t=>p({...c,phone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"EMR Number (Optional)"}),e.jsx("input",{type:"text",value:c.emr_number,onChange:t=>p({...c,emr_number:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"From external EMR system"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Insurance Information"}),e.jsx("textarea",{value:c.insurance_info,onChange:t=>p({...c,insurance_info:t.target.value}),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Create Patient (Auto-generate AVA & TSH Numbers)"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Patients"}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:A.slice(0,10).map(t=>e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["DOB: ",t.dob]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["AVA: ",t.ava_number," | TSH: ",t.tsh_number]}),t.emr_number&&e.jsxs("div",{className:"text-sm text-gray-500",children:["EMR: ",t.emr_number]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Created ",new Date(t.created_at).toLocaleDateString()]})]})},t.patient_id))}),A.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No patients found."})})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Details"}),e.jsx("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-gray-600",children:"Ã—"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Patient:"}),e.jsx("p",{className:"text-gray-900",children:l.patient_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Doctor:"}),e.jsx("p",{className:"text-gray-900",children:l.doctor_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Order Type:"}),e.jsx("p",{className:"text-gray-900",children:l.order_type.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Order Text:"}),e.jsx("p",{className:"text-gray-900",children:l.order_text})]}),l.action&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Action:"}),e.jsx("p",{className:"text-gray-900",children:l.action.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Urgency:"}),e.jsx("p",{className:"text-gray-900",children:l.urgency.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Priority Score:"}),e.jsxs("p",{className:"text-gray-900",children:[l.priority_score,"/10"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Estimated Time:"}),e.jsxs("p",{className:"text-gray-900",children:[l.estimated_time_minutes," minutes"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Created:"}),e.jsx("p",{className:"text-gray-900",children:new Date(l.created_at).toLocaleString()})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[l.status==="pending"&&e.jsx("button",{onClick:()=>v(l),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"Assign to Me"}),l.ma_id===m?.id&&l.status==="in_progress"&&e.jsx("button",{onClick:()=>N(l),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700",children:"Complete Order"}),e.jsx("button",{onClick:()=>_(null),className:"bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400",children:"Close"})]})]})})})]})}export{F as default};
//# sourceMappingURL=MADashboard-UpiJrpvh.js.map
