# Orders Extraction - System Architecture

## ğŸ“ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TSHLA Medical                            â”‚
â”‚                   Orders Extraction System                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MedicalDictation.tsx                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  - Voice Recording Interface                      â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  - Transcript Display                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  - "Process with AI" Button                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  - extractedOrders State                          â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚         â†“                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  OrdersDisplay.tsx  â­ NEW                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Color-coded order categories             â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Action badges (START, STOP, etc.)        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Urgency indicators (STAT, URGENT)        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Confidence scores                         â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Copy to clipboard functionality          â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Collapsible sections                     â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BUSINESS LOGIC LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  azureAI.service.ts                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  processMedicalTranscription()                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Receives raw transcript                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Calls AI model (GPT-4o / Claude)               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Generates structured SOAP note                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Returns: formatted note + extractedOrders       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  orderExtraction.service.ts  â­ ENHANCED                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  extractOrders(text)                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ splitIntoSentences()                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ extractMedicationOrder()  [150+ meds]          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ extractLabOrder()         [100+ tests]         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ extractImagingOrder()                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ extractPriorAuth()                             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ extractReferral()                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  calculateConfidence()  â­ NEW                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Action word detection (+0.2)                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Specific term recognition (+0.25)               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Dosage information (+0.15)                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Frequency detection (+0.1)                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Vague language penalty (-0.15)                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Question penalty (-0.2)                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  = Final score: 0.0 to 1.0                         â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  dictatedNotesService.ts  â­ ENHANCED                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  saveFromDictationSession()                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Accepts extractedOrders parameter               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Persists to database                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Returns note ID                                 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA ACCESS LAYER                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Supabase PostgreSQL Database                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  dictated_notes table                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ id, provider_id, patient_name                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ raw_transcript, processed_note                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ extracted_orders JSONB  â­ NEW                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     {                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "medications": [...],                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "labs": [...],                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "imaging": [...],                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "priorAuths": [...],                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       "referrals": [...]                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     }                                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  extracted_orders table  â­ NEW                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ id, note_id (FK)                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ order_type, order_text, action                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ urgency, confidence_score                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ status, priority_score                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ assigned_to_ma_id, completed_at                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ patient_name, provider_id                      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Views & Functions                                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ v_pending_orders_with_notes                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ v_ma_workload_summary                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ get_pending_orders_for_ma()                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ get_order_statistics()                         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Row Level Security (RLS)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Providers see only their orders                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ MAs can view all orders                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ MAs can update for completion                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Only providers can delete                      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Doctor    â”‚
â”‚  Dictates   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Start metformin 500mg twice daily.
       â”‚  Order A1C and CMP."
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MedicalDictation Component     â”‚
â”‚  - Records audio                â”‚
â”‚  - Converts to text (Deepgram)  â”‚
â”‚  - Shows transcript             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Click "Process with AI"
       â”‚ transcript = "Start metformin..."
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  azureAI.service.ts             â”‚
â”‚  processMedicalTranscription()  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Send to GPT-4o/Claude  â”‚ â”‚
â”‚  â”‚ 2. Generate SOAP note     â”‚ â”‚
â”‚  â”‚ 3. Call order extraction  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  orderExtraction.service.ts     â”‚
â”‚  extractOrders(transcript)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. Split into sentences   â”‚ â”‚
â”‚  â”‚ 2. Check medication words â”‚ â”‚
â”‚  â”‚    - Found: "metformin"   â”‚ â”‚
â”‚  â”‚    - Action: "start"      â”‚ â”‚
â”‚  â”‚    - Dosage: "500mg"      â”‚ â”‚
â”‚  â”‚    - Frequency: "twice"   â”‚ â”‚
â”‚  â”‚    â†’ Confidence: 0.95     â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚ 3. Check lab words        â”‚ â”‚
â”‚  â”‚    - Found: "A1C", "CMP"  â”‚ â”‚
â”‚  â”‚    - Action: "order"      â”‚ â”‚
â”‚  â”‚    â†’ Confidence: 0.90     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ Returns OrderExtractionResult
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  {                               â”‚
â”‚    medications: [                â”‚
â”‚      {                           â”‚
â”‚        type: "medication",       â”‚
â”‚        text: "Start metformin...",
â”‚        action: "start",          â”‚
â”‚        confidence: 0.95,         â”‚
â”‚        urgency: "routine"        â”‚
â”‚      }                           â”‚
â”‚    ],                            â”‚
â”‚    labs: [                       â”‚
â”‚      {                           â”‚
â”‚        type: "lab",              â”‚
â”‚        text: "Order A1C and CMP",â”‚
â”‚        action: "order",          â”‚
â”‚        confidence: 0.90,         â”‚
â”‚        urgency: "routine"        â”‚
â”‚      }                           â”‚
â”‚    ],                            â”‚
â”‚    imaging: [],                  â”‚
â”‚    priorAuths: [],               â”‚
â”‚    referrals: []                 â”‚
â”‚  }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MedicalDictation Component     â”‚
â”‚  - Receives result              â”‚
â”‚  - Sets extractedOrders state   â”‚
â”‚  - Renders OrdersDisplay        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OrdersDisplay Component        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“‹ Orders for Staff        â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚ ğŸŸ¢ MEDICATIONS      â”‚   â”‚ â”‚
â”‚  â”‚ â”‚ 1. START: Metformin â”‚   â”‚ â”‚
â”‚  â”‚ â”‚    500mg twice dailyâ”‚   â”‚ â”‚
â”‚  â”‚ â”‚    [95% confidence] â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ”µ LABS             â”‚   â”‚ â”‚
â”‚  â”‚ â”‚ 1. Order A1C and CMPâ”‚   â”‚ â”‚
â”‚  â”‚ â”‚    [90% confidence] â”‚   â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚ [Copy All] [Collapse]     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“ User clicks "Save Note"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dictatedNotesService           â”‚
â”‚  saveFromDictationSession()     â”‚
â”‚  - Includes extractedOrders     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase Database              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ dictated_notes table      â”‚ â”‚
â”‚  â”‚ â”œâ”€ raw_transcript         â”‚ â”‚
â”‚  â”‚ â”œâ”€ processed_note         â”‚ â”‚
â”‚  â”‚ â””â”€ extracted_orders: {    â”‚ â”‚
â”‚  â”‚      medications: [...],  â”‚ â”‚
â”‚  â”‚      labs: [...]          â”‚ â”‚
â”‚  â”‚    }                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ extracted_orders table    â”‚ â”‚
â”‚  â”‚ Row 1: Medication order   â”‚ â”‚
â”‚  â”‚ Row 2: Lab order          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Order Extraction Pipeline

```
Input Text:
"Start metformin 500mg twice daily with meals"
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Sentence Splitting         â”‚
â”‚ - Split on punctuation             â”‚
â”‚ - Split on action keywords         â”‚
â”‚ Result: ["Start metformin 500mg    â”‚
â”‚          twice daily with meals"]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Medication Detection       â”‚
â”‚ - Check for action words:          â”‚
â”‚   âœ… "start" â†’ action = "start"    â”‚
â”‚ - Check for med names:             â”‚
â”‚   âœ… "metformin" â†’ in dictionary   â”‚
â”‚ - Check for dosage:                â”‚
â”‚   âœ… "500mg" â†’ has dosage          â”‚
â”‚ - Check for frequency:             â”‚
â”‚   âœ… "twice daily" â†’ has frequency â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Confidence Calculation     â”‚
â”‚ Base confidence:         0.50      â”‚
â”‚ + Action word:          +0.20      â”‚
â”‚ + Specific med name:    +0.25      â”‚
â”‚ + Dosage present:       +0.15      â”‚
â”‚ + Frequency present:    +0.10      â”‚
â”‚ = Total:                 1.20      â”‚
â”‚ Cap at 1.0:              1.00      â”‚
â”‚ â†’ CONFIDENCE: 100% âœ…              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Create ExtractedOrder      â”‚
â”‚ {                                  â”‚
â”‚   type: "medication",              â”‚
â”‚   text: "Start metformin 500mg...",â”‚
â”‚   action: "start",                 â”‚
â”‚   confidence: 1.0,                 â”‚
â”‚   urgency: "routine"               â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Confidence Scoring Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Confidence Calculation                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  START: Base = 0.5 (50%)                         â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  POSITIVE FACTORS (Increase)        â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚  âœ… Action word detected   +0.20    â”‚         â”‚
â”‚  â”‚     (start, order, check, etc.)     â”‚         â”‚
â”‚  â”‚                                     â”‚         â”‚
â”‚  â”‚  âœ… Specific term found    +0.25    â”‚         â”‚
â”‚  â”‚     (drug name, test name)          â”‚         â”‚
â”‚  â”‚                                     â”‚         â”‚
â”‚  â”‚  âœ… Dosage info present    +0.15    â”‚         â”‚
â”‚  â”‚     (mg, mcg, units, etc.)          â”‚         â”‚
â”‚  â”‚                                     â”‚         â”‚
â”‚  â”‚  âœ… Frequency mentioned    +0.10    â”‚         â”‚
â”‚  â”‚     (daily, twice, bid, etc.)       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  NEGATIVE FACTORS (Decrease)        â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚  âŒ Vague language         -0.15    â”‚         â”‚
â”‚  â”‚     (maybe, possibly, consider)     â”‚         â”‚
â”‚  â”‚                                     â”‚         â”‚
â”‚  â”‚  âŒ Question form          -0.20    â”‚         â”‚
â”‚  â”‚     (should we?, do we want?)       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                   â”‚
â”‚  FINAL: Cap between 0.0 and 1.0                  â”‚
â”‚                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Examples                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  "Start metformin 500mg twice daily"             â”‚
â”‚  â†’ 0.5 + 0.2 + 0.25 + 0.15 + 0.1 = 1.20 â†’ 1.0   â”‚
â”‚  â†’ Confidence: 100% âœ…                           â”‚
â”‚                                                   â”‚
â”‚  "Order A1C"                                     â”‚
â”‚  â†’ 0.5 + 0.2 + 0.25 = 0.95                       â”‚
â”‚  â†’ Confidence: 95% âœ…                            â”‚
â”‚                                                   â”‚
â”‚  "Maybe check glucose"                           â”‚
â”‚  â†’ 0.5 + 0.2 + 0.25 - 0.15 = 0.80                â”‚
â”‚  â†’ Confidence: 80% âš ï¸                            â”‚
â”‚                                                   â”‚
â”‚  "Should we start something for diabetes?"       â”‚
â”‚  â†’ 0.5 + 0.2 - 0.20 = 0.50                       â”‚
â”‚  â†’ Confidence: 50% âš ï¸ (needs review)            â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Database Schema Details

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              dictated_notes table                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                    BIGSERIAL PRIMARY KEY        â”‚
â”‚ provider_id           VARCHAR(100)                 â”‚
â”‚ provider_name         VARCHAR(255)                 â”‚
â”‚ patient_name          VARCHAR(255)                 â”‚
â”‚ patient_mrn           VARCHAR(50)                  â”‚
â”‚ raw_transcript        TEXT                         â”‚
â”‚ processed_note        TEXT                         â”‚
â”‚ extracted_orders      JSONB â­ NEW                 â”‚
â”‚ template_id           VARCHAR(100)                 â”‚
â”‚ status                VARCHAR(50)                  â”‚
â”‚ created_at            TIMESTAMPTZ                  â”‚
â”‚ updated_at            TIMESTAMPTZ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                   (1 to many)
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              extracted_orders table â­ NEW         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                    BIGSERIAL PRIMARY KEY        â”‚
â”‚ note_id               BIGINT â†’ dictated_notes(id)  â”‚
â”‚                                                     â”‚
â”‚ -- Order Details --                                â”‚
â”‚ order_type            VARCHAR(50)                  â”‚
â”‚   Values: medication, lab, imaging,                â”‚
â”‚           prior_auth, referral, other              â”‚
â”‚ order_text            TEXT                         â”‚
â”‚ action                VARCHAR(50)                  â”‚
â”‚   Values: start, stop, continue, increase,         â”‚
â”‚           decrease, order, check                   â”‚
â”‚ urgency               VARCHAR(20)                  â”‚
â”‚   Values: routine, urgent, stat                    â”‚
â”‚                                                     â”‚
â”‚ -- Quality Metrics --                              â”‚
â”‚ confidence_score      DECIMAL(3,2)  [0.00-1.00]   â”‚
â”‚ requires_verification BOOLEAN                      â”‚
â”‚                                                     â”‚
â”‚ -- Workflow Status --                              â”‚
â”‚ status                VARCHAR(50)                  â”‚
â”‚   Values: pending, in_progress,                    â”‚
â”‚           completed, cancelled, verified           â”‚
â”‚ assigned_to_ma_id     VARCHAR(100)                 â”‚
â”‚ assigned_to_ma_name   VARCHAR(255)                 â”‚
â”‚ assigned_at           TIMESTAMPTZ                  â”‚
â”‚ started_at            TIMESTAMPTZ                  â”‚
â”‚ completed_at          TIMESTAMPTZ                  â”‚
â”‚ completed_by_ma_id    VARCHAR(100)                 â”‚
â”‚ completion_notes      TEXT                         â”‚
â”‚                                                     â”‚
â”‚ -- Patient Context (denormalized) --               â”‚
â”‚ patient_name          VARCHAR(255)                 â”‚
â”‚ patient_mrn           VARCHAR(50)                  â”‚
â”‚ provider_id           VARCHAR(100)                 â”‚
â”‚ provider_name         VARCHAR(255)                 â”‚
â”‚                                                     â”‚
â”‚ -- Priority --                                     â”‚
â”‚ priority_score        INTEGER [1-10]               â”‚
â”‚ estimated_time_min    INTEGER                      â”‚
â”‚                                                     â”‚
â”‚ created_at            TIMESTAMPTZ DEFAULT NOW()    â”‚
â”‚ updated_at            TIMESTAMPTZ DEFAULT NOW()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Indexes:
â”œâ”€ idx_extracted_orders_note_id (note_id)
â”œâ”€ idx_extracted_orders_status (status)
â”œâ”€ idx_extracted_orders_order_type (order_type)
â”œâ”€ idx_extracted_orders_urgency (urgency)
â”œâ”€ idx_extracted_orders_assigned_ma (assigned_to_ma_id)
â”œâ”€ idx_extracted_orders_provider (provider_id)
â””â”€ idx_extracted_orders_ma_workflow (composite)
   (status, urgency, priority_score DESC, created_at DESC)
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Row Level Security (RLS)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Provider Access                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ SELECT: Own orders only               â”‚ â”‚
â”‚  â”‚  â”‚   WHERE provider_id =                  â”‚ â”‚
â”‚  â”‚  â”‚     current_setting('app.current_      â”‚ â”‚
â”‚  â”‚  â”‚     provider_id')                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ INSERT: Can create orders             â”‚ â”‚
â”‚  â”‚  â”œâ”€ UPDATE: Can update own orders         â”‚ â”‚
â”‚  â”‚  â””â”€ DELETE: Can delete own orders         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MA (Medical Assistant) Access             â”‚ â”‚
â”‚  â”‚  â”œâ”€ SELECT: All pending/in-progress ordersâ”‚ â”‚
â”‚  â”‚  â”‚   WHERE app.is_ma = true               â”‚ â”‚
â”‚  â”‚  â”œâ”€ INSERT: No (orders created by AI)     â”‚ â”‚
â”‚  â”‚  â”œâ”€ UPDATE: Can update for completion     â”‚ â”‚
â”‚  â”‚  â””â”€ DELETE: No                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Admin Access                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ SELECT: All orders                    â”‚ â”‚
â”‚  â”‚  â”‚   WHERE app.is_admin = true            â”‚ â”‚
â”‚  â”‚  â”œâ”€ INSERT: Yes                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ UPDATE: Yes                            â”‚ â”‚
â”‚  â”‚  â””â”€ DELETE: Yes                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HIPAA Compliance:
â”œâ”€ âœ… Encrypted at rest (Supabase default)
â”œâ”€ âœ… Encrypted in transit (HTTPS/TLS)
â”œâ”€ âœ… Row-level security enforced
â”œâ”€ âœ… Audit trail (created_at, updated_at)
â”œâ”€ âœ… Provider isolation
â””â”€ âœ… No PHI in logs
```

## ğŸ¨ Component Hierarchy

```
App
â””â”€ MedicalDictation
   â”œâ”€ Voice Recording UI
   â”œâ”€ Transcript Display
   â”œâ”€ Patient Details Form
   â”œâ”€ Template Selector
   â”‚
   â”œâ”€ Process with AI Button
   â”‚  â””â”€ onClick â†’ processWithAI()
   â”‚     â””â”€ azureAI.service.processMedicalTranscription()
   â”‚        â””â”€ orderExtraction.service.extractOrders()
   â”‚           â””â”€ Returns: OrderExtractionResult
   â”‚
   â”œâ”€ NoteFormatter (Processed Note Display)
   â”‚
   â””â”€ OrdersDisplay â­ NEW
      â”œâ”€ Header
      â”‚  â”œâ”€ Title: "Orders for Staff"
      â”‚  â”œâ”€ Order Count Badge
      â”‚  â”œâ”€ Copy All Button
      â”‚  â””â”€ Expand/Collapse Button
      â”‚
      â”œâ”€ Quick Stats (if expanded)
      â”‚  â”œâ”€ Medications Count
      â”‚  â”œâ”€ Labs Count
      â”‚  â”œâ”€ Imaging Count
      â”‚  â”œâ”€ Prior Auths Count
      â”‚  â””â”€ Referrals Count
      â”‚
      â”œâ”€ Medication Orders Section
      â”‚  â”œâ”€ Section Header (green)
      â”‚  â”œâ”€ Copy Section Button
      â”‚  â””â”€ Order Items
      â”‚     â”œâ”€ Action Badge (START, STOP, etc.)
      â”‚     â”œâ”€ Order Text
      â”‚     â”œâ”€ Urgency Badge (if STAT/URGENT)
      â”‚     â””â”€ Confidence Warning (if <80%)
      â”‚
      â”œâ”€ Lab Orders Section (blue)
      â”œâ”€ Imaging Orders Section (purple)
      â”œâ”€ Prior Auth Section (orange)
      â”œâ”€ Referrals Section (teal)
      â”‚
      â””â”€ Footer Note
         â””â”€ "For Staff: Verify orders before processing..."
```

## ğŸš€ Performance Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Frontend Optimization             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… React State Management             â”‚
â”‚    - useState for extractedOrders     â”‚
â”‚    - Conditional rendering            â”‚
â”‚    - No unnecessary re-renders        â”‚
â”‚                                        â”‚
â”‚ âœ… Lazy Component Loading              â”‚
â”‚    - OrdersDisplay only when needed   â”‚
â”‚    - Collapsible sections             â”‚
â”‚                                        â”‚
â”‚ âœ… Efficient Re-rendering              â”‚
â”‚    - Pure functional components       â”‚
â”‚    - Minimal prop drilling            â”‚
â”‚    - No inline function creation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Backend Optimization              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Database Indexes                    â”‚
â”‚    - GIN index on JSONB column        â”‚
â”‚    - Composite index for MA queries   â”‚
â”‚    - Status, urgency, priority        â”‚
â”‚                                        â”‚
â”‚ âœ… Denormalized Data                   â”‚
â”‚    - Patient name/MRN in orders       â”‚
â”‚    - Provider name cached             â”‚
â”‚    - Reduces JOIN queries             â”‚
â”‚                                        â”‚
â”‚ âœ… Materialized Views (future)         â”‚
â”‚    - Pre-computed aggregations        â”‚
â”‚    - MA workload summaries            â”‚
â”‚    - Order statistics                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Extraction Optimization           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Efficient Pattern Matching          â”‚
â”‚    - Pre-compiled regex patterns      â”‚
â”‚    - Early exit on non-matches        â”‚
â”‚    - Dictionary lookups (O(1))        â”‚
â”‚                                        â”‚
â”‚ âœ… Smart Sentence Splitting            â”‚
â”‚    - Action keyword detection         â”‚
â”‚    - Context preservation             â”‚
â”‚    - Minimal false positives          â”‚
â”‚                                        â”‚
â”‚ âœ… Cached Results                      â”‚
â”‚    - Extraction runs once per AI call â”‚
â”‚    - Results stored in state          â”‚
â”‚    - No re-extraction on re-render    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š Key Technical Decisions

### 1. **JSONB vs Normalized Storage**
- **Decision**: Store both JSONB (in dictated_notes) AND normalized rows (in extracted_orders)
- **Rationale**:
  - JSONB: Fast read, preserves AI output structure
  - Normalized: Efficient queries for MA workflow
  - Best of both worlds

### 2. **Client-Side vs Server-Side Extraction**
- **Decision**: Client-side extraction in azureAI.service
- **Rationale**:
  - Transcript already in client memory
  - No additional API call needed
  - Faster user experience
  - Can still be moved server-side later

### 3. **Confidence Scoring Algorithm**
- **Decision**: Multi-factor additive scoring
- **Rationale**:
  - Transparent and debuggable
  - Easy to adjust weights
  - Provides actionable thresholds
  - Better than binary yes/no

### 4. **Real-time vs Batch Processing**
- **Decision**: Real-time extraction during AI processing
- **Rationale**:
  - User sees orders immediately
  - No waiting for batch job
  - Can edit/verify before saving
  - Better UX

---

**Document Version**: 1.0
**Last Updated**: 2025-11-20
**Status**: Implementation Complete (Phases 1-3)
