<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase Login</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background: #45a049; }
    .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <h1>üß™ Test Supabase Login</h1>

  <div>
    <input type="email" id="email" placeholder="Email" value="admin@tshla.ai">
    <input type="password" id="password" placeholder="Password" value="TshlaAdmin2025!">
    <button onclick="testLogin()">Test Login</button>
  </div>

  <div id="result"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabase = createClient(
      'https://minvvjdflezibmgkplqb.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1pbnZ2amRmbGV6aWJtZ2twbHFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNDE5ODgsImV4cCI6MjA3MTYxNzk4OH0.-qzlS3artX2DWOVQgIqwd1jd3Utlnik6yOMFhyGcHl8'
    );

    window.testLogin = async function() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const resultDiv = document.getElementById('result');

      resultDiv.innerHTML = '<p>üîÑ Testing login...</p>';

      try {
        // Step 1: Login with Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
          email,
          password
        });

        if (authError) {
          resultDiv.className = 'result error';
          resultDiv.innerHTML = `<strong>‚ùå Auth Failed:</strong><br>${authError.message}`;
          return;
        }

        // Step 2: Get medical_staff record
        const { data: staffData, error: staffError } = await supabase
          .from('medical_staff')
          .select('*')
          .eq('auth_user_id', authData.user.id)
          .single();

        if (staffError || !staffData) {
          resultDiv.className = 'result error';
          resultDiv.innerHTML = `<strong>‚ùå Staff Record Not Found:</strong><br>${staffError?.message || 'No record'}`;
          return;
        }

        // Success!
        resultDiv.className = 'result success';
        resultDiv.innerHTML = `
          <strong>‚úÖ Login Successful!</strong><br><br>
          <strong>User:</strong> ${staffData.first_name} ${staffData.last_name}<br>
          <strong>Email:</strong> ${staffData.email}<br>
          <strong>Role:</strong> ${staffData.role}<br>
          <strong>User ID:</strong> ${authData.user.id}<br>
          <strong>Token:</strong> ${authData.session?.access_token?.substring(0, 50)}...
        `;

      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${error.message}`;
      }
    };
  </script>
</body>
</html>
